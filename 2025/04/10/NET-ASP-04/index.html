<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ASP.NET学习记录-03-路由 | kyl的博客</title><meta name="author" content="kyl"><meta name="copyright" content="kyl"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="C# .NET ASP.NET Core 基础入门 简单学习">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.NET学习记录-03-路由">
<meta property="og:url" content="https://alsl521.github.io/2025/04/10/NET-ASP-04/index.html">
<meta property="og:site_name" content="kyl的博客">
<meta property="og:description" content="C# .NET ASP.NET Core 基础入门 简单学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4">
<meta property="article:published_time" content="2025-04-10T07:50:03.000Z">
<meta property="article:modified_time" content="2025-04-11T07:15:12.045Z">
<meta property="article:author" content="kyl">
<meta property="article:tag" content="C#">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ASP.NET学习记录-03-路由",
  "url": "https://alsl521.github.io/2025/04/10/NET-ASP-04/",
  "image": "https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4",
  "datePublished": "2025-04-10T07:50:03.000Z",
  "dateModified": "2025-04-11T07:15:12.045Z",
  "author": [
    {
      "@type": "Person",
      "name": "kyl",
      "url": "https://alsl521.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://alsl521.github.io/2025/04/10/NET-ASP-04/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ASP.NET学习记录-03-路由',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">kyl的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">ASP.NET学习记录-03-路由</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ASP.NET学习记录-03-路由</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-10T07:50:03.000Z" title="发表于 2025-04-10 15:50:03">2025-04-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-11T07:15:12.045Z" title="更新于 2025-04-11 15:15:12">2025-04-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C#</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/ASP/">ASP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1、Routing和Endpoints简介"><a href="#1、Routing和Endpoints简介" class="headerlink" title="1、Routing和Endpoints简介"></a>1、<code>Routing</code>和<code>Endpoints</code>简介</h1><p>在ASP.NET Core中，**路由（<code>Routing</code>）<strong>和</strong>终结点（<code>Endpoints</code>）**是处理HTTP请求的核心机制，它们共同构成了请求分发的管道系统。以下是对两者的详细介绍：</p>
<hr>
<h3 id="一、路由（Routing）"><a href="#一、路由（Routing）" class="headerlink" title="一、路由（Routing）"></a>一、路由（<code>Routing</code>）</h3><p><strong>路由</strong>的核心作用是将传入的HTTP请求根据URL路径和HTTP方法匹配到对应的处理逻辑（终结点）。在ASP.NET Core中，路由系统被称为<strong>终结点路由（Endpoint Routing）</strong>。</p>
<h4 id="主要功能与工作流程"><a href="#主要功能与工作流程" class="headerlink" title="主要功能与工作流程"></a>主要功能与工作流程</h4><ol>
<li><strong>匹配请求</strong>：<br>通过<code>UseRouting</code>中间件（即<code>EndpointRoutingMiddleware</code>）扫描应用中所有注册的终结点，根据请求的URL和HTTP方法选择最匹配的终结点 。示例代码：</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.UseRouting();</span><br><span class="line">app.UseEndpoints(endpoints =&gt; </span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> context =&gt; &#123; ... &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>路由模板与约束</strong>：<br>路由支持模板语法（如<code>&#123;controller&#125;/&#123;action&#125;/&#123;id?&#125;</code>）和约束条件（如<code>&#123;id:int&#125;</code>），用于动态提取参数并验证格式 。例如：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">endpoints.MapGet(<span class="string">&quot;weather/&#123;city&#125;/&#123;days:int:range(1,4)&#125;&quot;</span>, ...);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>中间件协作</strong>：</p>
<ul>
<li><p>在<code>UseRouting</code>之前：可注册修改请求路径的中间件（如<code>UsePathBase</code>）。</p>
<ul>
<li>在<code>UseRouting</code>和<code>UseEndpoints</code>之间：可插入认证（<code>UseAuthentication</code>）、授权（<code>UseAuthorization</code>）等中间件，提前处理路由匹配后的逻辑。</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="二、终结点（Endpoints）"><a href="#二、终结点（Endpoints）" class="headerlink" title="二、终结点（Endpoints）"></a>二、终结点（<code>Endpoints</code>）</h3><p><strong>终结点</strong>是实际处理请求的执行单元，包含一个<code>RequestDelegate</code>委托和元数据（如路由信息、授权策略），最后返回响应。</p>
<h4 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h4><ol>
<li><p><strong>结构定义</strong>：<br>终结点通过<code>Endpoint</code>类表示，包含以下关键属性：</p>
<ul>
<li><p><code>RequestDelegate</code>：处理请求的委托。</p>
</li>
<li><p><code>Metadata</code>：元数据集合（如路由模板、HTTP方法约束）。</p>
</li>
<li><p><code>DisplayName</code>：用于调试的显示名称。</p>
</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Endpoint</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> RequestDelegate RequestDelegate &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> EndpointMetadataCollection Metadata &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>注册与执行</strong>：<br>通过<code>UseEndpoints</code>中间件（即<code>EndpointMiddleware</code>）注册终结点，并执行匹配到的终结点逻辑。示例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">endpoints.MapGet(<span class="string">&quot;/api/health&quot;</span>, () =&gt; <span class="string">&quot;OK&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>灵活的应用场景</strong>：</p>
<ul>
<li><p><strong>MVC控制器</strong>：<code>MapControllers()</code>。</p>
</li>
<li><p><strong>Razor Pages</strong>：<code>MapRazorPages()</code>。</p>
</li>
<li><p><strong>SignalR</strong>：<code>MapHub&lt;ChatHub&gt;()</code>。</p>
</li>
<li><p>gRPC服务：<code>MapGrpcService&lt;OrderService&gt;()</code>。</p>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="三、路由与终结点的协作流程"><a href="#三、路由与终结点的协作流程" class="headerlink" title="三、路由与终结点的协作流程"></a>三、路由与终结点的协作流程</h3><ol>
<li><p>中间件顺序：<code>UseRouting</code>必须位于<code>UseEndpoints</code>之前，且两者需配合使用。</p>
</li>
<li><p>请求处理步骤：</p>
<ul>
<li><p><code>UseRouting</code>选择终结点，并将结果存储在<code>HttpContext</code>中。</p>
</li>
<li><p>中间件（如认证、CORS）根据终结点元数据执行前置处理。</p>
</li>
<li><p><code>UseEndpoints</code>调用终结点对应的<code>RequestDelegate</code>生成响应。</p>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="四、与传统路由的对比"><a href="#四、与传统路由的对比" class="headerlink" title="四、与传统路由的对比"></a>四、与传统路由的对比</h3><ol>
<li><p><strong>传统路由</strong>：<br>主要基于MVC框架，路由规则与控制器强耦合，灵活性较低。</p>
</li>
<li><p>终结点路由：</p>
<ul>
<li><p>解耦路由与执行：支持多种框架（如Razor Pages、gRPC） 。</p>
</li>
<li><p>元数据驱动：通过元数据实现动态策略（如按终结点配置授权） 。</p>
</li>
<li><p>性能优化：减少中间件调用次数，提升请求处理效率。</p>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="五、实际应用示例"><a href="#五、实际应用示例" class="headerlink" title="五、实际应用示例"></a>五、实际应用示例</h3><h4 id="自定义终结点"><a href="#自定义终结点" class="headerlink" title="自定义终结点"></a>自定义终结点</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.MapGet(<span class="string">&quot;/custom&quot;</span>, (HttpContext context) =&gt; </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> routeData = context.GetRouteData();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">$&quot;Hello <span class="subst">&#123;routeData.Values[<span class="string">&quot;name&quot;</span>]&#125;</span>&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="健康检查终结点"><a href="#健康检查终结点" class="headerlink" title="健康检查终结点"></a>健康检查终结点</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">endpoints.MapHealthChecks(<span class="string">&quot;/healthz&quot;</span>).RequireAuthorization();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>ASP.NET Core的<strong>路由系统</strong>通过<code>UseRouting</code>和<code>UseEndpoints</code>实现了请求的分发与执行分离，而<strong>终结点</strong>作为执行单元，提供了高度可扩展的元数据和约束机制。这种设计不仅支持MVC、Razor Pages等传统模式，还能无缝集成现代技术栈（如gRPC、SignalR），是构建灵活、高性能Web应用的核心基础。</p>
<h1 id="2、理解Endpoints"><a href="#2、理解Endpoints" class="headerlink" title="2、理解Endpoints"></a>2、理解<code>Endpoints</code></h1><p>可以不写“UseEndpoints”，但是不能创建多个“UseEndpoints”。但下列代码<strong>中间件顺序冲突</strong>，<code>EndpointRoutingMiddleware</code>（由<code>UseRouting()</code>注册）负责终结点匹配，而<code>EndpointMiddleware</code>（由<code>UseEndpoints()</code>注册）负责执行终结点。必须先写<code>EndpointRoutingMiddleware</code>，后写<code>EndpointMiddleware</code>。若顺序颠倒或遗漏<code>UseRouting()</code>，会导致路由系统无法正确匹配终结点。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Get employees&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPost(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Create an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPut(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Update an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapDelete(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Delete an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/10/NET-ASP-04/image-20250410161725117.png" alt="image-20250410161725117"></p>
<h1 id="3、使用路由中间件组件"><a href="#3、使用路由中间件组件" class="headerlink" title="3、使用路由中间件组件"></a>3、使用路由中间件组件</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Get employees&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPost(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Create an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPut(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Update an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapDelete(<span class="string">&quot;/employees/&#123;id&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Delete the employee: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;id&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p>初次进入：</p>
<p><img src="/2025/04/10/NET-ASP-04/image-20250410162753615.png" alt="image-20250410162753615"></p>
<p>第二次进入</p>
<p><img src="/2025/04/10/NET-ASP-04/image-20250410162904271.png" alt="image-20250410162904271"></p>
<p><img src="/2025/04/10/NET-ASP-04/image-20250410163038555.png" alt="image-20250410163038555"></p>
<p>由上述内容可见，app.UseRouting()解析了路径与方法，从而能够确定合理的Endpoints</p>
<h1 id="4、处理请求路由参数"><a href="#4、处理请求路由参数" class="headerlink" title="4、处理请求路由参数"></a>4、处理请求路由参数</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Get employees&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPost(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Create an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPut(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Update an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapDelete(<span class="string">&quot;/employees/&#123;id&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Delete the employee: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;id&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/10/NET-ASP-04/image-20250410164502706.png" alt="image-20250410164502706"></p>
<p><img src="/2025/04/10/NET-ASP-04/image-20250410165002581.png" alt="image-20250410165002581"></p>
<h1 id="5、处理请求路由参数（默认值）"><a href="#5、处理请求路由参数（默认值）" class="headerlink" title="5、处理请求路由参数（默认值）"></a>5、处理请求路由参数（默认值）</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Get employees&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPost(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Create an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPut(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Update an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapDelete(<span class="string">&quot;/employees/&#123;id&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Delete the employee: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;id&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/&#123;categories=shirt&#125;/&#123;size=medium&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get Categories <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;categories&quot;</span>]&#125;</span> in Size: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;size&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<center>
<figure>
<style>.ntngwoeqbkvi{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411100544547.png" class="ntngwoeqbkvi">
<style>.voyixisvsbjw{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411100611945.png" class="voyixisvsbjw">
</figure>
</center>

<p>且路由参数是顺序填充的，你无法期望在仅对第二个参数使用指定值的情况下，要求第一个参数使用默认值</p>
<p><img src="/2025/04/10/NET-ASP-04/image-20250411100732368.png" alt="image-20250411100732368"></p>
<h1 id="6、处理请求可选参数"><a href="#6、处理请求可选参数" class="headerlink" title="6、处理请求可选参数"></a>6、处理请求可选参数</h1><p>如果不现实提供可选参数的值，他不会获得任何值，且这个参数就好像并未出现过。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Get employees&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPost(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Create an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapPut(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Update an employee&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapDelete(<span class="string">&quot;/employees/&#123;id&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Delete the employee: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;id&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/&#123;categories=shirt&#125;/&#123;size?&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get Categories <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;categories&quot;</span>]&#125;</span> in Size: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;size&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/10/NET-ASP-04/image-20250411102932371.png" alt="image-20250411102932371"></p>
<p><img src="/2025/04/10/NET-ASP-04/image-20250411103129438.png" alt="image-20250411103129438"></p>
<p>且顺序依旧是必须参数&#x2F;默认值参数&#x2F;可选参数</p>
<h1 id="7、处理请求路由参数约束"><a href="#7、处理请求路由参数约束" class="headerlink" title="7、处理请求路由参数约束"></a>7、处理请求路由参数约束</h1><p>如果有多个路径参数是一样的模板格式，在不添加约束的情况下，服务器将无法解析请求，也无法确认使用哪一个EndPoint。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees/&#123;id&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get employees <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;categories&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees/&#123;name&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get employees <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;categories&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/10/NET-ASP-04/image-20250411104219867.png" alt="image-20250411104219867"></p>
<p>因此，需要添加约束以确保服务器在解析时能够进行正确对应。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees/&#123;id:int&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get employees <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;id&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees/&#123;name&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get employees <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;name&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>



<center>
<figure>
<style>.ylovsqmcjykr{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411104603481.png" class="ylovsqmcjykr">
<style>.pbcvgkmqdkrh{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411104625266.png" class="pbcvgkmqdkrh">
</figure>
</center>

<blockquote>
<p>路由参数约束在Web开发中主要用于对URL中的动态参数进行验证和限制，确保请求符合特定规则后再进入处理逻辑。其核心作用可总结为以下几点：</p>
<ol>
<li><p><strong>类型验证与格式控制</strong><br>通过预定义规则（如<code>int</code>、<code>datetime</code>等）或正则表达式，强制要求参数必须符合指定的数据类型或格式。例如，在ASP.NET Core中，使用<code>&#123;id:int&#125;</code>可确保<code>id</code>为整数，避免非数字参数触发错误处理逻辑。这种方式能直接在路由层过滤无效请求，减少后端逻辑的异常处理负担。</p>
</li>
<li><p><strong>增强安全性与防止攻击</strong><br>约束可阻止恶意用户传递非法参数（如SQL注入或路径遍历攻击）。例如，使用<code>alpha</code>约束限制参数仅包含字母字符，或通过正则表达式<code>regex(^\d+$)</code>确保参数为纯数字，避免意外字符导致的漏洞。</p>
<ol start="3">
<li><strong>优化资源分配与性能</strong><br>通过提前过滤无效请求（如超出范围的数值或长度不匹配的字符串），减少不必要的数据库查询或业务逻辑处理。例如，使用<code>range(18,120)</code>限制年龄参数范围，或<code>minlength(5)</code>要求最小字符串长度，直接返回404而非消耗服务器资源处理无效数据。</li>
</ol>
</li>
<li><p><strong>路由精准匹配与多方法重载</strong><br> 在类似ASP.NET Core的场景中，约束允许同一路由模板通过参数类型区分不同方法。例如，<code>api/employee/10</code>匹配整数参数的<code>GetEmployeeDetails(int)</code>方法，而<code>api/employee/smith</code>匹配字符串参数的版本，避免冲突。</p>
</li>
<li><p><strong>支持自定义业务规则扩展</strong><br> 当内置约束无法满足需求时（如验证特定枚举值或复杂业务逻辑），可通过实现<code>IRouteConstraint</code>接口创建自定义约束，例如检查参数是否为有效邮政编码或符合特定业务状态。</p>
</li>
</ol>
<p>总结来看，路由参数约束通过预验证机制，在请求进入业务逻辑前完成初步过滤，是提升API健壮性、安全性和维护性的重要手段。</p>
</blockquote>
<h1 id="8、处理请求路由参数自定义约束"><a href="#8、处理请求路由参数自定义约束" class="headerlink" title="8、处理请求路由参数自定义约束"></a>8、处理请求路由参数自定义约束</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Web应用构建器并读取配置</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置路由服务选项</span></span><br><span class="line">builder.Services.AddRouting(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 向路由约束映射表中添加自定义约束</span></span><br><span class="line">    <span class="comment">// &quot;pos&quot; 是约束名称，typeof(PositionConstraint) 是约束类型</span></span><br><span class="line">    options.ConstraintMap.Add(<span class="string">&quot;pos&quot;</span>, <span class="keyword">typeof</span>(PositionConstraint));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建Web应用程序</span></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加第一个中间件，用于处理请求</span></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用管道中的下一个中间件</span></span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由功能</span></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加第二个中间件，用于处理请求</span></span><br><span class="line">app.Use(<span class="keyword">async</span> (context, next) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用管道中的下一个中间件</span></span><br><span class="line">    <span class="keyword">await</span> next(context);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置终结点路由</span></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// GET /employees/&#123;position:pos&#125; 终结点（带自定义约束）</span></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees/&#123;position:pos&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 返回指定名称的员工</span></span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Get employees under position: <span class="subst">&#123;context.Request.RouteValues[<span class="string">&quot;position&quot;</span>]&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行应用程序</span></span><br><span class="line">app.Run();</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 路由约束类，用于验证路由参数是否符合特定条件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title">PositionConstraint</span> : <span class="title">IRouteConstraint</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 检查路由参数是否满足约束条件</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;httpContext&quot;&gt;</span>当前HTTP上下文<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;route&quot;&gt;</span>路由对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;routeKey&quot;&gt;</span>路由键名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;values&quot;&gt;</span>路由值字典<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;routeDirection&quot;&gt;</span>路由方向（入站/出站）<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>返回布尔值表示参数是否满足约束<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Match</span>(<span class="params">HttpContext? httpContext, IRouter? route, <span class="built_in">string</span> routeKey, RouteValueDictionary values, RouteDirection routeDirection</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 检查路由值是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!values.ContainsKey(routeKey)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 检查路由值是否为null</span></span><br><span class="line">        <span class="keyword">if</span> (values[routeKey] <span class="keyword">is</span> <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查路由值是否为&quot;manager&quot;或&quot;developer&quot;（不区分大小写）</span></span><br><span class="line">        <span class="keyword">if</span> (values[routeKey].ToString().Equals(<span class="string">&quot;manager&quot;</span>, StringComparison.OrdinalIgnoreCase) ||</span><br><span class="line">            values[routeKey].ToString().Equals(<span class="string">&quot;develpoer&quot;</span>, StringComparison.OrdinalIgnoreCase))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认返回false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<figure>
<style>.wyrkfbtfpcfy{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411143510922.png" class="wyrkfbtfpcfy">
<style>.ubidcborlhua{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411143540735.png" class="ubidcborlhua">
<style>.qjulicgroysj{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411143600770.png" class="qjulicgroysj">
</figure>
</center>

<h1 id="9、使用请求路由参数实现CRUD"><a href="#9、使用请求路由参数实现CRUD" class="headerlink" title="9、使用请求路由参数实现CRUD"></a>9、使用请求路由参数实现CRUD</h1><h2 id="1-Employee"><a href="#1-Employee" class="headerlink" title="1.Employee"></a>1.Employee</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebApplication.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 员工实体类，表示公司员工的基本信息</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Employee</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 员工ID（唯一标识）</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 员工姓名</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 员工职位</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Position &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 员工薪资</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">double</span> Salary &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 员工类的构造函数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>员工ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>员工姓名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;position&quot;&gt;</span>员工职位<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;salary&quot;&gt;</span>员工薪资<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Employee</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">string</span> name, <span class="built_in">string</span> position, <span class="built_in">double</span> salary</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Id = id;</span><br><span class="line">            Name = name;</span><br><span class="line">            Position = position;</span><br><span class="line">            Salary = salary;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-EmployeesRepository"><a href="#2-EmployeesRepository" class="headerlink" title="2.EmployeesRepository"></a>2.EmployeesRepository</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebApplication.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 员工数据仓库类，提供员工数据的静态存储和CRUD操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">EmployeesRepository</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 静态员工列表，初始化包含3个示例员工数据</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Employee&gt; employees = <span class="keyword">new</span> List&lt;Employee&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Employee(<span class="number">1</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;Engineer&quot;</span>, <span class="number">60000</span>),</span><br><span class="line">            <span class="keyword">new</span> Employee(<span class="number">2</span>, <span class="string">&quot;Jane Smith&quot;</span>, <span class="string">&quot;Manager&quot;</span>, <span class="number">75000</span>),</span><br><span class="line">            <span class="keyword">new</span> Employee(<span class="number">3</span>, <span class="string">&quot;Sam Brown&quot;</span>, <span class="string">&quot;Technician&quot;</span>, <span class="number">50000</span>)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取所有员工列表</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>返回员工列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Employee&gt; <span class="title">GetEmployees</span>()</span> =&gt; employees;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据ID获取单个员工</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>员工ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>返回匹配的员工对象，未找到则返回null<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Employee? GetEmployeeById(<span class="built_in">int</span> id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> employees.FirstOrDefault(x =&gt; x.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 添加新员工</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;employee&quot;&gt;</span>要添加的员工对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddEmployee</span>(<span class="params">Employee? employee</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 检查员工对象不为null才执行添加</span></span><br><span class="line">            <span class="keyword">if</span> (employee <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                employees.Add(employee);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 更新员工信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;employee&quot;&gt;</span>包含更新信息的员工对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>更新成功返回true，失败返回false<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">UpdateEmployee</span>(<span class="params">Employee? employee</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (employee <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 查找要更新的员工</span></span><br><span class="line">                <span class="keyword">var</span> emp = employees.FirstOrDefault(x =&gt; x.Id == employee.Id);</span><br><span class="line">                <span class="keyword">if</span> (emp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 更新员工信息</span></span><br><span class="line">                    emp.Name = employee.Name;</span><br><span class="line">                    emp.Position = employee.Position;</span><br><span class="line">                    emp.Salary = employee.Salary;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除员工</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>要删除的员工ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>删除成功返回true，失败返回false<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">DeleteEmployee</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 查找要删除的员工</span></span><br><span class="line">            <span class="keyword">var</span> employee = employees.FirstOrDefault(x =&gt; x.Id == id);</span><br><span class="line">            <span class="keyword">if</span> (employee <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                employees.Remove(employee);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Program"><a href="#3-Program" class="headerlink" title="3.Program"></a>3.Program</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"><span class="keyword">using</span> WebApp.Models;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Web应用构建器</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建Web应用</span></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由中间件</span></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置端点路由</span></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 根路径GET请求处理</span></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Welcome to the home page.&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取所有员工信息</span></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 从仓库获取所有员工数据</span></span><br><span class="line">        <span class="keyword">var</span> employees = EmployeesRepository.GetEmployees();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置响应类型为HTML</span></span><br><span class="line">        context.Response.ContentType = <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;&lt;h2&gt;Employees&lt;/h2&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;&lt;ul&gt;&quot;</span>);</span><br><span class="line">        <span class="comment">// 遍历员工列表生成HTML</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> employee <span class="keyword">in</span> employees)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;&lt;li&gt;&lt;b&gt;<span class="subst">&#123;employee.Name&#125;</span>&lt;/b&gt;: <span class="subst">&#123;employee.Position&#125;</span>&lt;/li&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;&lt;/ul&gt;&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据ID获取单个员工信息</span></span><br><span class="line">    endpoints.MapGet(<span class="string">&quot;/employees/&#123;id:int&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 从路由参数中获取ID</span></span><br><span class="line">        <span class="keyword">var</span> id = context.Request.RouteValues[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">var</span> employeeId = <span class="built_in">int</span>.Parse(id.ToString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据ID查询员工</span></span><br><span class="line">        <span class="keyword">var</span> employee = EmployeesRepository.GetEmployeeById(employeeId);</span><br><span class="line"></span><br><span class="line">        context.Response.ContentType = <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">        <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;&lt;h2&gt;Employee&lt;/h2&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断员工是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (employee <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 显示员工详细信息</span></span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Name: <span class="subst">&#123;employee.Name&#125;</span>&lt;br/&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Position: <span class="subst">&#123;employee.Position&#125;</span>&lt;br/&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">$&quot;Salary: <span class="subst">&#123;employee.Salary&#125;</span>&lt;br/&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 返回404状态码</span></span><br><span class="line">            context.Response.StatusCode = <span class="number">404</span>;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Employee not found.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加新员工</span></span><br><span class="line">    endpoints.MapPost(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 读取请求体</span></span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> reader = <span class="keyword">new</span> StreamReader(context.Request.Body);</span><br><span class="line">        <span class="keyword">var</span> body = <span class="keyword">await</span> reader.ReadToEndAsync();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 反序列化JSON到Employee对象</span></span><br><span class="line">            <span class="keyword">var</span> employee = JsonSerializer.Deserialize&lt;Employee&gt;(body);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 验证数据有效性</span></span><br><span class="line">            <span class="keyword">if</span> (employee <span class="keyword">is</span> <span class="literal">null</span> || employee.Id &lt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                context.Response.StatusCode = <span class="number">400</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 添加员工到仓库</span></span><br><span class="line">            EmployeesRepository.AddEmployee(employee);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回201创建成功状态</span></span><br><span class="line">            context.Response.StatusCode = <span class="number">201</span>;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Employee added successfully.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 处理异常情况</span></span><br><span class="line">            context.Response.StatusCode = <span class="number">400</span>;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(ex.ToString());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新员工信息</span></span><br><span class="line">    endpoints.MapPut(<span class="string">&quot;/employees&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 读取请求体</span></span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> reader = <span class="keyword">new</span> StreamReader(context.Request.Body);</span><br><span class="line">        <span class="keyword">var</span> body = <span class="keyword">await</span> reader.ReadToEndAsync();</span><br><span class="line">        <span class="keyword">var</span> employee = JsonSerializer.Deserialize&lt;Employee&gt;(body);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新员工信息</span></span><br><span class="line">        <span class="keyword">var</span> result = EmployeesRepository.UpdateEmployee(employee);</span><br><span class="line">        <span class="keyword">if</span> (result)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 更新成功返回204</span></span><br><span class="line">            context.Response.StatusCode = <span class="number">204</span>;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Employee updated successfully.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Employee not found.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除员工</span></span><br><span class="line">    endpoints.MapDelete(<span class="string">&quot;/employees/&#123;id&#125;&quot;</span>, <span class="keyword">async</span> (HttpContext context) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取要删除的员工ID</span></span><br><span class="line">        <span class="keyword">var</span> id = context.Request.RouteValues[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">var</span> employeeId = <span class="built_in">int</span>.Parse(id.ToString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查授权头</span></span><br><span class="line">        <span class="keyword">if</span> (context.Request.Headers[<span class="string">&quot;Authorization&quot;</span>] == <span class="string">&quot;frank&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 尝试删除员工</span></span><br><span class="line">            <span class="keyword">var</span> result = EmployeesRepository.DeleteEmployee(employeeId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (result)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Employee is deleted successfully.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 员工不存在返回404</span></span><br><span class="line">                context.Response.StatusCode = <span class="number">404</span>;</span><br><span class="line">                <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;Employee not found.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 未授权返回401</span></span><br><span class="line">            context.Response.StatusCode = <span class="number">401</span>;</span><br><span class="line">            <span class="keyword">await</span> context.Response.WriteAsync(<span class="string">&quot;You are not authorized to delete.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动应用</span></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<center>
<figure>
<style>.vezykexsfvzs{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411150342252.png" class="vezykexsfvzs">
<style>.wfnlijnritni{}</style><img src="/2025/04/10/NET-ASP-04/image-20250411150421392.png" class="wfnlijnritni">
</figure>
</center>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://alsl521.github.io">kyl</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://alsl521.github.io/2025/04/10/NET-ASP-04/">https://alsl521.github.io/2025/04/10/NET-ASP-04/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://alsl521.github.io" target="_blank">kyl的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C#</a></div><div class="post-share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/08/NET-ASP-02/" title="ASP.NET学习记录-02-最小API模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">ASP.NET学习记录-02-最小API模式</div></div><div class="info-2"><div class="info-item-1">1、创建第一个ASP.NET应用（Minimal API）1.创建新项目 选择新的空项目  设定基本信息  使用最新版.NET作为学习内容  2.项目架构简介与解析 1. 解决方案（Solution） 名称：MyFirstWebApplication 作用： 作为容器管理多个相关项目（当前仅包含一个项目 WebApplication）。 支持团队协作和复杂应用的模块化开发（如Web API、类库、单元测试等）。   关键点： 可通过解决方案配置统一管理所有项目的依赖和环境设置。   新增项目 右键单击解决方案-&gt;添加-&gt;新建项目      2. 项目（Project: WebApplication） 核心结构：包含构建和运行Web应用所需的所有文件与配置，分为以下关键部分：  a. Connected Services 文件夹 作用： 存储与外部服务的连接配置（如数据库、Azure服务、第三方API）。 通过右键添加服务（如Entity Framework、Azure认证），自动生成连接配置文件。   示例：添加Azure...</div></div></div></a><a class="pagination-related" href="/2025/04/11/NET-ASP-05/" title="ASP.NET学习记录-05-模型数据绑定"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">ASP.NET学习记录-05-模型数据绑定</div></div><div class="info-2"><div class="info-item-1">1、模型绑定定义模型绑定是ASP.NET Core中将HTTP请求数据自动映射到方法参数或对象属性的机制。其核心工作流程：  数据来源：  路由参数（URL片段） 查询字符串（?key&#x3D;value） 请求体（表单&#x2F;JSON&#x2F;XML） 请求头 文件上传   典型应用：   12345678910111213// 自动绑定路由参数和查询参数[HttpGet(&quot;/products/&#123;id&#125;&quot;)]public IActionResult GetProduct(int id, [FromQuery] string category) &#123;    // id来自路由参数，category来自查询字符串&#125;// 自动绑定JSON请求体[HttpPost]public IActionResult Create([FromBody] Product product)&#123;    //...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/08/NET-ASP-03/" title="ASP.NET学习记录-03-中间件管道"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-03-中间件管道</div></div><div class="info-2"><div class="info-item-1">1、中间件管道简介在 C# ASP.NET Core 中，中间件管道是处理 HTTP 请求和响应的核心机制，通过将多个中间件按顺序串联成一个处理流程，实现灵活的请求处理和业务逻辑组合。以下是其核心要点：  1. 中间件管道的基本概念 中间件（Middleware）：是管道中的独立组件，负责处理 HTTP 请求和响应。每个中间件可以：  对请求进行预处理（如日志、身份验证）。  调用下一个中间件（通过 next()），或直接终止处理（短路）。  对响应进行后处理（如修改响应头、记录耗时）。      管道（Pipeline）：由多个中间件按注册顺序串联而成，形成一个“请求→处理→响应”的流程。请求按顺序经过所有中间件，而响应则逆序返回  。    2. 管道的工作模式：1-n 然后 n-1 请求阶段（正向传递）：请求从第一个中间件开始，依次传递至最后一个中间件（终结点），形成“1→2→3”的顺序 。  响应阶段（逆向返回）：处理完成后，响应从终结点开始，逆序返回至第一个中间件，形成“3→2→1”的顺序  。 示例 123Middleware One: Request Start...</div></div></div></a><a class="pagination-related" href="/2025/04/08/NET-ASP-01/" title="ASP.NET学习记录-01-基础知识"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-01-基础知识</div></div><div class="info-2"><div class="info-item-1">视频教程为：ASP.NET Core Deep-Dive in .NET 9 | Udemy 1、.NET Core.NET Core 是微软开发的开源、跨平台应用程序开发框架，旨在为现代云原生、微服务及高性能场景提供支持。以下是其核心特性与定位的详细说明：  一、核心定义与定位 跨平台支持 .NET Core 可在 Windows、Linux、macOS 等操作系统上运行，并支持 x86、x64、ARM 等多种架构。 这种跨平台能力使其成为开发云原生、容器化应用（如 Docker）的理想选择。  开源与社区驱动 作为 MIT 协议下的开源项目，.NET Core 的代码托管于 GitHub，接受社区贡献，确保了技术透明度和快速迭代。    二、架构与技术特性 模块化设计 采用包化（Packages）管理，开发者可按需引用组件，减少应用体积，与传统的 .NET Framework 打包式安装形成对比。例如，通过 1dotnet restore  命令可动态还原依赖的 NuGet 包。  高性能运行时  RyuJIT 编译器：相比传统 JIT，性能提升约 25%，支持 SIMD...</div></div></div></a><a class="pagination-related" href="/2025/04/08/NET-ASP-02/" title="ASP.NET学习记录-02-最小API模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-02-最小API模式</div></div><div class="info-2"><div class="info-item-1">1、创建第一个ASP.NET应用（Minimal API）1.创建新项目 选择新的空项目  设定基本信息  使用最新版.NET作为学习内容  2.项目架构简介与解析 1. 解决方案（Solution） 名称：MyFirstWebApplication 作用： 作为容器管理多个相关项目（当前仅包含一个项目 WebApplication）。 支持团队协作和复杂应用的模块化开发（如Web API、类库、单元测试等）。   关键点： 可通过解决方案配置统一管理所有项目的依赖和环境设置。   新增项目 右键单击解决方案-&gt;添加-&gt;新建项目      2. 项目（Project: WebApplication） 核心结构：包含构建和运行Web应用所需的所有文件与配置，分为以下关键部分：  a. Connected Services 文件夹 作用： 存储与外部服务的连接配置（如数据库、Azure服务、第三方API）。 通过右键添加服务（如Entity Framework、Azure认证），自动生成连接配置文件。   示例：添加Azure...</div></div></div></a><a class="pagination-related" href="/2025/04/11/NET-ASP-05/" title="ASP.NET学习记录-05-模型数据绑定"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">ASP.NET学习记录-05-模型数据绑定</div></div><div class="info-2"><div class="info-item-1">1、模型绑定定义模型绑定是ASP.NET Core中将HTTP请求数据自动映射到方法参数或对象属性的机制。其核心工作流程：  数据来源：  路由参数（URL片段） 查询字符串（?key&#x3D;value） 请求体（表单&#x2F;JSON&#x2F;XML） 请求头 文件上传   典型应用：   12345678910111213// 自动绑定路由参数和查询参数[HttpGet(&quot;/products/&#123;id&#125;&quot;)]public IActionResult GetProduct(int id, [FromQuery] string category) &#123;    // id来自路由参数，category来自查询字符串&#125;// 自动绑定JSON请求体[HttpPost]public IActionResult Create([FromBody] Product product)&#123;    //...</div></div></div></a><a class="pagination-related" href="/2025/04/15/NET-ASP-09/" title="ASP.NET学习记录-09-MVC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-15</div><div class="info-item-2">ASP.NET学习记录-09-MVC</div></div><div class="info-2"><div class="info-item-1">1、MVC PatternASP.NET中的MVC（Model-View-Controller）模式是一种软件架构设计模式，它将应用程序分为三个核心组件：模型（Model）、视图（View）和控制器（Controller），以实现关注点分离，提升代码可维护性和可扩展性。  以下是其具体内涵及在ASP.NET中的应用特点： 1....</div></div></div></a><a class="pagination-related" href="/2025/04/18/NET-ASP-11/" title="ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-18</div><div class="info-item-2">ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API</div></div><div class="info-2"><div class="info-item-1">1、初始化项目本实践将创建以下 API：     API 说明 请求正文 响应正文    GET /api/todoitems 获取所有待办事项 无 待办事项的数组   GET /api/todoitems/&#123;id&#125; 按 ID 获取项 无 待办事项   POST /api/todoitems 添加新项 待办事项 待办事项   PUT /api/todoitems/&#123;id&#125; 更新现有项 待办事项 无   DELETE /api/todoitems/&#123;id&#125; 删除项 无 无   1.初始化项目首先要确保安装必备的相关内容，即ASP.NET和Web开发。  在此基础上，创建项目：  首先选择合理的项目模板   随后选择并输入名称，具体内容随意   依据需求选择，本次不使用HTTPS，随后创建项目。    2.项目内容介绍：  该项目是一个典型的 ASP.NET Core Web 应用项目，采用标准的 MVC（模型-视图-控制器）分层架构。  1. 项目整体架构 分层逻辑： 控制器（Controllers）：处理 HTTP...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">kyl</div><div class="author-info-description">用于记录平时学习的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/alsl521" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:852970167@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81Routing%E5%92%8CEndpoints%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">1、Routing和Endpoints简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%B7%AF%E7%94%B1%EF%BC%88Routing%EF%BC%89"><span class="toc-number">1.0.1.</span> <span class="toc-text">一、路由（Routing）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">主要功能与工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%88%E7%BB%93%E7%82%B9%EF%BC%88Endpoints%EF%BC%89"><span class="toc-number">1.0.2.</span> <span class="toc-text">二、终结点（Endpoints）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">核心特性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E7%BB%88%E7%BB%93%E7%82%B9%E7%9A%84%E5%8D%8F%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.0.3.</span> <span class="toc-text">三、路由与终结点的协作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%8E%E4%BC%A0%E7%BB%9F%E8%B7%AF%E7%94%B1%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">1.0.4.</span> <span class="toc-text">四、与传统路由的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.0.5.</span> <span class="toc-text">五、实际应用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%88%E7%BB%93%E7%82%B9"><span class="toc-number">1.0.5.1.</span> <span class="toc-text">自定义终结点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E7%BB%88%E7%BB%93%E7%82%B9"><span class="toc-number">1.0.5.2.</span> <span class="toc-text">健康检查终结点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.0.6.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E7%90%86%E8%A7%A3Endpoints"><span class="toc-number">2.</span> <span class="toc-text">2、理解Endpoints</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">3、使用路由中间件组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">4、处理请求路由参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%EF%BC%88%E9%BB%98%E8%AE%A4%E5%80%BC%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">5、处理请求路由参数（默认值）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E5%8F%AF%E9%80%89%E5%8F%82%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">6、处理请求可选参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%E3%80%81%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E7%BA%A6%E6%9D%9F"><span class="toc-number">7.</span> <span class="toc-text">7、处理请求路由参数约束</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8%E3%80%81%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%A6%E6%9D%9F"><span class="toc-number">8.</span> <span class="toc-text">8、处理请求路由参数自定义约束</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9%E3%80%81%E4%BD%BF%E7%94%A8%E8%AF%B7%E6%B1%82%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E5%AE%9E%E7%8E%B0CRUD"><span class="toc-number">9.</span> <span class="toc-text">9、使用请求路由参数实现CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Employee"><span class="toc-number">9.1.</span> <span class="toc-text">1.Employee</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-EmployeesRepository"><span class="toc-number">9.2.</span> <span class="toc-text">2.EmployeesRepository</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Program"><span class="toc-number">9.3.</span> <span class="toc-text">3.Program</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/NET-ASP-13/" title="ASP.NET学习记录-13-实践2-数据库进阶">ASP.NET学习记录-13-实践2-数据库进阶</a><time datetime="2025-04-21T08:39:19.000Z" title="发表于 2025-04-21 16:39:19">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/NET-ASP-12/" title="ASP.NET学习记录-12-实践2-使用MySQL数据库">ASP.NET学习记录-12-实践2-使用MySQL数据库</a><time datetime="2025-04-18T08:11:21.000Z" title="发表于 2025-04-18 16:11:21">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/NET-ASP-11/" title="ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API">ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API</a><time datetime="2025-04-18T02:13:44.000Z" title="发表于 2025-04-18 10:13:44">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/16/NET-ASP-10/" title="ASP.NET学习记录-10-过滤">ASP.NET学习记录-10-过滤</a><time datetime="2025-04-16T12:02:16.000Z" title="发表于 2025-04-16 20:02:16">2025-04-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/15/Software/" title="记录必备软件">记录必备软件</a><time datetime="2025-04-15T11:29:21.000Z" title="发表于 2025-04-15 19:29:21">2025-04-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 By kyl</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>