<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ASP.NET学习记录-08-MVC路由 | kyl的博客</title><meta name="author" content="kyl"><meta name="copyright" content="kyl"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="C# .NET ASP.NET Core 基础入门 简单学习">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.NET学习记录-08-MVC路由">
<meta property="og:url" content="https://alsl521.github.io/2025/04/14/NET-ASP-08/index.html">
<meta property="og:site_name" content="kyl的博客">
<meta property="og:description" content="C# .NET ASP.NET Core 基础入门 简单学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4">
<meta property="article:published_time" content="2025-04-14T12:28:53.000Z">
<meta property="article:modified_time" content="2025-04-15T14:23:11.929Z">
<meta property="article:author" content="kyl">
<meta property="article:tag" content="C#">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ASP.NET学习记录-08-MVC路由",
  "url": "https://alsl521.github.io/2025/04/14/NET-ASP-08/",
  "image": "https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4",
  "datePublished": "2025-04-14T12:28:53.000Z",
  "dateModified": "2025-04-15T14:23:11.929Z",
  "author": [
    {
      "@type": "Person",
      "name": "kyl",
      "url": "https://alsl521.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://alsl521.github.io/2025/04/14/NET-ASP-08/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ASP.NET学习记录-08-MVC路由',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">kyl的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">ASP.NET学习记录-08-MVC路由</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ASP.NET学习记录-08-MVC路由</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-14T12:28:53.000Z" title="发表于 2025-04-14 20:28:53">2025-04-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-15T14:23:11.929Z" title="更新于 2025-04-15 22:23:11">2025-04-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C#</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/ASP/">ASP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1、什么是controller？为什么用controller？"><a href="#1、什么是controller？为什么用controller？" class="headerlink" title="1、什么是controller？为什么用controller？"></a>1、什么是controller？为什么用controller？</h1><p>模型-视图-控制器 (MVC) 体系结构模式将应用分成 3 个主要组件：模型 (M)、视图 (V) 和控制器 (C) 。 MVC 模式有助于创建比传统单片应用更易于测试和更新的应用。</p>
<p>基于 MVC 的应用包含：</p>
<ul>
<li>模型 (M)：是表示应用数据的类。 模型类使用验证逻辑来对该数据强制实施业务规则。 通常，模型对象检索模型状态并将其存储在数据库中。 本教程中，<code>Movie</code> 模型将从数据库中检索电影数据，并将其提供给视图或对其进行更新。 更新后的数据将写入到数据库。</li>
<li>视图 (V)：视图是显示应用用户界面 (UI) 的组件。 此 UI 通常会显示模型数据。</li>
<li>控制器 (C)：具有以下特征的类：<ul>
<li>处理浏览器请求。</li>
<li>检索模型数据。</li>
<li>调用返回响应的视图模板。</li>
</ul>
</li>
</ul>
<p>在 MVC 应用中，视图仅显示信息。 控制器处理用户输入和交互并对其进行响应。 例如，控制器处理 URL 段和查询字符串值，并将这些值传递给模型。 该模型可使用这些值查询数据库。 例如：</p>
<ul>
<li><code>https://localhost:5001/Home/Privacy</code>：指定 <code>Home</code> 控制器和 <code>Privacy</code> 操作。</li>
<li><code>https://localhost:5001/Movies/Edit/5</code>：是使用 <code>Movies</code> 控制器和 <code>Edit</code> 操作编辑 ID&#x3D;5 的电影的请求，本教程稍后将对此进行详细介绍。</li>
</ul>
<p>本教程的后续部分中将介绍路由数据。</p>
<p>MVC 体系结构模式将应用分成 3 组主要组件：模型、视图和控制器。 此模式有助于实现关注点分离：UI 逻辑位于视图中。 输入逻辑位于控制器中。 业务逻辑位于模型中。 这种隔离有助于控制构建应用时的复杂程度，因为它可用于一次处理一个实现特性，而不影响其他特性的代码。 例如，处理视图代码时不必依赖业务逻辑代码。</p>
<p><code>ChatGPT</code>：</p>
<p>在 ASP.NET（尤其是 ASP.NET MVC 和 ASP.NET Core MVC）中，<strong>Controller</strong> 是应用程序的核心组件之一，负责处理用户请求并决定如何生成响应。它是基于 MVC（Model-View-Controller）架构模式的一部分，负责连接用户界面（View）和业务逻辑（Model）。</p>
<p><strong>什么是 Controller？</strong></p>
<ol>
<li><p><strong>定义</strong><br> Controller 是一个类，通常继承自 <code>ControllerBase</code> 或 <code>Controller</code> 类，用来处理用户通过 HTTP 请求发送到应用的任务。例如：接收 GET、POST、PUT 或 DELETE 请求。</p>
</li>
<li><p><strong>职责</strong></p>
<ul>
<li>解析和处理用户请求（包括路由和参数）。</li>
<li>调用业务逻辑（通常通过服务或模型）来完成具体任务。</li>
<li>根据处理结果返回适当的响应，如 JSON 数据、视图（HTML 页面）或 HTTP 状态码。</li>
</ul>
</li>
<li><p><strong>基本示例</strong> 在 ASP.NET Core 中，一个简单的 Controller 示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;[controller]&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">string</span>&gt; <span class="title">Get</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;Product1&quot;</span>, <span class="string">&quot;Product2&quot;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当用户通过 HTTP GET 请求访问 <code>/Products</code> 时，<code>Get</code> 方法会被执行并返回结果。</li>
</ul>
</li>
</ol>
<p><strong>为什么使用 Controller？</strong></p>
<ol>
<li><strong>解耦逻辑</strong><ul>
<li>将用户界面、业务逻辑和数据逻辑分离，使代码更易于维护和扩展。</li>
<li>通过 MVC 模式，Controller 专注于处理请求，而模型处理数据逻辑，视图负责渲染界面。</li>
</ul>
</li>
<li><strong>提升代码的可读性与可维护性</strong><ul>
<li>Controller 的方法往往小而清晰，每个方法处理特定的任务，使代码更加模块化。</li>
<li>开发者可以轻松地对功能进行更新或扩展，而不会影响其他部分。</li>
</ul>
</li>
<li><strong>内置功能</strong><ul>
<li>ASP.NET Core Controller 提供内置的路由、模型绑定、验证等功能，大大简化了开发任务。</li>
<li>提供对 JSON、XML 等多种格式的支持，使构建 API 更加方便。</li>
</ul>
</li>
<li><strong>支持测试</strong><ul>
<li>Controller 易于进行单元测试，开发者可以用 Mock 服务来测试不同的请求和响应路径，而无需依赖真实的底层资源（如数据库）。</li>
</ul>
</li>
</ol>
<p><strong>总结</strong><br> Controller 是 ASP.NET 应用程序中用于处理请求的核心组件，它通过 MVC 模式的分工，简化了代码结构，提升了扩展性和维护性。Controller 的存在，让开发者能够专注于实现具体的业务逻辑，同时轻松处理复杂的请求与响应逻辑。</p>
<h1 id="2、MVC-属性路由"><a href="#2、MVC-属性路由" class="headerlink" title="2、MVC-属性路由"></a>2、MVC-属性路由</h1><p>在 ASP.NET 中，可以通过以下几个特征来识别、判断一个类是否为 <strong>Controller</strong>：</p>
<h2 id="1、判断一个类是否为Controller"><a href="#1、判断一个类是否为Controller" class="headerlink" title="1、判断一个类是否为Controller"></a>1、判断一个类是否为<code>Controller</code></h2><p><strong>1. 命名规范</strong></p>
<p>通常，ASP.NET 的 Controller 类以 <strong><code>Controller</code></strong> 结尾。例如：</p>
<ul>
<li><code>HomeController</code></li>
<li><code>ProductsController</code></li>
</ul>
<p>这是 MVC 模式的约定，虽然并非强制，但符合此命名惯例的类更容易被识别为 Controller。</p>
<p><strong>2. 基类继承</strong></p>
<p>在 ASP.NET Core 中，Controller 类通常继承以下基类之一：</p>
<ul>
<li><strong><code>ControllerBase</code></strong>（用于 API 控制器）。</li>
<li><strong><code>Controller</code></strong>（用于 MVC 控制器，支持视图和 Razor Pages）。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 方法定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果一个类继承了上述基类，那么它很可能是一个 Controller。</p>
<p><strong>3. 特性标注（Attributes）</strong></p>
<p>Controller 通常会通过特性标注来定义行为或路由规则：</p>
<ul>
<li><strong><code>[ApiController]</code></strong>：标识该类是 Web API 的控制器。</li>
<li><strong><code>[Route]</code></strong> 或 <code>[HttpGet]</code> 等：定义路由和请求类型。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/[controller]&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">string</span>&gt; <span class="title">GetProducts</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;Product1&quot;</span>, <span class="string">&quot;Product2&quot;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用了这些特性的类通常是 Controller。</p>
<p><strong>4. 类的职责</strong></p>
<p>一个 Controller 类的核心职责包括：</p>
<ul>
<li><strong>处理 HTTP 请求</strong>：例如 GET、POST、PUT、DELETE 等。</li>
<li><strong>返回响应</strong>：通常通过 <code>IActionResult</code> 或数据模型返回结果。</li>
<li><strong>连接业务逻辑与用户界面</strong>：通过调用服务或处理数据，向前端传递数据。</li>
</ul>
<p>如果一个类包含这些职责，很可能是一个 Controller。</p>
<p><strong>5. 文件位置</strong></p>
<p>在 ASP.NET 项目中，Controller 类通常被组织在一个名为 <strong><code>Controllers</code></strong> 的文件夹中。例如：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/MyApp</span><br><span class="line"> ├── Controllers/</span><br><span class="line">     ├── HomeController.cs</span><br><span class="line">     ├── ProductsController.cs</span><br></pre></td></tr></table></figure>

<p>虽然文件夹名称不是强制要求，但这是约定俗成的组织方式。</p>
<p><strong>6. 方法签名</strong></p>
<p>Controller 类中的方法通常具有以下特征：</p>
<ul>
<li>与 HTTP 动作相关联（如 GET、POST 等）。</li>
<li>返回类型为 <code>IActionResult</code> 或直接返回数据（如 <code>string</code> 或 <code>List</code>）。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetProduct</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 返回一个响应</span></span><br><span class="line">    <span class="keyword">return</span> Ok(<span class="keyword">new</span> &#123; Id = id, Name = <span class="string">&quot;Sample Product&quot;</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<p>要判断一个类是否是 Controller，可以综合考虑以下因素：</p>
<ul>
<li>是否命名为 <code>Controller</code> 结尾。</li>
<li>是否继承了 <code>ControllerBase</code> 或 <code>Controller</code>。</li>
<li>是否使用了特性如 <code>[ApiController]</code> 或 <code>[Route]</code>。</li>
<li>是否位于 <code>Controllers</code> 文件夹。</li>
<li>是否负责处理 HTTP 请求并返回响应。</li>
</ul>
<p>这些特性组合起来能明确判断一个类是否为 ASP.NET 中的 Controller。</p>
<h2 id="2、注册一个类为Controller"><a href="#2、注册一个类为Controller" class="headerlink" title="2、注册一个类为Controller"></a>2、注册一个类为<code>Controller</code></h2><p>在 ASP.NET 中，注册一个类为 <strong>Controller</strong> 是通过框架内置机制完成的。通常，只需按照框架的约定设置类即可，ASP.NET 会自动识别它并注册为控制器。</p>
<p>以下是如何确保你的类被注册为控制器的步骤：</p>
<p><strong>1. 确保继承正确的基类</strong></p>
<p>在 ASP.NET Core 中，控制器类需要继承以下基类之一：</p>
<ul>
<li><strong><code>ControllerBase</code></strong>：用于 Web API 控制器（不需要视图支持）。</li>
<li><strong><code>Controller</code></strong>：用于 MVC 控制器（支持视图和 Razor Pages）。</li>
</ul>
<p>例如：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetProducts</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Ok(<span class="keyword">new</span>[] &#123; <span class="string">&quot;Product1&quot;</span>, <span class="string">&quot;Product2&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果类继承了 <code>ControllerBase</code> 或 <code>Controller</code>，框架会自动识别它为控制器。</p>
<p><strong>2. 特性标注（可选）</strong></p>
<p>你可以通过特性（Attributes）明确声明控制器的行为：</p>
<ul>
<li><strong><code>[ApiController]</code></strong>：标识该类是 Web API 的控制器。</li>
<li><strong><code>[Route]</code></strong>：定义控制器的路由规则。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/[controller]&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProductsController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetProducts</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Ok(<span class="keyword">new</span>[] &#123; <span class="string">&quot;Product1&quot;</span>, <span class="string">&quot;Product2&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>[ApiController]</code> 特性可以启用额外功能，如模型验证自动处理。</p>
<p><strong>3. 配置 ASP.NET Core 应用程序</strong></p>
<p>控制器的注册通常通过 <code>Program.cs</code> 中的配置完成：</p>
<p><strong>(1) 使用依赖注入</strong></p>
<p>如果控制器需要依赖其他服务，你可以在依赖注入容器中注册这些服务。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddControllers();</span><br></pre></td></tr></table></figure>

<p>这行代码会告诉 ASP.NET Core 自动扫描项目中的控制器类并注册它们。</p>
<p><strong>(2) 配置中间件</strong></p>
<p>在 ASP.NET Core 中，使用 <code>MapControllers()</code> 添加控制器路由：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line">app.MapControllers();</span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p>这确保所有符合控制器约定的类被注册并正确映射到对应的 HTTP 请求。</p>
<p><strong>4. 项目结构与约定</strong></p>
<p>控制器通常按照约定存放在项目的 <code>Controllers/</code> 文件夹中：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/MyApp</span><br><span class="line"> ├── Controllers/</span><br><span class="line">     ├── HomeController.cs</span><br><span class="line">     ├── ProductsController.cs</span><br></pre></td></tr></table></figure>

<p>虽然不是必须，但这种组织方式符合惯例，并且便于框架自动发现控制器。</p>
<p><strong>5. 动态注册（特殊需求）</strong></p>
<p>如果需要动态注册某个控制器，可以通过反射或自定义路由处理器来实现，但这通常用于高级场景。以下是示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapControllerRoute(</span><br><span class="line">        name: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        pattern: <span class="string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<p>要注册一个类为控制器，只需：</p>
<ol>
<li>继承 <code>ControllerBase</code> 或 <code>Controller</code>。</li>
<li>添加相关的特性（如 <code>[ApiController]</code> 和 <code>[Route]</code>）。</li>
<li>确保在 <code>Program.cs</code> 中通过 <code>AddControllers()</code> 和 <code>MapControllers()</code> 注册和启用控制器。</li>
</ol>
<p>DepartmentsController.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;  <span class="comment">// 引入MVC核心功能命名空间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Controllers</span>  <span class="comment">// 控制器所在的应用程序命名空间</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Route(<span class="string">&quot;/api&quot;</span>)</span>]  <span class="comment">// 控制器级路由：定义基础API路径</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DepartmentsController</span>  <span class="comment">// 部门业务控制器类</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">HttpGet(<span class="string">&quot;departments&quot;</span>)</span>]  <span class="comment">// 定义GET请求端点：/api/departments</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetDepartments</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;These are the departments.&quot;</span>;  <span class="comment">// 返回部门列表响应</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">HttpGet(<span class="string">&quot;departments/&#123;id&#125;&quot;</span>)</span>]  <span class="comment">// 定义带参数的GET请求端点：/api/departments/&#123;id&#125;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetDepartmentById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Department info: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回带ID参数的部门信息响应</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Program.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);  <span class="comment">// 创建Web应用构建器实例</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();  <span class="comment">// 注册控制器服务（MVC核心功能）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();  <span class="comment">// 构建Web应用程序实例</span></span><br><span class="line"></span><br><span class="line">app.UseRouting();  <span class="comment">// 启用请求路由中间件</span></span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapControllers();  <span class="comment">// 映射控制器路由端点（自动匹配控制器路由）</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();  <span class="comment">// 启动Web应用程序并监听请求</span></span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250414210202323.png" alt="image-20250414210202323"></p>
<h1 id="3、MVC-传统路由"><a href="#3、MVC-传统路由" class="headerlink" title="3、MVC-传统路由"></a>3、MVC-传统路由</h1><p>在 ASP.NET 中，<strong>传统路由（Traditional Routing）</strong> 是一种基于 <strong>路由表</strong> 的 URL 路由机制，用于将用户请求映射到特定的控制器和动作方法。这种路由方式最早出现在 ASP.NET MVC 和 Web API 中，其核心是通过定义固定的路由模板来解析请求。</p>
<p><strong>1. 传统路由的工作机制</strong></p>
<p>传统路由依赖一个全局的路由表，该表由开发者在应用程序启动时定义。这些路由通过模板和参数描述 URL 模式，并将其与相应的控制器和动作方法关联。</p>
<ul>
<li>传统路由的典型定义在 <code>Startup.cs</code>（ASP.NET Core）或 <code>Global.asax</code>（早期 ASP.NET）中完成。</li>
<li>它基于顺序匹配：框架会从上到下检查路由规则，一旦匹配成功，就停止继续匹配。</li>
</ul>
<p><strong>2. 传统路由的示例</strong></p>
<p>以下是一个 ASP.NET Core 的传统路由示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapControllerRoute(</span><br><span class="line">        name: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        pattern: <span class="string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>解释</strong>：</p>
<ul>
<li><code>&#123;controller&#125;</code>：表示控制器名称，如 <code>HomeController</code>。</li>
<li><code>&#123;action&#125;</code>：表示控制器中的动作方法，如 <code>Index</code>。</li>
<li><code>&#123;id?&#125;</code>：表示一个可选的参数，通常用于传递 ID 值。</li>
</ul>
<p>示例请求：</p>
<ul>
<li><code>/Home/Index</code> 会映射到 <code>HomeController</code> 的 <code>Index</code> 方法。</li>
<li><code>/Products/Details/5</code> 会映射到 <code>ProductsController</code> 的 <code>Details</code> 方法，并将 <code>id</code> 参数设置为 5。</li>
</ul>
<p><strong>3. 传统路由的优缺点</strong></p>
<p>优点：</p>
<ul>
<li><strong>简单直观</strong>：基于固定模板的规则易于理解和使用。</li>
<li><strong>灵活性高</strong>：可以定义复杂的路由模板以满足多样化需求。</li>
</ul>
<p>缺点：</p>
<ul>
<li><strong>依赖顺序匹配</strong>：如果路由规则很多，可能会降低性能或导致错误的匹配。</li>
<li><strong>不够自动化</strong>：需要明确定义每个路由规则，管理成本较高。</li>
<li><strong>局限性</strong>：对于现代 RESTful API 或 SPA（单页应用程序）开发，传统路由不够高效。</li>
</ul>
<p><strong>4. 与端点路由（Endpoint Routing）的对比</strong></p>
<p>在 ASP.NET Core 3.0 之后，引入了 <strong>端点路由（Endpoint Routing）</strong>，逐渐替代了传统路由。相比之下：</p>
<ul>
<li><strong>传统路由</strong> 依赖 <code>UseMvc()</code> 来添加路由表，而 <strong>端点路由</strong> 使用 <code>MapControllers()</code> 或 <code>MapGet()</code> 来定义路由。</li>
<li><strong>端点路由</strong> 更灵活，支持全局路由过滤器和动态路由规则。</li>
</ul>
<p><strong>总结</strong></p>
<p>传统路由是 ASP.NET 中用于将 URL 模式映射到控制器和动作方法的早期机制，具有规则明确和简单易用的特点，但逐渐被更现代的端点路由取代。在实际开发中，了解传统路由的基础有助于理解路由系统的演变和其在复杂应用中的适用场景。</p>
<p>DepartmentsController.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;  <span class="comment">// 引入ASP.NET Core MVC核心功能命名空间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Controllers</span>  <span class="comment">// 定义应用程序控制器层命名空间</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DepartmentsController</span>  <span class="comment">// 部门资源控制器类</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取部门列表</span></span><br><span class="line">        <span class="comment">// 返回值: 部门列表信息字符串</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Index</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;These are the departments.&quot;</span>;  <span class="comment">// 返回部门列表响应信息</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取指定部门详情</span></span><br><span class="line">        <span class="comment">// 参数: id - 可空部门ID</span></span><br><span class="line">        <span class="comment">// 返回值: 包含部门ID的详情信息字符串</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Department info: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回带ID参数的部门详情响应</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 显示部门创建页面</span></span><br><span class="line">        <span class="comment">// 返回值: 部门创建提示信息字符串</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Create</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Create the departments.&quot;</span>;  <span class="comment">// 返回部门创建功能提示</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除指定部门</span></span><br><span class="line">        <span class="comment">// 参数: id - 可空部门ID</span></span><br><span class="line">        <span class="comment">// 返回值: 包含部门ID的删除操作信息字符串</span></span><br><span class="line">        [<span class="meta">HttpDelete</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Delete info: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回带ID参数的删除操作响应</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 编辑指定部门(自定义路由)</span></span><br><span class="line">        <span class="comment">// 路由: /departments/&#123;id?&#125;</span></span><br><span class="line">        <span class="comment">// 参数: id - 可空部门ID</span></span><br><span class="line">        <span class="comment">// 返回值: 包含部门ID的编辑操作信息字符串</span></span><br><span class="line">        [<span class="meta">HttpPut</span>]</span><br><span class="line">        [<span class="meta">Route(<span class="string">&quot;/departments/&#123;id?&#125;&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Edit</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Edit info: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回带ID参数的编辑操作响应</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Program.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);  <span class="comment">// 创建Web应用构建器实例（加载配置文件和环境配置）</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();  <span class="comment">// 注册MVC控制器服务（支持控制器和API端点）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();  <span class="comment">// 构建Web应用实例（中间件管道初始化）</span></span><br><span class="line"></span><br><span class="line">app.UseRouting();  <span class="comment">// 启用路由中间件（请求与端点匹配）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置端点路由时检测到嵌套的UseEndpoints调用（异常结构）</span></span><br><span class="line"><span class="comment">// 正确写法应删除外层UseEndpoints，改为：</span></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 配置默认控制器路由模板</span></span><br><span class="line">    <span class="comment">// 格式说明：&#123;控制器=Home&#125;/&#123;Action=Index&#125;/&#123;可选ID参数&#125;</span></span><br><span class="line">    endpoints.MapControllerRoute(</span><br><span class="line">        name: <span class="string">&quot;default&quot;</span>,  <span class="comment">// 路由方案名称</span></span><br><span class="line">        pattern: <span class="string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>);  <span class="comment">// URL路径匹配规则</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();  <span class="comment">// 启动HTTP服务（阻塞式监听，直到应用关闭）</span></span><br></pre></td></tr></table></figure>

<center>
<figure>
<style>.qduqfsxbysip{}</style><img src="/2025/04/14/NET-ASP-08/image-20250414212020884.png" class="qduqfsxbysip">
<style>.tqgzkronbylx{}</style><img src="/2025/04/14/NET-ASP-08/image-20250414212144062.png" class="tqgzkronbylx">
<style>.mmldbwploocj{}</style><img src="/2025/04/14/NET-ASP-08/image-20250414212330041.png" class="mmldbwploocj">
<style>.nvycniokumwc{}</style><img src="/2025/04/14/NET-ASP-08/image-20250414212550752.png" class="nvycniokumwc">
</figure>
</center>
# 4、MVC-复杂模型绑定

<p>Department.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;  <span class="comment">// 引入ASP.NET Core MVC框架核心功能</span></span><br><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations;  <span class="comment">// 引入数据验证相关特性</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Models</span>  <span class="comment">// 定义应用程序模型层命名空间</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Department</span>  <span class="comment">// 部门实体类</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;  <span class="comment">// 部门唯一标识符(主键)</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">Required</span>]  <span class="comment">// 数据验证：名称字段为必填项</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span>? Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;  <span class="comment">// 部门名称(可空字符串)</span></span><br><span class="line"></span><br><span class="line">        [<span class="meta">StringLength(500)</span>]  <span class="comment">// 数据验证：描述字段最大长度限制为500字符</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span>? Description &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;  <span class="comment">// 部门描述信息(可空字符串)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DepartmentsController.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;  <span class="comment">// 引入ASP.NET Core MVC框架核心功能</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Models;  <span class="comment">// 引入应用程序模型层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Controllers</span>  <span class="comment">// 定义应用程序控制器层命名空间</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DepartmentsController</span>  <span class="comment">// 部门资源控制器类</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取部门列表</span></span><br><span class="line">        <span class="comment">// 返回值: 部门列表信息字符串</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Index</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;These are the departments.&quot;</span>;  <span class="comment">// 返回部门列表响应信息</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取指定部门详情</span></span><br><span class="line">        <span class="comment">// 参数: id - 可空部门ID</span></span><br><span class="line">        <span class="comment">// 返回值: 包含部门ID的详情信息字符串</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Department info: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回带ID参数的部门详情响应</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建新部门(HTTP POST方法)</span></span><br><span class="line">        <span class="comment">// 参数: department - 部门实体对象</span></span><br><span class="line">        <span class="comment">// 返回值: 创建成功的部门对象</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Create</span>(<span class="params">Department department</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> department;  <span class="comment">// 返回创建的部门对象</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除指定部门(HTTP POST方法)</span></span><br><span class="line">        <span class="comment">// 参数: id - 可空部门ID</span></span><br><span class="line">        <span class="comment">// 返回值: 删除操作结果信息字符串</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Deleted department: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回删除操作结果</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 编辑指定部门(HTTP POST方法)</span></span><br><span class="line">        <span class="comment">// 参数: id - 可空部门ID</span></span><br><span class="line">        <span class="comment">// 返回值: 编辑操作结果信息字符串</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Edit</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;Updated department: <span class="subst">&#123;id&#125;</span>&quot;</span>;  <span class="comment">// 返回编辑操作结果</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Program.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);  <span class="comment">// 创建Web应用构建器，加载配置参数</span></span><br><span class="line"></span><br><span class="line">builder.Services.AddControllers();  <span class="comment">// 添加MVC控制器服务到依赖注入容器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();  <span class="comment">// 构建Web应用程序实例</span></span><br><span class="line"></span><br><span class="line">app.UseRouting();  <span class="comment">// 启用路由中间件，用于请求路由匹配</span></span><br><span class="line"></span><br><span class="line">app.UseEndpoints(endpoints =&gt;  <span class="comment">// 配置端点路由</span></span><br><span class="line">&#123;</span><br><span class="line">    endpoints.MapControllerRoute(  <span class="comment">// 映射控制器路由</span></span><br><span class="line">        name: <span class="string">&quot;default&quot;</span>,  <span class="comment">// 路由名称</span></span><br><span class="line">        pattern: <span class="string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>  <span class="comment">// 默认路由模板</span></span><br><span class="line">                                                           <span class="comment">// 格式说明：&#123;控制器=默认值&#125;/&#123;动作=默认值&#125;/&#123;可选ID参数&#125;</span></span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();  <span class="comment">// 启动应用程序，开始监听HTTP请求</span></span><br></pre></td></tr></table></figure>

<p>数据依据表单、查询字符串等内容进行自动解析、映射、匹配。但不能将复杂类型绑定到HTTP的Header中。</p>
<p><img src="/2025/04/14/NET-ASP-08/image-20250415104124551.png" alt="image-20250415104124551"></p>
<h1 id="5、模型绑定优先级"><a href="#5、模型绑定优先级" class="headerlink" title="5、模型绑定优先级"></a>5、模型绑定优先级</h1><p>ASP.NET Core 中的控制器模型绑定源优先级（Model Binding in controllers: Binding source priorities）是一个明确规定了请求数据来源解析顺序的机制。当控制器动作方法需要绑定参数时，框架会按照固定优先级顺序尝试从不同数据源获取值。以下是基于图片的详细解析：</p>
<hr>
<h3 id="1-模型绑定基础"><a href="#1-模型绑定基础" class="headerlink" title="1.模型绑定基础"></a>1.模型绑定基础</h3><p>模型绑定（Model Binding）是 ASP.NET Core 将 HTTP 请求中的数据（如路由参数、查询字符串、表单字段等）自动映射到控制器方法参数或模型对象的过程。<strong>绑定源优先级</strong>决定了当多个数据源存在同名参数时，框架优先选择哪一个来源的值。</p>
<hr>
<h3 id="2-绑定源优先级层级（从高到低）"><a href="#2-绑定源优先级层级（从高到低）" class="headerlink" title="2.绑定源优先级层级（从高到低）"></a>2.绑定源优先级层级（从高到低）</h3><ol>
<li><p><strong>Explicit (显式指定)</strong><br>通过特性（如 <code>[FromQuery]</code>, <code>[FromBody]</code>, <code>[FromRoute]</code> 等）明确指定参数来源时，优先级最高。<br>​<strong>​示例​</strong>​：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetUser</span>(<span class="params">[FromRoute] <span class="built_in">int</span> id</span>)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>BindAsync 接口</strong><br>如果参数类型实现了 <code>IBindableFromHttpContext&lt;T&gt;.BindAsync</code> 接口，框架会调用此方法进行绑定（常见于自定义复杂类型）。</p>
</li>
<li><p><strong>表单字段绑定（Form Fields）</strong><br>支持将任意类型（简单或复杂）绑定到 HTTP POST 请求的 <code>Form</code> 数据（<code>application/x-www-form-urlencoded</code> 或 <code>multipart/form-data</code>）。</p>
</li>
<li><p><strong>简单类型绑定到路由参数</strong><br>当参数为简单类型（如 <code>int</code>, <code>string</code>）且未显式指定来源时，默认优先从路由参数（URL Path）中获取值。</p>
</li>
<li><p><strong>查询字符串绑定（Query String）</strong><br>若参数未通过上述方式获取，框架会尝试从 URL 的查询字符串（Query String）中解析值。</p>
</li>
<li><p><strong>数组绑定到查询字符串或 Headers</strong><br>特殊场景：当参数是数组类型时，会尝试从查询字符串或 HTTP 请求头（Headers）中解析值。</p>
</li>
</ol>
<hr>
<h3 id="3-关键规则与场景"><a href="#3-关键规则与场景" class="headerlink" title="3.关键规则与场景"></a>3.关键规则与场景</h3><ol>
<li><strong>显式优先于隐式</strong><br>使用 <code>[From*]</code> 特性时，无论优先级层级如何，都会直接采用指定来源的数据。</li>
<li><strong>复杂对象绑定逻辑</strong><br>对于复杂类型（如 DTO 对象），默认会从表单字段、请求体（Body）或路由参数中按优先级组合绑定属性。</li>
<li><strong>冲突处理</strong><br>当多个来源存在同名参数时（如路由参数和查询字符串同名），优先级高的来源会覆盖低优先级的值。</li>
</ol>
<hr>
<h3 id="4-开发注意事项"><a href="#4-开发注意事项" class="headerlink" title="4.开发注意事项"></a>4.开发注意事项</h3><ul>
<li><strong>避免歧义</strong>：建议显式指定参数来源（如 <code>[FromQuery]</code>），提高代码可读性并避免意外绑定行为。</li>
<li><strong>性能优化</strong>：高频使用的参数优先通过路由或查询字符串传递，避免频繁解析请求体。</li>
<li><strong>数组处理</strong>：数组绑定需遵循格式（如 <code>?ids=1&amp;ids=2</code> 或 <code>X-Array-Header: [1,2,3]</code>）。</li>
</ul>
<hr>
<p><img src="/2025/04/14/NET-ASP-08/image-20250415110756562.png" alt="image-20250415110756562"></p>
<h1 id="6、模型输入格式"><a href="#6、模型输入格式" class="headerlink" title="6、模型输入格式"></a>6、模型输入格式</h1><p>默认情况下只能输入Json格式的数据，如果想输入其他数据，例如XML则需要指定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 创建新部门(HTTP POST方法)</span><br><span class="line">// 参数: department - 部门实体对象</span><br><span class="line">// 返回值: 创建成功的部门对象</span><br><span class="line">[HttpPost]</span><br><span class="line">public object Create([FromBody]Department department)</span><br><span class="line">&#123;</span><br><span class="line">    return department;  // 返回创建的部门对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Program.cs</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Web应用程序构建器实例，并加载配置参数</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加MVC控制器服务到依赖注入容器，并支持XML序列化格式</span></span><br><span class="line">builder.Services.AddControllers()</span><br><span class="line">    .AddXmlSerializerFormatters();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建Web应用程序实例</span></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用请求路由中间件，用于匹配请求路径到对应的控制器和Action</span></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置应用程序的终结点路由</span></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 映射默认控制器路由</span></span><br><span class="line">    endpoints.MapControllerRoute(</span><br><span class="line">        name: <span class="string">&quot;default&quot;</span>,  <span class="comment">// 路由名称标识</span></span><br><span class="line">        pattern: <span class="string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>  <span class="comment">// 路由模板格式。模板说明： &#123;controller&#125; - 控制器名称，默认为Home；&#123;action&#125; - Action方法名称，默认为Index；&#123;id?&#125; - 可选参数，可省略</span></span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动应用程序，开始监听HTTP请求</span></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415204158975.png" alt="image-20250415204158975"></p>
<h1 id="7、模型状态"><a href="#7、模型状态" class="headerlink" title="7、模型状态"></a>7、模型状态</h1><p>如果缺少某些内容或者参数不正确，该状态下的代码并不会报错，而是可以继续运行，这并不正确。</p>
<p>通过继承Controller基类从而利用框架，便可以通过ModelState判断控制错误。</p>
<p><img src="/2025/04/14/NET-ASP-08/image-20250415205726084.png" alt="image-20250415205726084"></p>
<p><img src="/2025/04/14/NET-ASP-08/image-20250415210116949.png" alt="image-20250415210116949"></p>
<p>但如果设定为<code>[ApiController]</code>则会立即报错。</p>
<p><img src="/2025/04/14/NET-ASP-08/image-20250415210549765.png" alt="image-20250415210549765"></p>
<h1 id="8、MVC-结果处理"><a href="#8、MVC-结果处理" class="headerlink" title="8、MVC-结果处理"></a>8、MVC-结果处理</h1><p>在 ASP.NET Core 中，<strong>Action Result（动作结果）</strong> 代表控制器操作返回的不同类型的 HTTP 响应。根据你提供的图片信息，这里是对以下几种常见的 Action Result 的解析：</p>
<p><strong>1. ViewResult</strong></p>
<p><strong>用于返回 HTML 视图页面</strong>（通常用于 MVC 应用）。它会渲染 Razor 视图，并将数据传递给前端页面。 示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Index</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> View(); <span class="comment">// 这里会返回 Views/Index.cshtml</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>💡 <strong>适用场景</strong>：当你需要返回完整的 HTML 视图给客户端时，例如网页 UI。</p>
<p><strong>2. ContentResult</strong></p>
<p><strong>用于返回纯文本或 HTML 片段</strong>，而不是完整的视图页面。可以指定返回的内容类型（如 <code>text/plain</code> 或 <code>text/html</code>）。 示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">SimpleText</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> Content(<span class="string">&quot;Hello, this is plain text!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>💡 <strong>适用场景</strong>：当你需要返回一个简单的字符串（例如 API 返回消息），而不涉及视图渲染。</p>
<p><strong>3. JsonResult</strong></p>
<p><strong>用于返回 JSON 数据</strong>，特别适用于 Web API。它会自动将对象序列化为 JSON 格式。 示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetData</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> product = <span class="keyword">new</span> &#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;Laptop&quot;</span>, Price = <span class="number">999.99</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> Json(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>💡 <strong>适用场景</strong>：用于 API 或 AJAX 请求，需要返回 JSON 结构化数据给前端。</p>
<p><strong>4. FileResult</strong></p>
<p><strong>用于返回文件作为 HTTP 响应</strong>（如 PDF、图片、Excel）。它允许客户端下载或显示文件内容。 示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">DownloadFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> filePath = <span class="string">&quot;wwwroot/files/sample.pdf&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> fileBytes = System.IO.File.ReadAllBytes(filePath);</span><br><span class="line">    <span class="keyword">return</span> File(fileBytes, <span class="string">&quot;application/pdf&quot;</span>, <span class="string">&quot;download.pdf&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>💡 <strong>适用场景</strong>：当你需要提供文件下载或直接展示文件时。</p>
<p><strong>5. Redirect Results</strong></p>
<p><strong>用于执行页面重定向</strong>。ASP.NET 提供多种重定向方式：</p>
<ul>
<li><strong><code>Redirect()</code></strong>：临时重定向（302）</li>
<li><strong><code>RedirectPermanent()</code></strong>：永久重定向（301）</li>
<li><strong><code>RedirectToAction()</code></strong>：重定向到控制器的另一个操作</li>
<li><strong><code>RedirectToRoute()</code></strong>：重定向到特定的路由</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">RedirectExample</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> Redirect(<span class="string">&quot;https://example.com&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>💡 <strong>适用场景</strong>：当你希望用户访问另一个 URL，比如登录后跳转到首页。</p>
<p><strong>总结</strong></p>
<p>这些不同类型的 <strong>Action Result</strong> 提供了灵活的 HTTP 响应方式：</p>
<ul>
<li><strong>ViewResult</strong> → 适用于 MVC 视图返回</li>
<li><strong>ContentResult</strong> → 适用于返回纯文本数据</li>
<li><strong>JsonResult</strong> → 适用于 JSON 数据 API</li>
<li><strong>FileResult</strong> → 适用于文件下载</li>
<li><strong>Redirect Results</strong> → 适用于页面跳转</li>
</ul>
<h2 id="1、ContentResult"><a href="#1、ContentResult" class="headerlink" title="1、ContentResult"></a>1、ContentResult</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContentResult - 返回纯文本或 HTML 片段</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Index</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ContentResult</span><br><span class="line">    &#123;</span><br><span class="line">        Content = <span class="string">&quot;&lt;h1&gt;Departments&lt;/h1&gt; Welcome to the departments page!&quot;</span>,</span><br><span class="line">        ContentType = <span class="string">&quot;text/html&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Index</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> Content(<span class="string">&quot;&lt;h1&gt;Departments&lt;/h1&gt; Welcome to the departments page!&quot;</span>, <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415211928799.png" alt="image-20250415211928799"></p>
<h2 id="2、JsonResult"><a href="#2、JsonResult" class="headerlink" title="2、JsonResult"></a>2、JsonResult</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Department &#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;sss&quot;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> JsonResult(<span class="keyword">new</span> Department &#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;sss&quot;</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Json(<span class="keyword">new</span> Department &#123; Id = <span class="number">1</span>, Name = <span class="string">&quot;sss&quot;</span> &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<figure>
<style>.ryvmlofpqsui{}</style><img src="/2025/04/14/NET-ASP-08/image-20250415212406375.png" class="ryvmlofpqsui">
<style>.qbogdkxtnrqo{}</style><img src="/2025/04/14/NET-ASP-08/image-20250415212528027.png" class="qbogdkxtnrqo">
</figure>
</center>

<h2 id="3、FileResult"><a href="#3、FileResult" class="headerlink" title="3、FileResult"></a>3、FileResult</h2><p><strong>关于文件结果类型</strong></p>
<p><img src="/2025/04/14/NET-ASP-08/image-20250415213226455.png" alt="image-20250415213226455"></p>
<p>ASP.NET Core 提供了三种主要的文件结果类型，可以根据文件的存储方式和访问需求，返回不同类型的文件响应：</p>
<ol>
<li><p><strong>VirtualFileResult</strong></p>
<ul>
<li>用于返回存储在 <code>wwwroot</code> 目录中的文件。该目录是 ASP.NET Core 的默认静态文件目录。</li>
<li>适用于应用程序的静态文件（如图片、CSS 文件）。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetVirtualFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> File(<span class="string">&quot;~/wwwroot/files/sample.pdf&quot;</span>, <span class="string">&quot;application/pdf&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>PhysicalFileResult</strong></p>
<ul>
<li>用于返回存储在 <code>wwwroot</code> 之外的文件。这些文件可能存储在服务器的任意路径中，但需要开发者确保文件路径的正确性和安全性。</li>
<li>适合返回服务器上的私有文件。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetPhysicalFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> filePath = Path.Combine(Directory.GetCurrentDirectory(), <span class="string">&quot;files/sample.pdf&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> PhysicalFile(filePath, <span class="string">&quot;application/pdf&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>FileContentResult</strong></p>
<ul>
<li>用于直接从内存中返回文件内容，而无需依赖物理文件。这种方式适合返回动态生成的文件数据或只存储在内存中的内容。</li>
<li>适用于生成临时文件或二进制内容。</li>
</ul>
<p>示例：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetFileContent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">byte</span>[] fileContent = System.IO.File.ReadAllBytes(<span class="string">&quot;files/sample.pdf&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> File(fileContent, <span class="string">&quot;application/pdf&quot;</span>, <span class="string">&quot;download.pdf&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>总结</strong></p>
<p>通过以上文件结果类型，ASP.NET Core 提供了灵活的文件响应机制，允许开发者根据文件的存储位置和访问方式选择适合的结果类型：</p>
<ul>
<li><strong>VirtualFileResult</strong> → 针对 <code>wwwroot</code> 的静态文件。</li>
<li><strong>PhysicalFileResult</strong> → 服务器中任何文件。</li>
<li><strong>FileContentResult</strong> → 内存中的动态文件数据。</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理虚拟文件下载请求的路由</span></span><br><span class="line"><span class="comment">// 路由地址：/download_vf</span></span><br><span class="line"><span class="comment">// 返回：从wwwroot目录返回的文本文件</span></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;/download_vf&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReturnVirtualFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 文件必须存在于wwwroot目录下</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span>  VirtualFileResult(<span class="string">&quot;/readme.txt&quot;</span>, <span class="string">&quot;text/plain&quot;</span>);  <span class="comment">// 返回虚拟文件结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理虚拟文件下载请求的路由</span></span><br><span class="line"><span class="comment">// 路由地址：/download_vf</span></span><br><span class="line"><span class="comment">// 返回：从wwwroot目录返回的文本文件</span></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;/download_vf&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReturnVirtualFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 文件必须存在于wwwroot目录下</span></span><br><span class="line">    <span class="keyword">return</span> File(<span class="string">&quot;/readme.txt&quot;</span>, <span class="string">&quot;text/plain&quot;</span>);  <span class="comment">// 返回虚拟文件结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415214127991.png" alt="image-20250415214127991"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理物理文件下载请求的路由</span></span><br><span class="line"><span class="comment">// 路由地址：/download_pf</span></span><br><span class="line"><span class="comment">// 返回：从物理路径返回的PDF文件</span></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;/download_pf&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReturnPhysicalFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> PhysicalFile(<span class="string">@&quot;E:\Programming\C#\LearnMVCControllers\WebApp\wwwroot\readme.txt&quot;</span>, <span class="string">&quot;application/pdf&quot;</span>);  <span class="comment">// 返回物理文件结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理物理文件下载请求的路由</span></span><br><span class="line"><span class="comment">// 路由地址：/download_pf</span></span><br><span class="line"><span class="comment">// 返回：从物理路径返回的PDF文件</span></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;/download_pf&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReturnPhysicalFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PhysicalFileResult(<span class="string">@&quot;E:\Programming\C#\LearnMVCControllers\WebApp\wwwroot\readme.txt&quot;</span>, <span class="string">&quot;application/pdf&quot;</span>);  <span class="comment">// 返回物理文件结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415214315606.png" alt="image-20250415214315606"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理字节流文件下载请求的路由</span></span><br><span class="line"><span class="comment">// 路由地址：/download_cf</span></span><br><span class="line"><span class="comment">// 返回：以字节流形式返回的PDF文件</span></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;/download_cf&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReturnContentFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">byte</span>[] bytes = System.IO.File.ReadAllBytes(<span class="string">@&quot;E:\Programming\C#\LearnMVCControllers\WebApp\wwwroot\readme.txt&quot;</span>);  <span class="comment">// 读取文件字节</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> File(bytes, <span class="string">&quot;application/pdf&quot;</span>);  <span class="comment">// 返回字节流文件结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理字节流文件下载请求的路由</span></span><br><span class="line"><span class="comment">// 路由地址：/download_cf</span></span><br><span class="line"><span class="comment">// 返回：以字节流形式返回的PDF文件</span></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;/download_cf&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReturnContentFile</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">byte</span>[] bytes = System.IO.File.ReadAllBytes(<span class="string">@&quot;E:\Programming\C#\LearnMVCControllers\WebApp\wwwroot\readme.txt&quot;</span>);  <span class="comment">// 读取文件字节</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FileContentResult(bytes, <span class="string">&quot;application/pdf&quot;</span>);  <span class="comment">// 返回字节流文件结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415214412641.png" alt="image-20250415214412641"></p>
<h2 id="4、Redirect-Results"><a href="#4、Redirect-Results" class="headerlink" title="4、Redirect Results"></a>4、Redirect Results</h2><p>图片中的内容展示的是与 ASP.NET Core MVC 框架中 <strong>重定向结果</strong>（Redirect Results）相关的三种常见类型，标题为 “Producing Results: Redirect Results”。下面我将详细介绍每一种重定向结果，并探讨它们各自的应用场景和背后的意义：</p>
<ol>
<li><p><strong>RedirectToActionResult</strong><br> 这种结果类型主要用于在控制器中重定向到另一个动作方法（action）。当你处理完当前请求后，可能需要将用户导航到另一处逻辑上更适合处理后续操作的地方，例如转入另一控制器的动作或返回一个成功提示页面。在这种情况下，利用 <code>RedirectToActionResult</code>，你可以仅指定目标动作的方法名、控制器名称以及必要的路由参数，利用路由系统自动生成正确的 URL，从而避免硬编码 URL 的风险和维护问题。例如，在完成一个表单提交后，使用这种结果可以让用户跳转到一个“操作成功”的页面，同时确保路由的灵活性和一致性。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyApp.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HomeController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 默认页面：完成操作后重定向到 Success 动作</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Index</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 执行完相关逻辑后重定向到 Success 动作</span></span><br><span class="line">            <span class="keyword">return</span> RedirectToAction(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Success</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            ViewBag.Message = <span class="string">&quot;操作成功！&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> View();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>LocalRedirectResult</strong><br> 这种结果在安全性上更为严格，当需要重定向到一个“本地” URL 时使用。所谓“本地”指的是同一应用内部的页面或资源。通过使用 <code>LocalRedirectResult</code>，可以有效防范开放重定向攻击——也就是防止恶意用户利用重定向漏洞，将用户诱导到外部危险或恶意网站。系统在执行重定向时，会先验证目标 URL 是否是应用内部允许的地址，只有符合条件的 URL 才会被接受。如果验证失败，通常会抛出异常或者返回错误信息，从而保护应用和用户双方的安全。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyApp.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AccountController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Login</span>(<span class="params"><span class="built_in">string</span> returnUrl</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 验证 returnUrl 是否为本地 URL</span></span><br><span class="line">            <span class="keyword">if</span> (!Url.IsLocalUrl(returnUrl))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 非本地 URL时，可以重定向到一个安全的默认页面</span></span><br><span class="line">                <span class="keyword">return</span> RedirectToAction(<span class="string">&quot;Index&quot;</span>, <span class="string">&quot;Home&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 安全跳转到传入的本地 URL</span></span><br><span class="line">            <span class="keyword">return</span> LocalRedirect(returnUrl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>RedirectResult</strong><br> 这是最基础和直接的重定向类型，它接受一个明确的 URL 字符串作为目标地址，并立即向客户端发出重定向指令。与 <code>RedirectToActionResult</code> 不同，<code>RedirectResult</code> 不会处理控制器或路由信息，它适用于那些 URL 已经确定且无需依赖应用内路由配置的情况。虽然它提供了很高的灵活性，允许跳转到完全任意的地址，但这也要求开发者自己确保目标 URL 的正确性和安全性，否则可能会引入重定向漏洞。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyApp.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HomeController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">ExternalRedirect</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 重定向到外部 URL</span></span><br><span class="line">            <span class="keyword">return</span> Redirect(<span class="string">&quot;https://www.example.com&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>EmployeesController</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入ASP.NET Core MVC框架的核心功能</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义控制器所在的命名空间</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 员工控制器类，继承自Controller基类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EmployeesController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// GET请求处理方法：根据部门ID获取员工列表</span></span><br><span class="line">        <span class="comment">// 参数：</span></span><br><span class="line">        <span class="comment">//   departmentId - 从路由中获取的部门ID（路由参数名为&quot;id&quot;）</span></span><br><span class="line">        <span class="comment">// 返回：包含部门ID的文本内容</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">GetEmployeesByDepartment</span>(<span class="params">[FromRoute(Name = <span class="string">&quot;id&quot;</span></span>)] <span class="built_in">int</span> departmentId)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 返回文本内容，显示正在加载指定部门的员工</span></span><br><span class="line">            <span class="keyword">return</span> Content(<span class="string">$&quot;Loading employees under department: <span class="subst">&#123;departmentId&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedirectToActionResult</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理部门详情的GET请求</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//   id - 可空的部门ID</span></span><br><span class="line"><span class="comment">// 返回：重定向到Employees控制器的GetEmployeesByDepartment方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用RedirectToActionResult进行重定向</span></span><br><span class="line">    <span class="comment">// 参数说明：</span></span><br><span class="line">    <span class="comment">//   1. &quot;GetEmployeesByDepartment&quot; - 目标Action名称</span></span><br><span class="line">    <span class="comment">//   2. &quot;Employees&quot; - 目标控制器名称</span></span><br><span class="line">    <span class="comment">//   3. new &#123; id=id &#125; - 传递的路由参数(将当前id传递给目标Action)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RedirectToActionResult(<span class="string">&quot;GetEmployeesByDepartment&quot;</span>, <span class="string">&quot;Employees&quot;</span>, <span class="keyword">new</span> &#123; id=id&#125; );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理部门详情的GET请求</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//   id - 可空的部门ID</span></span><br><span class="line"><span class="comment">// 返回：重定向到Employees控制器的GetEmployeesByDepartment方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用RedirectToActionResult进行重定向</span></span><br><span class="line">    <span class="comment">// 参数说明：</span></span><br><span class="line">    <span class="comment">//   1. &quot;GetEmployeesByDepartment&quot; - 目标Action名称</span></span><br><span class="line">    <span class="comment">//   2. &quot;Employees&quot; - 目标控制器名称</span></span><br><span class="line">    <span class="comment">//   3. new &#123; id=id &#125; - 传递的路由参数(将当前id传递给目标Action)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RedirectToAction(<span class="string">&quot;GetEmployeesByDepartment&quot;</span>, <span class="string">&quot;Employees&quot;</span>, <span class="keyword">new</span> &#123; id=id&#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415220944977.png" alt="image-20250415220944977"></p>
<p>LocalRedirectResult</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理部门详情的GET请求</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//   id - 可选的部门ID（可为null）</span></span><br><span class="line"><span class="comment">// 返回：本地重定向到员工控制器下的GetEmployeesByDepartment方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用LocalRedirectResult进行本地重定向</span></span><br><span class="line">    <span class="comment">// 重定向路径格式：/employees/GetEmployeesByDepartment/&#123;id&#125;</span></span><br><span class="line">    <span class="comment">// 会将当前部门ID作为参数传递给目标Action</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LocalRedirectResult(<span class="string">$&quot;/employees/GetEmployeesByDepartment/<span class="subst">&#123;id&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理部门详情的GET请求</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//   id - 可选的部门ID（可为null）</span></span><br><span class="line"><span class="comment">// 返回：本地重定向到员工控制器下的GetEmployeesByDepartment方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用LocalRedirectResult进行本地重定向</span></span><br><span class="line">    <span class="comment">// 重定向路径格式：/employees/GetEmployeesByDepartment/&#123;id&#125;</span></span><br><span class="line">    <span class="comment">// 会将当前部门ID作为参数传递给目标Action</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LocalRedirect(<span class="string">$&quot;/employees/GetEmployeesByDepartment/<span class="subst">&#123;id&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedirectResult</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理部门详情的GET请求</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//   id - 可选的部门ID参数（可为null）</span></span><br><span class="line"><span class="comment">// 返回：重定向到百度首页的外部链接</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用RedirectResult进行外部重定向</span></span><br><span class="line">    <span class="comment">// 重定向目标：百度首页(https://www.baidu.com)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RedirectResult(<span class="string">&quot;https://www.baidu.com&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理部门详情的GET请求</span></span><br><span class="line"><span class="comment">// 参数：</span></span><br><span class="line"><span class="comment">//   id - 可选的部门ID参数（可为null）</span></span><br><span class="line"><span class="comment">// 返回：重定向到百度首页的外部链接</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span>? id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用RedirectResult进行外部重定向</span></span><br><span class="line">    <span class="comment">// 重定向目标：百度首页(https://www.baidu.com)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Redirect(<span class="string">&quot;https://www.baidu.com&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9、重构学习代码"><a href="#9、重构学习代码" class="headerlink" title="9、重构学习代码"></a>9、重构学习代码</h1><h2 id="1-Department"><a href="#1-Department" class="headerlink" title="1.Department"></a>1.Department</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入必要的命名空间</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;  <span class="comment">// 提供MVC相关功能</span></span><br><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations;  <span class="comment">// 提供数据验证特性</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 部门实体类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Department</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 默认无参构造函数</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Department</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 初始化逻辑可以放在这里</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 带参数的构造函数</span></span><br><span class="line">        <span class="comment">// 参数：</span></span><br><span class="line">        <span class="comment">//   id - 部门ID</span></span><br><span class="line">        <span class="comment">//   name - 部门名称</span></span><br><span class="line">        <span class="comment">//   description - 部门描述（可选参数，默认为空字符串）</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Department</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">string</span> name, <span class="built_in">string</span>? description = <span class="string">&quot;&quot;</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.Id = id;</span><br><span class="line">            <span class="keyword">this</span>.Name = name;</span><br><span class="line">            <span class="keyword">this</span>.Description = description;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 部门ID属性</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 部门名称属性</span></span><br><span class="line">        <span class="comment">// 使用[Required]特性表示该字段为必填项</span></span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span>? Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 部门描述属性</span></span><br><span class="line">        <span class="comment">// 使用[StringLength]特性限制最大长度为500个字符</span></span><br><span class="line">        [<span class="meta">StringLength(500)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span>? Description &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-DepartmentsRepository"><a href="#2-DepartmentsRepository" class="headerlink" title="2.DepartmentsRepository"></a>2.DepartmentsRepository</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Xml.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 部门数据仓库类，提供部门数据的静态存储和CRUD操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">DepartmentsRepository</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化部门数据列表</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Department&gt; Departments = <span class="keyword">new</span> List&lt;Department&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Department(<span class="number">1</span>, <span class="string">&quot;Sales&quot;</span>, <span class="string">&quot;销售部门&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> Department(<span class="number">2</span>, <span class="string">&quot;Engineering&quot;</span>, <span class="string">&quot;工程部门&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> Department(<span class="number">3</span>, <span class="string">&quot;QA&quot;</span>, <span class="string">&quot;质量保证部门&quot;</span>)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取所有部门列表</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Department&gt; <span class="title">GetDepartments</span>()</span> =&gt; Departments;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据ID获取单个部门</span></span><br><span class="line">        <span class="comment">// 参数：id - 部门ID</span></span><br><span class="line">        <span class="comment">// 返回值：匹配的部门对象，未找到返回null</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Department? GetDepartmentById(<span class="built_in">int</span> id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Departments.FirstOrDefault(x =&gt; x.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加新部门</span></span><br><span class="line">        <span class="comment">// 参数：Department - 要添加的部门对象</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddDepartment</span>(<span class="params">Department? Department</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Department <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 自动生成新ID（当前最大ID+1）</span></span><br><span class="line">                <span class="built_in">int</span> maxId = Departments.Max(x =&gt; x.Id);</span><br><span class="line">                Department.Id = maxId + <span class="number">1</span>;</span><br><span class="line">                Departments.Add(Department);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新部门信息</span></span><br><span class="line">        <span class="comment">// 参数：Department - 包含更新数据的部门对象</span></span><br><span class="line">        <span class="comment">// 返回值：更新成功返回true，失败返回false</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">UpdateDepartment</span>(<span class="params">Department? Department</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Department <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 查找要更新的部门</span></span><br><span class="line">                <span class="keyword">var</span> emp = Departments.FirstOrDefault(x =&gt; x.Id == Department.Id);</span><br><span class="line">                <span class="keyword">if</span> (emp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 更新部门信息</span></span><br><span class="line">                    emp.Name = Department.Name;</span><br><span class="line">                    emp.Description = Department.Description;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除部门</span></span><br><span class="line">        <span class="comment">// 参数：Department - 要删除的部门对象</span></span><br><span class="line">        <span class="comment">// 返回值：删除成功返回true，失败返回false</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">DeleteDepartment</span>(<span class="params">Department? Department</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Department <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Departments.Remove(Department);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-DepartmentsController"><a href="#3-DepartmentsController" class="headerlink" title="3.DepartmentsController"></a>3.DepartmentsController</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> WebApp.Models;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">static</span> System.Net.Mime.MediaTypeNames;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 部门控制器，处理部门相关的HTTP请求</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DepartmentsController</span> : <span class="title">Controller</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// GET请求：显示所有部门列表</span></span><br><span class="line">        [<span class="meta">HttpGet</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Index</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取所有部门数据</span></span><br><span class="line">            <span class="keyword">var</span> departments = DepartmentsRepository.GetDepartments();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生成HTML列表页面</span></span><br><span class="line">            <span class="keyword">var</span> html = <span class="string">$@&quot;</span></span><br><span class="line"><span class="string">                    &lt;h1&gt;部门列表&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                    &lt;ul&gt;</span></span><br><span class="line"><span class="string">                        <span class="subst">&#123;<span class="built_in">string</span>.Join(<span class="string">&quot;&quot;</span>, departments.Select(x =&gt; <span class="string">$@&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                                    &lt;li&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                                        &lt;a href=&#x27;/departments/details/<span class="subst">&#123;x.Id&#125;</span>&#x27;&gt;<span class="subst">&#123;x.Name&#125;</span> (<span class="subst">&#123;x.Description&#125;</span>)&lt;/a&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                                    &lt;/li&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                                &quot;</span>))&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;br/&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&#x27;/departments/create&#x27;&gt;添加部门&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Content(html, <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// GET请求：显示部门详情</span></span><br><span class="line">        [<span class="meta">HttpGet</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Details</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 根据ID获取部门</span></span><br><span class="line">            <span class="keyword">var</span> department = DepartmentsRepository.GetDepartmentById(id);</span><br><span class="line">            <span class="keyword">if</span> (department == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Content(<span class="string">&quot;&lt;h3 style=&#x27;color: red&#x27;&gt;部门未找到&lt;/h3&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生成部门详情编辑表单</span></span><br><span class="line">            <span class="keyword">var</span> html = <span class="string">$@&quot;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;部门详情&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;form method=&#x27;post&#x27; action=&#x27;/departments/edit&#x27;&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=&#x27;hidden&#x27; name=&#x27;Id&#x27; value=&#x27;<span class="subst">&#123;department.Id&#125;</span>&#x27; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;label&gt;名称: &lt;input type=&#x27;text&#x27; name=&#x27;Name&#x27; value=&#x27;<span class="subst">&#123;department.Name&#125;</span>&#x27; /&gt;&lt;/label&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">                    &lt;label&gt;描述: &lt;input type=&#x27;text&#x27; name=&#x27;Description&#x27; value=&#x27;<span class="subst">&#123;department.Description&#125;</span>&#x27; /&gt;&lt;/label&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">                    &lt;br/&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&#x27;/departments&#x27;&gt;取消&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;button type=&#x27;submit&#x27;&gt;更新&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;form method=&#x27;post&#x27; action=&#x27;/departments/delete/<span class="subst">&#123;department.Id&#125;</span>&#x27;&gt;</span></span><br><span class="line"><span class="string">                    &lt;button type=&#x27;submit&#x27; style=&#x27;background-color:red;color:white&#x27;&gt;删除&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Content(html, <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// POST请求：更新部门信息</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Edit</span>(<span class="params">Department department</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 验证模型状态</span></span><br><span class="line">            <span class="keyword">if</span> (!ModelState.IsValid)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Content(GetErrorsHTML(), <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新部门信息</span></span><br><span class="line">            DepartmentsRepository.UpdateDepartment(department);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 重定向到部门列表</span></span><br><span class="line">            <span class="keyword">return</span> RedirectToAction(<span class="keyword">nameof</span>(Index));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// GET请求：显示添加部门表单</span></span><br><span class="line">        [<span class="meta">HttpGet</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Create</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 生成添加部门表单</span></span><br><span class="line">            <span class="keyword">var</span> html = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;添加部门&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;form method=&#x27;post&#x27; action=&#x27;/departments/create&#x27;&gt;</span></span><br><span class="line"><span class="string">                    &lt;label&gt;名称: &lt;input type=&#x27;text&#x27; name=&#x27;Name&#x27; /&gt;&lt;/label&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">                    &lt;label&gt;描述: &lt;input type=&#x27;text&#x27; name=&#x27;Description&#x27; /&gt;&lt;/label&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">                    &lt;br/&gt;</span></span><br><span class="line"><span class="string">                    &lt;button type=&#x27;submit&#x27;&gt;添加&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Content(html, <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// POST请求：创建新部门</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Create</span>(<span class="params">Department department</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 验证模型状态</span></span><br><span class="line">            <span class="keyword">if</span> (!ModelState.IsValid)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Content(GetErrorsHTML(), <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 添加新部门</span></span><br><span class="line">            DepartmentsRepository.AddDepartment(department);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 重定向到部门列表</span></span><br><span class="line">            <span class="keyword">return</span> RedirectToAction(<span class="keyword">nameof</span>(Index));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// POST请求：删除部门</span></span><br><span class="line">        [<span class="meta">HttpPost</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取要删除的部门</span></span><br><span class="line">            <span class="keyword">var</span> department = DepartmentsRepository.GetDepartmentById(id);</span><br><span class="line">            <span class="keyword">if</span> (department == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ModelState.AddModelError(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;部门未找到&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> Content(GetErrorsHTML(), <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 删除部门</span></span><br><span class="line">            DepartmentsRepository.DeleteDepartment(department);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 重定向到部门列表</span></span><br><span class="line">            <span class="keyword">return</span> RedirectToAction(<span class="keyword">nameof</span>(Index));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取模型验证错误信息并生成HTML</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">GetErrorsHTML</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; errorMessages = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> <span class="keyword">value</span> <span class="keyword">in</span> ModelState.Values)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> error <span class="keyword">in</span> <span class="keyword">value</span>.Errors)</span><br><span class="line">                &#123;</span><br><span class="line">                    errorMessages.Add(error.ErrorMessage);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">string</span> html = <span class="built_in">string</span>.Empty;</span><br><span class="line">            <span class="keyword">if</span> (errorMessages.Count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                html = <span class="string">$@&quot;</span></span><br><span class="line"><span class="string">                    &lt;ul&gt;</span></span><br><span class="line"><span class="string">                        <span class="subst">&#123;<span class="built_in">string</span>.Join(<span class="string">&quot;&quot;</span>, errorMessages.Select(error =&gt; <span class="string">$&quot;&lt;li style=&#x27;color:red;&#x27;&gt;<span class="subst">&#123;error&#125;</span>&lt;/li&gt;&quot;</span>))&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Program"><a href="#4-Program" class="headerlink" title="4.Program"></a>4.Program</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Web应用构建器，用于配置和构建Web应用</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向依赖注入容器添加MVC控制器服务</span></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建Web应用实例</span></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启用路由中间件</span></span><br><span class="line">app.UseRouting();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置终结点路由</span></span><br><span class="line">app.UseEndpoints(endpoints =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 映射默认控制器路由</span></span><br><span class="line">    <span class="comment">// 路由模式为: &#123;控制器=Home&#125;/&#123;动作=Index&#125;/&#123;可选参数id&#125;</span></span><br><span class="line">    endpoints.MapControllerRoute(</span><br><span class="line">        name: <span class="string">&quot;default&quot;</span>,  <span class="comment">// 路由名称</span></span><br><span class="line">        pattern: <span class="string">&quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;</span>  <span class="comment">// 路由模板</span></span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动应用程序</span></span><br><span class="line">app.Run();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/14/NET-ASP-08/image-20250415222253570.png" alt="image-20250415222253570"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://alsl521.github.io">kyl</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://alsl521.github.io/2025/04/14/NET-ASP-08/">https://alsl521.github.io/2025/04/14/NET-ASP-08/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://alsl521.github.io" target="_blank">kyl的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C#</a></div><div class="post-share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/14/NET-ASP-07/" title="ASP.NET学习记录-07-代码组织和依赖注入"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">ASP.NET学习记录-07-代码组织和依赖注入</div></div><div class="info-2"><div class="info-item-1">1、代码组织在 ASP.NET 中，“代码组织”指的是如何结构化代码，以提高可维护性、可读性和可扩展性。这涉及多个方面，包括项目结构、分层架构、模块化设计和最佳实践。  项目结构  在 ASP.NET Core 中，一个典型的项目组织方式如下： 12345678910/MyApp ├── Controllers/      // 处理 HTTP 请求的控制器 ├── Models/           // 数据模型 ├── Views/            // Razor 视图（如果使用 MVC） ├── Services/         // 业务逻辑层 ├── Middleware/       // 自定义中间件 ├── Data/             // 数据访问层（EF Core、存储库等） ├── wwwroot/          // 静态文件（CSS、JS、Images） ├── Program.cs        // 应用程序启动入口 ├── appsettings.json  //...</div></div></div></a><a class="pagination-related" href="/2025/04/15/NET-ASP-09/" title="ASP.NET学习记录-09-MVC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">ASP.NET学习记录-09-MVC</div></div><div class="info-2"><div class="info-item-1">1、MVC PatternASP.NET中的MVC（Model-View-Controller）模式是一种软件架构设计模式，它将应用程序分为三个核心组件：模型（Model）、视图（View）和控制器（Controller），以实现关注点分离，提升代码可维护性和可扩展性。  以下是其具体内涵及在ASP.NET中的应用特点： 1....</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/08/NET-ASP-01/" title="ASP.NET学习记录-01-基础知识"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-01-基础知识</div></div><div class="info-2"><div class="info-item-1">视频教程为：ASP.NET Core Deep-Dive in .NET 9 | Udemy 1、.NET Core.NET Core 是微软开发的开源、跨平台应用程序开发框架，旨在为现代云原生、微服务及高性能场景提供支持。以下是其核心特性与定位的详细说明：  一、核心定义与定位 跨平台支持 .NET Core 可在 Windows、Linux、macOS 等操作系统上运行，并支持 x86、x64、ARM 等多种架构。 这种跨平台能力使其成为开发云原生、容器化应用（如 Docker）的理想选择。  开源与社区驱动 作为 MIT 协议下的开源项目，.NET Core 的代码托管于 GitHub，接受社区贡献，确保了技术透明度和快速迭代。    二、架构与技术特性 模块化设计 采用包化（Packages）管理，开发者可按需引用组件，减少应用体积，与传统的 .NET Framework 打包式安装形成对比。例如，通过 1dotnet restore  命令可动态还原依赖的 NuGet 包。  高性能运行时  RyuJIT 编译器：相比传统 JIT，性能提升约 25%，支持 SIMD...</div></div></div></a><a class="pagination-related" href="/2025/04/08/NET-ASP-02/" title="ASP.NET学习记录-02-最小API模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-02-最小API模式</div></div><div class="info-2"><div class="info-item-1">1、创建第一个ASP.NET应用（Minimal API）1.创建新项目 选择新的空项目  设定基本信息  使用最新版.NET作为学习内容  2.项目架构简介与解析 1. 解决方案（Solution） 名称：MyFirstWebApplication 作用： 作为容器管理多个相关项目（当前仅包含一个项目 WebApplication）。 支持团队协作和复杂应用的模块化开发（如Web API、类库、单元测试等）。   关键点： 可通过解决方案配置统一管理所有项目的依赖和环境设置。   新增项目 右键单击解决方案-&gt;添加-&gt;新建项目      2. 项目（Project: WebApplication） 核心结构：包含构建和运行Web应用所需的所有文件与配置，分为以下关键部分：  a. Connected Services 文件夹 作用： 存储与外部服务的连接配置（如数据库、Azure服务、第三方API）。 通过右键添加服务（如Entity Framework、Azure认证），自动生成连接配置文件。   示例：添加Azure...</div></div></div></a><a class="pagination-related" href="/2025/04/08/NET-ASP-03/" title="ASP.NET学习记录-03-中间件管道"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-03-中间件管道</div></div><div class="info-2"><div class="info-item-1">1、中间件管道简介在 C# ASP.NET Core 中，中间件管道是处理 HTTP 请求和响应的核心机制，通过将多个中间件按顺序串联成一个处理流程，实现灵活的请求处理和业务逻辑组合。以下是其核心要点：  1. 中间件管道的基本概念 中间件（Middleware）：是管道中的独立组件，负责处理 HTTP 请求和响应。每个中间件可以：  对请求进行预处理（如日志、身份验证）。  调用下一个中间件（通过 next()），或直接终止处理（短路）。  对响应进行后处理（如修改响应头、记录耗时）。      管道（Pipeline）：由多个中间件按注册顺序串联而成，形成一个“请求→处理→响应”的流程。请求按顺序经过所有中间件，而响应则逆序返回  。    2. 管道的工作模式：1-n 然后 n-1 请求阶段（正向传递）：请求从第一个中间件开始，依次传递至最后一个中间件（终结点），形成“1→2→3”的顺序 。  响应阶段（逆向返回）：处理完成后，响应从终结点开始，逆序返回至第一个中间件，形成“3→2→1”的顺序  。 示例 123Middleware One: Request Start...</div></div></div></a><a class="pagination-related" href="/2025/04/10/NET-ASP-04/" title="ASP.NET学习记录-03-路由"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-10</div><div class="info-item-2">ASP.NET学习记录-03-路由</div></div><div class="info-2"><div class="info-item-1">1、Routing和Endpoints简介在ASP.NET Core中，**路由（Routing）和终结点（Endpoints）**是处理HTTP请求的核心机制，它们共同构成了请求分发的管道系统。以下是对两者的详细介绍：  一、路由（Routing）路由的核心作用是将传入的HTTP请求根据URL路径和HTTP方法匹配到对应的处理逻辑（终结点）。在ASP.NET Core中，路由系统被称为终结点路由（Endpoint Routing）。 主要功能与工作流程 匹配请求：通过UseRouting中间件（即EndpointRoutingMiddleware）扫描应用中所有注册的终结点，根据请求的URL和HTTP方法选择最匹配的终结点 。示例代码：  12345app.UseRouting();app.UseEndpoints(endpoints =&gt; &#123;    endpoints.MapGet(&quot;/&quot;, async context =&gt; &#123; ......</div></div></div></a><a class="pagination-related" href="/2025/04/11/NET-ASP-05/" title="ASP.NET学习记录-05-模型数据绑定"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">ASP.NET学习记录-05-模型数据绑定</div></div><div class="info-2"><div class="info-item-1">1、模型绑定定义模型绑定是ASP.NET Core中将HTTP请求数据自动映射到方法参数或对象属性的机制。其核心工作流程：  数据来源：  路由参数（URL片段） 查询字符串（?key&#x3D;value） 请求体（表单&#x2F;JSON&#x2F;XML） 请求头 文件上传   典型应用：   12345678910111213// 自动绑定路由参数和查询参数[HttpGet(&quot;/products/&#123;id&#125;&quot;)]public IActionResult GetProduct(int id, [FromQuery] string category) &#123;    // id来自路由参数，category来自查询字符串&#125;// 自动绑定JSON请求体[HttpPost]public IActionResult Create([FromBody] Product product)&#123;    //...</div></div></div></a><a class="pagination-related" href="/2025/04/15/NET-ASP-09/" title="ASP.NET学习记录-09-MVC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-15</div><div class="info-item-2">ASP.NET学习记录-09-MVC</div></div><div class="info-2"><div class="info-item-1">1、MVC PatternASP.NET中的MVC（Model-View-Controller）模式是一种软件架构设计模式，它将应用程序分为三个核心组件：模型（Model）、视图（View）和控制器（Controller），以实现关注点分离，提升代码可维护性和可扩展性。  以下是其具体内涵及在ASP.NET中的应用特点： 1....</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">kyl</div><div class="author-info-description">用于记录平时学习的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/alsl521" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:852970167@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFcontroller%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8controller%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">1、什么是controller？为什么用controller？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81MVC-%E5%B1%9E%E6%80%A7%E8%B7%AF%E7%94%B1"><span class="toc-number">2.</span> <span class="toc-text">2、MVC-属性路由</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E7%B1%BB%E6%98%AF%E5%90%A6%E4%B8%BAController"><span class="toc-number">2.1.</span> <span class="toc-text">1、判断一个类是否为Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E4%B8%BAController"><span class="toc-number">2.2.</span> <span class="toc-text">2、注册一个类为Controller</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81MVC-%E4%BC%A0%E7%BB%9F%E8%B7%AF%E7%94%B1"><span class="toc-number">3.</span> <span class="toc-text">3、MVC-传统路由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.</span> <span class="toc-text">5、模型绑定优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A8%A1%E5%9E%8B%E7%BB%91%E5%AE%9A%E5%9F%BA%E7%A1%80"><span class="toc-number">4.0.1.</span> <span class="toc-text">1.模型绑定基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%91%E5%AE%9A%E6%BA%90%E4%BC%98%E5%85%88%E7%BA%A7%E5%B1%82%E7%BA%A7%EF%BC%88%E4%BB%8E%E9%AB%98%E5%88%B0%E4%BD%8E%EF%BC%89"><span class="toc-number">4.0.2.</span> <span class="toc-text">2.绑定源优先级层级（从高到低）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B3%E9%94%AE%E8%A7%84%E5%88%99%E4%B8%8E%E5%9C%BA%E6%99%AF"><span class="toc-number">4.0.3.</span> <span class="toc-text">3.关键规则与场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%BC%80%E5%8F%91%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">4.0.4.</span> <span class="toc-text">4.开发注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81%E6%A8%A1%E5%9E%8B%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">6、模型输入格式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%E3%80%81%E6%A8%A1%E5%9E%8B%E7%8A%B6%E6%80%81"><span class="toc-number">6.</span> <span class="toc-text">7、模型状态</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8%E3%80%81MVC-%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">8、MVC-结果处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81ContentResult"><span class="toc-number">7.1.</span> <span class="toc-text">1、ContentResult</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81JsonResult"><span class="toc-number">7.2.</span> <span class="toc-text">2、JsonResult</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81FileResult"><span class="toc-number">7.3.</span> <span class="toc-text">3、FileResult</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Redirect-Results"><span class="toc-number">7.4.</span> <span class="toc-text">4、Redirect Results</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9%E3%80%81%E9%87%8D%E6%9E%84%E5%AD%A6%E4%B9%A0%E4%BB%A3%E7%A0%81"><span class="toc-number">8.</span> <span class="toc-text">9、重构学习代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Department"><span class="toc-number">8.1.</span> <span class="toc-text">1.Department</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-DepartmentsRepository"><span class="toc-number">8.2.</span> <span class="toc-text">2.DepartmentsRepository</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-DepartmentsController"><span class="toc-number">8.3.</span> <span class="toc-text">3.DepartmentsController</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Program"><span class="toc-number">8.4.</span> <span class="toc-text">4.Program</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/NET-ASP-13/" title="ASP.NET学习记录-13-实践2-数据库进阶">ASP.NET学习记录-13-实践2-数据库进阶</a><time datetime="2025-04-21T08:39:19.000Z" title="发表于 2025-04-21 16:39:19">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/NET-ASP-12/" title="ASP.NET学习记录-12-实践2-使用MySQL数据库">ASP.NET学习记录-12-实践2-使用MySQL数据库</a><time datetime="2025-04-18T08:11:21.000Z" title="发表于 2025-04-18 16:11:21">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/NET-ASP-11/" title="ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API">ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API</a><time datetime="2025-04-18T02:13:44.000Z" title="发表于 2025-04-18 10:13:44">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/16/NET-ASP-10/" title="ASP.NET学习记录-10-过滤">ASP.NET学习记录-10-过滤</a><time datetime="2025-04-16T12:02:16.000Z" title="发表于 2025-04-16 20:02:16">2025-04-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/15/Software/" title="记录必备软件">记录必备软件</a><time datetime="2025-04-15T11:29:21.000Z" title="发表于 2025-04-15 19:29:21">2025-04-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 By kyl</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>