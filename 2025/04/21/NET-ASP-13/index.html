<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ASP.NET学习记录-13-实践2-数据库进阶 | kyl的博客</title><meta name="author" content="kyl"><meta name="copyright" content="kyl"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="C# .NET ASP.NET Core 基础入门 简单学习">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.NET学习记录-13-实践2-数据库进阶">
<meta property="og:url" content="https://alsl521.github.io/2025/04/21/NET-ASP-13/index.html">
<meta property="og:site_name" content="kyl的博客">
<meta property="og:description" content="C# .NET ASP.NET Core 基础入门 简单学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4">
<meta property="article:published_time" content="2025-04-21T08:39:19.000Z">
<meta property="article:modified_time" content="2025-04-24T08:51:23.126Z">
<meta property="article:author" content="kyl">
<meta property="article:tag" content="C#">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ASP.NET学习记录-13-实践2-数据库进阶",
  "url": "https://alsl521.github.io/2025/04/21/NET-ASP-13/",
  "image": "https://avatars.githubusercontent.com/u/61216968?s=400&u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&v=4",
  "datePublished": "2025-04-21T08:39:19.000Z",
  "dateModified": "2025-04-24T08:51:23.126Z",
  "author": [
    {
      "@type": "Person",
      "name": "kyl",
      "url": "https://alsl521.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://alsl521.github.io/2025/04/21/NET-ASP-13/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ASP.NET学习记录-13-实践2-数据库进阶',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">kyl的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">ASP.NET学习记录-13-实践2-数据库进阶</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ASP.NET学习记录-13-实践2-数据库进阶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-21T08:39:19.000Z" title="发表于 2025-04-21 16:39:19">2025-04-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-24T08:51:23.126Z" title="更新于 2025-04-24 16:51:23">2025-04-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C#</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/ASP/">ASP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1、分页"><a href="#1、分页" class="headerlink" title="1、分页"></a>1、分页</h1><p>在<code>TodoItemController.cs</code>中添加如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 处理HTTP GET请求，路由为 &quot;api/TodoItem/paged&quot;</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 接收查询参数pageNumber和pageSize</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，默认为1，从查询字符串中获取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数，默认为10，从查询字符串中获取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含分页待办事项列表的HTTP 200成功响应<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;paged&quot;</span>)</span>] <span class="comment">// 指定此方法处理路由为 &quot;api/TodoItem/paged&quot; 的GET请求</span></span><br><span class="line"><span class="keyword">public</span> ActionResult&lt;List&lt;TodoItemVO&gt;&gt; GetPagedTodoItems([FromQuery] <span class="built_in">int</span> pageNumber = <span class="number">1</span>, [FromQuery] <span class="built_in">int</span> pageSize = <span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 验证分页参数的有效性</span></span><br><span class="line">    <span class="keyword">if</span> (pageNumber &lt; <span class="number">1</span>) pageNumber = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &lt; <span class="number">1</span>) pageSize = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &gt; <span class="number">100</span>) pageSize = <span class="number">100</span>; <span class="comment">// 限制最大页面大小，防止请求过多数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用服务层获取分页数据</span></span><br><span class="line">    <span class="comment">// 服务层负责计算分页偏移量、获取数据子集并返回结果</span></span><br><span class="line">    <span class="keyword">var</span> pagedResult = _todoItemService.GetPagedTodoItems(pageNumber, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回分页结果</span></span><br><span class="line">    <span class="comment">// 可以考虑返回包含额外分页元数据的自定义结果类</span></span><br><span class="line">    <span class="keyword">return</span> Ok(pagedResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>ITodoItemService.cs</code>中添加如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>分页的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>TodoItemServiceImpl.cs</code>中添加如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 从数据访问层获取指定页的数据并转换为视图对象</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>要获取的页码，从1开始<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页包含的记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>指定页的待办事项视图对象集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 验证分页参数的有效性</span></span><br><span class="line">    <span class="keyword">if</span> (pageNumber &lt; <span class="number">1</span>) pageNumber = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &lt; <span class="number">1</span>) pageSize = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用数据映射器获取分页的待办事项数据</span></span><br><span class="line">    <span class="keyword">var</span> todoItems = _todoItemMapper.GetPagedTodoItems(pageNumber, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将实体对象转换为视图对象并返回</span></span><br><span class="line">    <span class="keyword">var</span> pagedItems = todoItems.Select(item =&gt; <span class="keyword">new</span> TodoItemVO</span><br><span class="line">    &#123;</span><br><span class="line">        Id = item.Id,</span><br><span class="line">        Name = item.Name,</span><br><span class="line">        IsComplete = item.IsComplete,</span><br><span class="line">        CreatedAt = item.CreatedAt,</span><br><span class="line">        UpdatedAt = item.UpdatedAt,</span><br><span class="line">        DeletedAt = item.DeletedAt</span><br><span class="line">    &#125;).ToList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pagedItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>ITodoItemMapper.cs</code>中添加如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 根据指定的页码和页面大小返回对应的数据子集</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 支持分页查询，优化大数据集的访问效率</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>请求的页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页的记录数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>指定页的待办事项集合，如果没有记录则返回空列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>TodoItemMapperImpl.cs</code>中添加如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 根据指定的页码和页面大小返回对应的数据子集</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 支持分页查询，优化大数据集的访问效率</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>请求的页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页的记录数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>指定页的待办事项集合，如果没有记录则返回空列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用 LINQ 的 Skip 和 Take 方法实现分页</span></span><br><span class="line">    <span class="comment">// Skip 方法跳过前 (pageNumber - 1) * pageSize 条记录</span></span><br><span class="line">    <span class="comment">// Take 方法获取接下来的 pageSize 条记录</span></span><br><span class="line">    <span class="comment">// 这会执行 SELECT * FROM todo_item LIMIT &#123;pageSize&#125; OFFSET &#123;(pageNumber-1)*pageSize&#125; 查询</span></span><br><span class="line">    <span class="keyword">return</span> _context.TodoItems</span><br><span class="line">        .Skip((pageNumber - <span class="number">1</span>) * pageSize)</span><br><span class="line">        .Take(pageSize)</span><br><span class="line">        .ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/21/NET-ASP-13/image-20250423110006002.png" alt="image-20250423110006002"></p>
<h1 id="2、筛选"><a href="#2、筛选" class="headerlink" title="2、筛选"></a>2、筛选</h1><p>在<code>TodoItemController.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 处理HTTP GET请求，路由为 &quot;api/TodoItem/paged&quot;</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 接收查询参数pageNumber、pageSize和可选的name</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，默认为1，从查询字符串中获取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数，默认为10，从查询字符串中获取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，支持包含匹配，从查询字符串中获取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含分页待办事项列表的HTTP 200成功响应<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;paged&quot;</span>)</span>] <span class="comment">// 指定此方法处理路由为 &quot;api/TodoItem/paged&quot; 的GET请求</span></span><br><span class="line"><span class="keyword">public</span> ActionResult&lt;List&lt;TodoItemVO&gt;&gt; GetPagedTodoItems(</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageNumber = <span class="number">1</span>,</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageSize = <span class="number">10</span>,</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? name = <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 验证分页参数的有效性</span></span><br><span class="line">    <span class="keyword">if</span> (pageNumber &lt; <span class="number">1</span>) pageNumber = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &lt; <span class="number">1</span>) pageSize = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &gt; <span class="number">100</span>) pageSize = <span class="number">100</span>; <span class="comment">// 限制最大页面大小，防止请求过多数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用服务层获取分页数据，传递筛选参数</span></span><br><span class="line">    <span class="keyword">var</span> pagedResult = _todoItemService.GetPagedTodoItems(pageNumber, pageSize, name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回分页结果</span></span><br><span class="line">    <span class="keyword">return</span> Ok(pagedResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>ITodoItemService.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项，支持可选的名称筛选</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，null表示不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>分页的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>TodoItemServiceImpl.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，null表示不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>指定页的待办事项视图对象集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用数据映射层获取分页数据，传递筛选参数</span></span><br><span class="line">    <span class="keyword">var</span> todoItems = _todoItemMapper.GetPagedTodoItems(pageNumber, pageSize, name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将实体对象转换为视图对象</span></span><br><span class="line">    <span class="keyword">var</span> pagedItems = todoItems.Select(item =&gt; <span class="keyword">new</span> TodoItemVO</span><br><span class="line">    &#123;</span><br><span class="line">        Id = item.Id,</span><br><span class="line">        Name = item.Name,</span><br><span class="line">        IsComplete = item.IsComplete,</span><br><span class="line">        CreatedAt = item.CreatedAt,</span><br><span class="line">        UpdatedAt = item.UpdatedAt,</span><br><span class="line">        DeletedAt = item.DeletedAt</span><br><span class="line">    &#125;)</span><br><span class="line">        .ToList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pagedItems;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>ITodoItemMapper.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>请求的页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页的记录数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，null表示不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合条件的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>TodoItemMapperImpl.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>请求的页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页的记录数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，null表示不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合条件的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建基础查询</span></span><br><span class="line">    IQueryable&lt;TodoItem&gt; query = _context.TodoItems;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用名称筛选（如果提供）</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(name))</span><br><span class="line">    &#123;</span><br><span class="line">        query = query.Where(t =&gt; t.Name != <span class="literal">null</span> &amp;&amp; t.Name.Contains(name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用分页并返回结果</span></span><br><span class="line">    <span class="keyword">return</span> query</span><br><span class="line">        .Skip((pageNumber - <span class="number">1</span>) * pageSize)</span><br><span class="line">        .Take(pageSize)</span><br><span class="line">        .ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/21/NET-ASP-13/image-20250423110330745.png" alt="image-20250423110330745"></p>
<h1 id="3、排序"><a href="#3、排序" class="headerlink" title="3、排序"></a>3、排序</h1><p>在<code>TodoItemController.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 处理HTTP GET请求，路由为 &quot;api/TodoItem/paged&quot;</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，默认为1<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数，默认为10<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，为null时不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段，默认为&quot;createdAt&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，默认为&quot;desc&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含分页待办事项列表的HTTP 200成功响应<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;paged&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> ActionResult&lt;List&lt;TodoItemVO&gt;&gt; GetPagedTodoItems(</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageNumber = <span class="number">1</span>,</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageSize = <span class="number">10</span>,</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? name = <span class="literal">null</span>,</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? sortBy = <span class="literal">null</span>,</span><br><span class="line">    [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? order = <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 验证分页参数</span></span><br><span class="line">    <span class="keyword">if</span> (pageNumber &lt; <span class="number">1</span>) pageNumber = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &lt; <span class="number">1</span>) pageSize = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span> (pageSize &gt; <span class="number">100</span>) pageSize = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用服务层获取分页数据</span></span><br><span class="line">    <span class="keyword">var</span> pagedResult = _todoItemService.GetPagedTodoItems(pageNumber, pageSize, name, sortBy, order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回分页结果</span></span><br><span class="line">    <span class="keyword">return</span> Ok(pagedResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>ITodoItemService.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项，支持可选的名称筛选和排序</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>分页的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>, <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>TodoItemServiceImpl.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，null表示不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段，null使用默认排序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，null使用默认方向<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>指定页的待办事项视图对象集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用数据访问层获取分页数据，传递所有筛选和排序参数</span></span><br><span class="line">    <span class="comment">// 体现了分层设计：将复杂的查询逻辑委托给数据访问层</span></span><br><span class="line">    <span class="keyword">var</span> todoItems = _todoItemMapper.GetPagedTodoItems(pageNumber, pageSize, name, sortBy, order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将实体对象转换为视图对象</span></span><br><span class="line">    <span class="comment">// 确保返回给控制层的是展示层模型，而非持久层模型</span></span><br><span class="line">    <span class="keyword">return</span> todoItems.Select(item =&gt; <span class="keyword">new</span> TodoItemVO</span><br><span class="line">    &#123;</span><br><span class="line">        Id = item.Id,</span><br><span class="line">        Name = item.Name,</span><br><span class="line">        IsComplete = item.IsComplete,</span><br><span class="line">        CreatedAt = item.CreatedAt,</span><br><span class="line">        UpdatedAt = item.UpdatedAt,</span><br><span class="line">        DeletedAt = item.DeletedAt</span><br><span class="line">    &#125;).ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>ITodoItemMapper.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>页码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>页大小<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>,<span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span>;</span><br></pre></td></tr></table></figure>

<p>在<code>TodoItemMapperImpl.cs</code>中修改为如下代码</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 根据给定的参数从数据库中检索并返回符合条件的数据子集</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>要获取的页码，从1开始<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页包含的记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，支持包含匹配<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段名称<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，&quot;asc&quot;表示升序，其他值表示降序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>分页过滤后的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建基础查询</span></span><br><span class="line">    <span class="comment">// 定义一个IQueryable&lt;TodoItem&gt;，这样可以延迟执行查询，只在需要时才访问数据库</span></span><br><span class="line">    IQueryable&lt;TodoItem&gt; query = _context.TodoItems;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用名称筛选</span></span><br><span class="line">    <span class="comment">// 如果提供了名称参数，则添加WHERE条件</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(name))</span><br><span class="line">    &#123;</span><br><span class="line">        query = query.Where(t =&gt; t.Name != <span class="literal">null</span> &amp;&amp; t.Name.Contains(name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确定排序方向</span></span><br><span class="line">    <span class="comment">// 解析order参数，确定是升序还是降序排序</span></span><br><span class="line">    <span class="comment">// 如果order参数是&quot;asc&quot;则为升序，否则为降序</span></span><br><span class="line">    <span class="built_in">bool</span> isAscending = !<span class="built_in">string</span>.IsNullOrEmpty(order) &amp;&amp; order.ToLower() == <span class="string">&quot;asc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用排序</span></span><br><span class="line">    <span class="comment">// 根据sortBy参数选择排序字段，并应用之前确定的排序方向</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(sortBy))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (sortBy.ToLower())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;id&quot;</span>:</span><br><span class="line">                query = isAscending ? query.OrderBy(t =&gt; t.Id) : query.OrderByDescending(t =&gt; t.Id);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;name&quot;</span>:</span><br><span class="line">                query = isAscending ? query.OrderBy(t =&gt; t.Name) : query.OrderByDescending(t =&gt; t.Name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;iscomplete&quot;</span>:</span><br><span class="line">                query = isAscending ? query.OrderBy(t =&gt; t.IsComplete) : query.OrderByDescending(t =&gt; t.IsComplete);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;updatedat&quot;</span>:</span><br><span class="line">                query = isAscending ? query.OrderBy(t =&gt; t.UpdatedAt) : query.OrderByDescending(t =&gt; t.UpdatedAt);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;createdat&quot;</span>:</span><br><span class="line">                query = isAscending ? query.OrderBy(t =&gt; t.CreatedAt) : query.OrderByDescending(t =&gt; t.CreatedAt);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                query = isAscending ? query.OrderBy(t =&gt; t.CreatedAt) : query.OrderByDescending(t =&gt; t.CreatedAt);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 默认按创建时间降序排序</span></span><br><span class="line">        <span class="comment">// 如果没有指定排序字段，则使用创建时间降序作为默认排序</span></span><br><span class="line">        query = query.OrderByDescending(t =&gt; t.CreatedAt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用分页</span></span><br><span class="line">    <span class="comment">// 使用Skip和Take方法实现分页</span></span><br><span class="line">    <span class="comment">// Skip跳过前(pageNumber-1)*pageSize条记录，Take获取pageSize条记录</span></span><br><span class="line">    <span class="keyword">return</span> query</span><br><span class="line">        .Skip((pageNumber - <span class="number">1</span>) * pageSize)</span><br><span class="line">        .Take(pageSize)</span><br><span class="line">        .ToList(); <span class="comment">// 执行查询并返回结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/21/NET-ASP-13/image-20250423123153316.png" alt="image-20250423123153316"></p>
<h1 id="4、使用Redis"><a href="#4、使用Redis" class="headerlink" title="4、使用Redis"></a>4、使用<code>Redis</code></h1><p>Redis是一种基于内存的高性能键值数据库，其核心作用在于提供快速的数据读写能力，并支持多样化的数据结构与高可用架构。以下是它的基本作用及典型使用场景：</p>
<h2 id="1、基本作用"><a href="#1、基本作用" class="headerlink" title="1、基本作用"></a>1、基本作用</h2><ol>
<li><strong>高速数据存储与访问</strong><br>由于数据存储在内存中，Redis的读写速度远超传统磁盘数据库，可达到每秒数十万次操作，尤其适合处理高并发场景下的实时数据需求。例如缓存热点数据，降低数据库负载，提升系统响应速度。</li>
<li><strong>多样化数据结构支持</strong><br>除了基础的字符串（String）、哈希（Hash）、列表（List）、集合（Set）、有序集合（Sorted Set），Redis还支持位图、HyperLogLog、地理空间索引等高级结构，能灵活应对复杂业务逻辑，如统计唯一用户数（UV）或地理位置计算。</li>
<li><strong>数据持久化与可靠性</strong><br>通过RDB快照和AOF日志两种机制，Redis可将内存数据持久化到磁盘，避免系统故障时数据丢失。同时，主从复制、哨兵模式及集群架构确保了服务的高可用性和容灾能力。</li>
<li><strong>分布式系统支持</strong><br>Redis支持分布式锁、集群分片及跨节点数据同步，适用于构建分布式架构中的资源协调与负载均衡，例如电商秒杀场景下的库存控制。</li>
</ol>
<h2 id="2、典型使用场景"><a href="#2、典型使用场景" class="headerlink" title="2、典型使用场景"></a>2、典型使用场景</h2><ol>
<li><strong>缓存加速</strong><br>将频繁访问的数据（如商品详情、用户信息）缓存至Redis，减少直接查询数据库的次数，显著提升响应速度。例如，电商平台的热门商品信息可通过Redis缓存，缓解数据库压力。</li>
<li><strong>会话存储与状态管理</strong><br>存储用户登录状态或会话信息（如购物车数据），支持无状态服务架构。用户在不同设备或服务器间切换时，仍能保持一致的会话体验。</li>
<li><strong>实时排行榜与计数器</strong><br>利用有序集合（Sorted Set）的自动排序特性，实现实时更新的游戏积分榜或热销商品排行。原子操作（如INCR）则支持高并发下的访问量统计或限流控制。</li>
<li><strong>消息队列与异步处理</strong><br>通过列表（List）或发布订阅（Pub&#x2F;Sub）模式构建轻量级消息队列，实现异步任务处理。例如订单生成后，异步通知物流系统或发送用户确认邮件。</li>
<li><strong>分布式锁与资源协调</strong><br>使用SETNX命令实现跨服务的互斥锁，确保分布式环境下共享资源的安全访问，例如防止库存超卖或重复提交订单。</li>
<li><strong>实时数据分析</strong><br>结合HyperLogLog统计大规模数据集的唯一值，或利用位图记录用户活跃状态，快速生成实时统计报表，如每日活跃用户数（DAU）。</li>
</ol>
<h2 id="3、通过docker-desktop安装Redis"><a href="#3、通过docker-desktop安装Redis" class="headerlink" title="3、通过docker desktop安装Redis"></a>3、通过docker desktop安装Redis</h2><h3 id="1-下载-Docker-Desktop"><a href="#1-下载-Docker-Desktop" class="headerlink" title="1. 下载 Docker Desktop"></a>1. <strong>下载 Docker Desktop</strong></h3><ul>
<li>访问 Docker 官网：<a target="_blank" rel="noopener" href="https://www.docker.com/%E3%80%82">https://www.docker.com/。</a></li>
<li>点击页面上的“Download for Windows - AMD64”按钮，以下载适用于 Windows 系统的 Docker Desktop 安装文件。</li>
</ul>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424105706311.png" alt="image-20250424105706311"></p>
<h3 id="2-安装-Docker-Desktop"><a href="#2-安装-Docker-Desktop" class="headerlink" title="2. 安装 Docker Desktop"></a>2. <strong>安装 Docker Desktop</strong></h3><ul>
<li><p>双击下载的安装文件，开始安装 Docker Desktop。</p>
</li>
<li><p>在安装之前首先启动必要的Windows功能</p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424105945697.png" alt="image-20250424105945697"></p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424110049987.png" alt="image-20250424110049987"></p>
</li>
<li><p>按照安装向导的指示完成安装。在安装过程中，将提示安装 <strong>WSL 2</strong>，建议勾选此选项以获得更好的性能。</p>
<p><img src="/2025/04/21/NET-ASP-13/49193a4af4ef431e8c3fe1de5517345c.png"></p>
</li>
</ul>
<h3 id="3-配置-Docker-Desktop"><a href="#3-配置-Docker-Desktop" class="headerlink" title="3. 配置 Docker Desktop"></a>3. <strong>配置 Docker Desktop</strong></h3><ul>
<li><p>安装完成后，启动 <strong>Docker Desktop</strong>。</p>
<p><img src="/2025/04/21/NET-ASP-13/13f2387aabc24af2976ea2be968a0674.png"></p>
</li>
<li><p>首次打开时，将出现 Docker 订阅协议，点击 <code>Accept</code>（接受）以继续。</p>
</li>
<li><p>随后，系统将提示用户登录。可以选择使用 GitHub 账户或 Google 账户登录。</p>
</li>
<li><p>接下来，将出现调查问卷，您可以根据个人喜好选择填写，或直接跳过此步骤。</p>
</li>
<li><p>最后，Docker Desktop 将正常启动。</p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424110309187.png" alt="image-20250424110309187"></p>
</li>
</ul>
<h3 id="4-安装Redis"><a href="#4-安装Redis" class="headerlink" title="4. 安装Redis"></a>4. <strong>安装Redis</strong></h3><ol>
<li><p>在Docker Desktop中搜寻Redis，里面有通过Docker Desktop安装Redis相关内容。<img src="/2025/04/21/NET-ASP-13/image-20250424110500479.png" alt="image-20250424110500479"></p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424110538212.png" alt="image-20250424110538212"></p>
</li>
<li><p>打开<code>Terminal（终端）</code>，然后输入相关docker代码，从而运行Redis，我们可以通过<code>Another Redis Desktop Manager</code>连接查看数据库中的内容。并且需要将Redis设定密码。</p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424110754720.png" alt="image-20250424110754720"></p>
</li>
</ol>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424114439093.png" alt="image-20250424114439093"></p>
<h2 id="4、ASP-NET-Core中使用Redis"><a href="#4、ASP-NET-Core中使用Redis" class="headerlink" title="4、ASP.NET Core中使用Redis"></a>4、ASP.NET Core中使用Redis</h2><h3 id="1、安装必要的-NuGet-包"><a href="#1、安装必要的-NuGet-包" class="headerlink" title="1、安装必要的 NuGet 包"></a>1、安装必要的 NuGet 包</h3><p>在项目中安装 StackExchange.Redis 包，基本 Redis 客户端。Microsoft.Extensions.Caching.StackExchangeRedis则用于分布式缓存集成。</p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424134651105.png" alt="image-20250424134651105"></p>
<blockquote>
<p>Redis客户端库比较及推荐理由</p>
<ol>
<li>ServiceStack.Redis</li>
</ol>
<p>简介</p>
<ul>
<li>ServiceStack.Redis 是一个功能强大的 Redis 客户端，支持丰富的 Redis 功能。</li>
<li>属于 ServiceStack 框架的一部分，提供高级 API 和易用性。</li>
<li>支持连接池、事务、发布&#x2F;订阅、Lua 脚本等功能。</li>
</ul>
<p>优点</p>
<ul>
<li>高级 API 封装复杂操作</li>
<li>支持高并发连接池</li>
<li>提供丰富文档和示例</li>
</ul>
<p>缺点</p>
<ul>
<li><strong>商业化</strong>：免费版功能受限，企业版需购买许可证</li>
<li>社区支持较少，依赖官方维护</li>
</ul>
<hr>
<ol start="2">
<li>StackExchange.Redis</li>
</ol>
<p>简介</p>
<ul>
<li>由 StackExchange 团队（Stack Overflow 开发者）维护，支持 .NET Core&#x2F;.NET Framework。</li>
<li>目前最流行的 .NET Redis 客户端之一。</li>
</ul>
<p>优点</p>
<ul>
<li><strong>开源免费</strong>：无商业限制</li>
<li><strong>高性能</strong>：多路复用连接减少开销</li>
<li><strong>功能全面</strong>：支持事务、发布&#x2F;订阅、Lua 脚本等</li>
<li><strong>活跃社区</strong>：用户群体庞大，更新频繁</li>
<li><strong>完善文档</strong>：提供详细示例代码</li>
</ul>
<p>缺点</p>
<ul>
<li>API 偏底层，需熟悉 Redis 原理</li>
<li>不支持连接池（但多路复用已优化性能）</li>
</ul>
<hr>
<ol start="3">
<li>CSRedis</li>
</ol>
<p>简介</p>
<ul>
<li>轻量级 Redis 客户端，简化 Redis 使用。</li>
<li>提供与 Redis 命令一一对应的 API。</li>
</ul>
<p>优点</p>
<ul>
<li>易用性高，快速上手</li>
<li>支持高并发连接池</li>
<li>集成 ASP.NET Core 分布式缓存和会话管理</li>
</ul>
<p>缺点</p>
<ul>
<li>社区支持较少（个人维护为主）</li>
<li>功能相对简单，适合中小项目</li>
</ul>
<hr>
<ol start="4">
<li>FreeRedis</li>
</ol>
<p>简介</p>
<ul>
<li>现代化 Redis 客户端，支持多种 Redis 功能。</li>
<li>API 设计与 Redis 命令一致。</li>
</ul>
<p>优点</p>
<ul>
<li>支持事务、发布&#x2F;订阅、管道等</li>
<li>API 简洁易用</li>
<li>兼容单机&#x2F;集群&#x2F;哨兵模式</li>
</ul>
<p>缺点</p>
<ul>
<li>社区支持不足，用户基数小</li>
<li>文档和示例较少</li>
</ul>
<hr>
<p>推荐使用 StackExchange.Redis 的原因</p>
<ol>
<li><p><strong>开源免费</strong><br>无商业限制，适用于任何规模项目。</p>
</li>
<li><p><strong>高性能</strong><br>多路复用技术减少连接开销，单连接处理多请求。</p>
</li>
<li><p><strong>功能全面性</strong><br>覆盖 Redis 核心功能（事务、Lua 脚本、管道等），支持缓存、分布式锁等场景。</p>
</li>
<li><p><strong>社区支持</strong>  </p>
<ul>
<li>用户群体庞大，问题解决效率高  </li>
<li>由 StackExchange 团队持续维护，稳定性强</li>
</ul>
</li>
<li><p><strong>文档完善</strong><br>提供详细文档和代码示例，降低学习成本。</p>
</li>
<li><p><strong>企业级验证</strong><br>被多家大型企业采用，性能与可靠性经过实际验证。</p>
</li>
</ol>
<hr>
<p>总结对比</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>ServiceStack.Redis</th>
<th>StackExchange.Redis</th>
<th>CSRedis</th>
<th>FreeRedis</th>
</tr>
</thead>
<tbody><tr>
<td><strong>开源免费</strong></td>
<td>否（商业限制）</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td><strong>社区支持</strong></td>
<td>较少</td>
<td>活跃</td>
<td>较少</td>
<td>较少</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>高</td>
<td>高</td>
<td>中</td>
<td>中</td>
</tr>
<tr>
<td><strong>功能全面性</strong></td>
<td>高</td>
<td>高</td>
<td>中</td>
<td>中</td>
</tr>
<tr>
<td><strong>易用性</strong></td>
<td>高</td>
<td>中</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td><strong>文档和示例</strong></td>
<td>丰富</td>
<td>丰富</td>
<td>较少</td>
<td>较少</td>
</tr>
</tbody></table>
<p><strong>结论</strong>：推荐优先选择 <code>StackExchange.Redis</code>，尤其适合需高性能、功能全面且开源免费的项目。其社区支持与文档完善性使其成为 .NET 生态的首选客户端。</p>
</blockquote>
<h3 id="2、配置-Redis-连接"><a href="#2、配置-Redis-连接" class="headerlink" title="2、配置 Redis 连接"></a>2、配置 Redis 连接</h3><p>在 appsettings.json 中添加 Redis 的连接字符串：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 配置日志记录</span></span><br><span class="line">  <span class="attr">&quot;Logging&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;LogLevel&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// 默认日志级别，设置为 &quot;Information&quot;，记录信息级别及以上的日志（如警告、错误）</span></span><br><span class="line">      <span class="attr">&quot;Default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Information&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">// 针对 Microsoft.AspNetCore 命名空间的日志级别，设置为 &quot;Warning&quot;，仅记录警告及以上的日志</span></span><br><span class="line">      <span class="attr">&quot;Microsoft.AspNetCore&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Warning&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 数据库连接字符串配置</span></span><br><span class="line">  <span class="attr">&quot;ConnectionStrings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 默认数据库连接字符串，连接到 MySQL 数据库</span></span><br><span class="line">    <span class="comment">// server: 数据库服务器地址（此处为 localhost）</span></span><br><span class="line">    <span class="comment">// port: 数据库端口（MySQL 默认端口为 3306）</span></span><br><span class="line">    <span class="comment">// database: 数据库名称（此处为 aspnetcore）</span></span><br><span class="line">    <span class="comment">// uid: 数据库用户名（此处为 root）</span></span><br><span class="line">    <span class="comment">// pwd: 数据库密码（此处为 root）</span></span><br><span class="line">    <span class="attr">&quot;DefaultConnection&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server=localhost;port=3306;database=aspnetcore;uid=root;pwd=root;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// Redis连接字符串</span></span><br><span class="line">    <span class="comment">// localhost:6379: Redis服务器地址和端口</span></span><br><span class="line">    <span class="comment">// password: Redis认证密码</span></span><br><span class="line">    <span class="comment">// ssl: 是否启用SSL连接（此处为false）</span></span><br><span class="line">    <span class="comment">// abortConnect: 连接失败时是否中止（此处为false，表示允许重试）</span></span><br><span class="line">    <span class="attr">&quot;Redis&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost:6379,password=redis,ssl=false,abortConnect=false&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// Redis实例配置</span></span><br><span class="line">  <span class="attr">&quot;Redis&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// Redis实例名称前缀，用于区分不同应用的缓存键</span></span><br><span class="line">    <span class="attr">&quot;InstanceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TodoApp:&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 配置允许的主机</span></span><br><span class="line">  <span class="comment">// &quot;*&quot; 表示允许所有主机访问</span></span><br><span class="line">  <span class="attr">&quot;AllowedHosts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-在-Program-cs-中配置-Redis"><a href="#3-在-Program-cs-中配置-Redis" class="headerlink" title="3. 在 Program.cs 中配置 Redis"></a>3. 在 Program.cs 中配置 Redis</h3><p>在 ASP.NET Core 的依赖注入容器中注册 Redis 客户端：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入必要的命名空间</span></span><br><span class="line"><span class="comment">// Microsoft.EntityFrameworkCore 提供与数据库交互的功能</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="comment">// StackExchange.Redis 是Redis客户端，提供与Redis服务器通信的功能</span></span><br><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="comment">// WebApp.Config 包含服务注册的扩展方法</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Config;</span><br><span class="line"><span class="comment">// WebApp.DB 包含数据库上下文类，定义了应用程序与数据库的交互模型</span></span><br><span class="line"><span class="keyword">using</span> WebApp.DB;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 Web 应用程序构建器，用于配置应用程序的服务和中间件</span></span><br><span class="line"><span class="comment">// 这是 ASP.NET Core 应用程序的起点，提供配置、日志、服务注册等功能</span></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 MySQL 数据库上下文</span></span><br><span class="line"><span class="comment">// 将 TodoItemDbContext 注册到依赖注入容器中</span></span><br><span class="line"><span class="comment">// 使用 MySQL 作为数据库提供程序，并从 appsettings.json 中读取连接字符串</span></span><br><span class="line">builder.Services.AddDbContext&lt;TodoItemDbContext&gt;(options =&gt;</span><br><span class="line">    options.UseMySql(</span><br><span class="line">        builder.Configuration.GetConnectionString(<span class="string">&quot;DefaultConnection&quot;</span>), <span class="comment">// 从配置文件中读取连接字符串</span></span><br><span class="line">        <span class="keyword">new</span> MySqlServerVersion(<span class="keyword">new</span> Version(<span class="number">8</span>, <span class="number">0</span>, <span class="number">34</span>)) <span class="comment">// 指定 MySQL 数据库的版本</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加Redis分布式缓存</span></span><br><span class="line"><span class="comment">// 配置ASP.NET Core内置的分布式缓存系统使用Redis作为存储后端</span></span><br><span class="line"><span class="comment">// 这允许应用程序使用IDistributedCache接口访问Redis缓存</span></span><br><span class="line">builder.Services.AddStackExchangeRedisCache(options =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置Redis连接字符串，指定Redis服务器的地址和认证信息</span></span><br><span class="line">    options.Configuration = builder.Configuration.GetConnectionString(<span class="string">&quot;Redis&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置Redis实例名称前缀，用于区分不同应用共享同一Redis服务时的缓存键</span></span><br><span class="line">    options.InstanceName = builder.Configuration.GetSection(<span class="string">&quot;Redis:InstanceName&quot;</span>).Value;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册Redis连接多路复用器</span></span><br><span class="line"><span class="comment">// ConnectionMultiplexer是StackExchange.Redis的核心组件，管理与Redis服务器的所有连接</span></span><br><span class="line"><span class="comment">// 使用单例模式注册，确保整个应用程序共享同一连接实例，避免创建过多连接</span></span><br><span class="line">builder.Services.AddSingleton&lt;IConnectionMultiplexer&gt;(sp =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 解析Redis连接配置</span></span><br><span class="line">    <span class="keyword">var</span> configuration = ConfigurationOptions.Parse(</span><br><span class="line">        builder.Configuration.GetConnectionString(<span class="string">&quot;Redis&quot;</span>));</span><br><span class="line">    <span class="comment">// 创建并返回连接实例</span></span><br><span class="line">    <span class="comment">// 此连接支持自动重连和命令多路复用</span></span><br><span class="line">    <span class="keyword">return</span> ConnectionMultiplexer.Connect(configuration);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册控制器服务</span></span><br><span class="line"><span class="comment">// 将控制器添加到依赖注入容器中，允许应用程序处理基于控制器的 HTTP 请求</span></span><br><span class="line"><span class="comment">// 使 MVC 控制器可以被依赖注入系统识别，支持API端点的路由和处理</span></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册应用程序中的所有服务</span></span><br><span class="line"><span class="comment">// 通过 DependencyInjectionExtensions 类中的扩展方法自动注册服务</span></span><br><span class="line"><span class="comment">// 包括 TodoItemService、TodoItemMapper、RedisCacheService 等依赖服务</span></span><br><span class="line"><span class="comment">// 避免在 Program.cs 中手动逐一注册，提高代码模块化和可维护性</span></span><br><span class="line">builder.Services.RegisterAllServices();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建 Web 应用程序实例</span></span><br><span class="line"><span class="comment">// 通过构建器生成一个 Web 应用程序对象，准备运行应用程序</span></span><br><span class="line"><span class="comment">// 此时所有配置和服务注册都已完成，可以开始处理 HTTP 请求</span></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 映射控制器路由</span></span><br><span class="line"><span class="comment">// 将控制器的路由映射到应用程序中，使其能够响应 HTTP 请求</span></span><br><span class="line"><span class="comment">// 例如：将 &quot;/api/TodoItem&quot; 路径映射到 TodoItemController</span></span><br><span class="line"><span class="comment">// 这是启用API端点的必要步骤</span></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动 Web 应用程序并开始监听请求</span></span><br><span class="line"><span class="comment">// 运行应用程序，开始处理传入的 HTTP 请求</span></span><br><span class="line"><span class="comment">// 应用程序将一直运行，直到被明确停止（如按Ctrl+C或进程终止）</span></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<h3 id="4-创建-Redis-服务类相关代码"><a href="#4-创建-Redis-服务类相关代码" class="headerlink" title="4. 创建 Redis 服务类相关代码"></a>4. 创建 Redis 服务类相关代码</h3><p>IRedisCacheService</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Redis</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Redis 缓存服务接口</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 定义了与 Redis 缓存交互的基本操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 提供类型安全的方法来存储、检索和管理缓存数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IRedisCacheService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 异步从缓存中获取指定键的值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>要返回的对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果找到键，则返回反序列化后的对象；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果未找到键或值已过期，则返回 null</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        Task&lt;T?&gt; GetAsync&lt;T&gt;(<span class="built_in">string</span> key);</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 异步将值存储在缓存中，使用指定的键</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>要缓存的对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>要缓存的对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;expiry&quot;&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 可选的过期时间；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果为 null，则使用默认过期策略或永不过期（取决于实现）</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>表示异步操作的任务<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">Task <span class="title">SetAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> key, T <span class="keyword">value</span>, TimeSpan? expiry = <span class="literal">null</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 异步从缓存中移除指定键的值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>要移除的缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果键存在且被成功移除，则返回 true；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果键不存在，则返回 false</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">Task&lt;<span class="built_in">bool</span>&gt; <span class="title">RemoveAsync</span>(<span class="params"><span class="built_in">string</span> key</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 异步检查缓存中是否存在指定的键</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>要检查的缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果缓存中存在指定的键，则返回 true；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 否则返回 false</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ExistsAsync</span>(<span class="params"><span class="built_in">string</span> key</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedisCacheServiceImpl</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;   <span class="comment">// 引入 StackExchange.Redis 命名空间，提供 Redis 客户端功能</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Result;         <span class="comment">// 引入自定义结果处理命名空间，包含 ISerializer 接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Redis.Impl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Redis缓存服务实现类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实现了IRedisCacheService接口，提供与Redis缓存交互的具体实现</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 使用StackExchange.Redis作为底层客户端与Redis服务器通信</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RedisCacheServiceImpl</span> : <span class="title">IRedisCacheService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Redis数据库实例</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 提供对Redis命令的直接访问</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 由ConnectionMultiplexer管理，线程安全且高效</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IDatabase _db;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 序列化器接口实例</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 负责对象与字符串之间的转换，使Redis能够存储复杂对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ISerializer _serializer;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 构造函数，通过依赖注入初始化Redis数据库和序列化器</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;redis&quot;&gt;</span>Redis连接多路复用器，管理与Redis服务器的连接<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serializer&quot;&gt;</span>用于序列化和反序列化对象的工具<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">RedisCacheServiceImpl</span>(<span class="params">IConnectionMultiplexer redis, ISerializer serializer</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _db = redis.GetDatabase();  <span class="comment">// 获取Redis数据库实例</span></span><br><span class="line">            _serializer = serializer;   <span class="comment">// 初始化序列化器</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从Redis缓存中异步获取值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>要返回的对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果找到键，则返回反序列化后的对象；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果未找到键或值已过期，则返回默认值(null或值类型的默认值)</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">T</span>?&gt; <span class="title">GetAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 从Redis获取字符串值</span></span><br><span class="line">            <span class="keyword">var</span> <span class="keyword">value</span> = <span class="keyword">await</span> _db.StringGetAsync(key);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果值为null，直接返回类型的默认值</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span>.IsNull)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">default</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将字符串值反序列化为请求的类型并返回</span></span><br><span class="line">            <span class="keyword">return</span> _serializer.Deserialize&lt;T&gt;(<span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将值异步存储到Redis缓存中</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>要缓存的对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>要缓存的对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;expiry&quot;&gt;</span>可选的过期时间，null表示永不过期<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>表示异步操作的任务<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Task <span class="title">SetAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> key, T <span class="keyword">value</span>, TimeSpan? expiry = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 将对象序列化为字符串</span></span><br><span class="line">            <span class="keyword">var</span> serializedValue = _serializer.Serialize(<span class="keyword">value</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用指定的键值和过期时间将序列化后的值存储到Redis</span></span><br><span class="line">            <span class="keyword">return</span> _db.StringSetAsync(key, serializedValue, expiry);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从Redis缓存中异步移除指定键的值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>要移除的缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果键存在且被成功移除，则返回true；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果键不存在，则返回false</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">RemoveAsync</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 从Redis中删除指定的键</span></span><br><span class="line">            <span class="comment">// KeyDeleteAsync方法会返回一个布尔值，表示键是否存在并被删除</span></span><br><span class="line">            <span class="keyword">return</span> _db.KeyDeleteAsync(key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 异步检查Redis缓存中是否存在指定的键</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>要检查的缓存键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果缓存中存在指定的键，则返回true；</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 否则返回false</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">ExistsAsync</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 检查Redis中是否存在指定的键</span></span><br><span class="line">            <span class="keyword">return</span> _db.KeyExistsAsync(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ISerializer</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Result</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 序列化接口</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 定义了对象序列化和反序列化的基本操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 为应用程序提供了统一的序列化抽象，便于切换不同的序列化实现</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 主要用于Redis缓存服务中对象与字符串格式的转换</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISerializer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将对象序列化为字符串</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>要序列化的对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;obj&quot;&gt;</span>要序列化的对象实例<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>序列化后的字符串表示<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="built_in">string</span> <span class="title">Serialize</span>&lt;<span class="title">T</span>&gt;(<span class="params">T obj</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将字符串反序列化为对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>目标对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>要反序列化的字符串<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>反序列化后的对象实例<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function">T <span class="title">Deserialize</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JsonSerializer</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Result</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> JSON序列化器实现类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实现ISerializer接口，提供基于System.Text.Json的序列化功能</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 作为应用程序中默认的序列化机制，将对象转换为JSON格式字符串</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 主要用于Redis缓存中存储复杂对象</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JsonSerializer</span> : <span class="title">ISerializer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将对象序列化为JSON字符串</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 利用.NET内置的System.Text.Json库完成序列化</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>要序列化的对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;obj&quot;&gt;</span>要序列化的对象实例<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>序列化后的JSON字符串<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Serialize</span>&lt;<span class="title">T</span>&gt;(<span class="params">T obj</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用System.Text.Json库的序列化方法</span></span><br><span class="line">            <span class="comment">// 将对象转换为JSON格式的字符串表示</span></span><br><span class="line">            <span class="keyword">return</span> System.Text.Json.JsonSerializer.Serialize(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将JSON字符串反序列化为对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 利用.NET内置的System.Text.Json库完成反序列化</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>目标对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>要反序列化的JSON字符串<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>反序列化后的对象实例<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;JsonException&quot;&gt;</span>当JSON字符串格式无效或与目标类型不匹配时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">Deserialize</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用System.Text.Json库的反序列化方法</span></span><br><span class="line">            <span class="comment">// 将JSON字符串解析为指定类型的对象</span></span><br><span class="line">            <span class="keyword">return</span> System.Text.Json.JsonSerializer.Deserialize&lt;T&gt;(<span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-在控制器中使用-Redis"><a href="#5-在控制器中使用-Redis" class="headerlink" title="5. 在控制器中使用 Redis"></a>5. 在控制器中使用 Redis</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;                <span class="comment">// 引入MVC控制器相关的命名空间</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Caching.Distributed; <span class="comment">// 引入分布式缓存相关的命名空间</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.DTO;                         <span class="comment">// 引入数据传输对象</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.VO;                          <span class="comment">// 引入视图对象</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Services;                         <span class="comment">// 引入服务接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 待办事项控制器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 处理与待办事项相关的所有HTTP请求</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 作为应用程序的表示层，负责接收请求、调用服务层处理业务逻辑并返回结果</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 遵循RESTful API设计规范，提供标准的CRUD操作端点</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">ApiController</span>]  <span class="comment">// 指示此类为API控制器，启用API特定行为如自动模型验证</span></span><br><span class="line">    [<span class="meta">Route(<span class="string">&quot;api/[controller]&quot;</span>)</span>]  <span class="comment">// 设置此控制器的路由模板，[controller]会被解析为&quot;TodoItem&quot;(去掉&quot;Controller&quot;后缀)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TodoItemController</span> : <span class="title">ControllerBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 待办事项服务接口实例</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 通过依赖注入获取，用于处理业务逻辑操作</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 遵循依赖倒置原则，控制器依赖于抽象接口而非具体实现</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ITodoItemService _todoItemService;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 分布式缓存接口实例</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于缓存频繁访问的数据，减轻数据库负载</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 通过Redis实现，支持跨服务器缓存共享</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IDistributedCache _cache;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 构造函数，通过依赖注入初始化服务和缓存组件</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用构造函数注入方式获取所需依赖</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemService&quot;&gt;</span>待办事项服务接口实现<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;cache&quot;&gt;</span>分布式缓存接口实现，用于数据缓存<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TodoItemController</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">            ITodoItemService todoItemService,</span></span></span><br><span class="line"><span class="params"><span class="function">            IDistributedCache cache</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _todoItemService = todoItemService; <span class="comment">// 初始化待办事项服务</span></span><br><span class="line">            _cache = cache;                     <span class="comment">// 初始化分布式缓存服务</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理HTTP GET请求，路由为 &quot;api/TodoItem&quot;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 不接受任何参数，返回所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含所有待办事项VO列表的HTTP 200成功响应<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">HttpGet</span>] <span class="comment">// 指定此方法处理 HTTP GET 请求</span></span><br><span class="line">        <span class="keyword">public</span> ActionResult&lt;List&lt;TodoItemVO&gt;&gt; GetAllTodoItems()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用服务层获取所有待办事项</span></span><br><span class="line">            <span class="comment">// 服务层负责从数据访问层获取数据并转换为VO对象</span></span><br><span class="line">            List&lt;TodoItemVO&gt; todoItemVOs = _todoItemService.GetAllTodoItems();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回HTTP 200状态码和获取到的待办事项列表</span></span><br><span class="line">            <span class="comment">// Ok()方法创建一个带有HTTP 200状态码的ObjectResult</span></span><br><span class="line">            <span class="keyword">return</span> Ok(todoItemVOs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据ID获取特定的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理HTTP GET请求，路由为 &quot;api/TodoItem/&#123;id&#125;&quot;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从URL路径中获取ID参数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 实现了缓存机制，优先从缓存中获取数据</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待获取的待办事项ID，来自URL路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含指定ID待办事项的HTTP 200成功响应，如果未找到则由服务层抛出异常<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">HttpGet(<span class="string">&quot;&#123;id&#125;&quot;</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;TodoItemVO&gt;&gt; GetTodoItemById(<span class="built_in">int</span> id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 构造缓存键，使用&quot;TodoItem:&#123;id&#125;&quot;格式确保唯一性</span></span><br><span class="line">            <span class="built_in">string</span> cacheKey = <span class="string">$&quot;TodoItem:<span class="subst">&#123;id&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 尝试从分布式缓存获取数据</span></span><br><span class="line">            <span class="comment">// GetStringAsync是异步方法，避免缓存操作阻塞请求线程</span></span><br><span class="line">            <span class="built_in">string</span> cachedValue = <span class="keyword">await</span> _cache.GetStringAsync(cacheKey);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 检查缓存是否命中</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(cachedValue))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 缓存命中，将JSON字符串反序列化为TodoItemVO对象</span></span><br><span class="line">                <span class="comment">// 使用System.Text.Json序列化库，与缓存时使用的库一致</span></span><br><span class="line">                <span class="keyword">var</span> item = System.Text.Json.JsonSerializer.Deserialize&lt;TodoItemVO&gt;(cachedValue);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 返回从缓存中获取的数据</span></span><br><span class="line">                <span class="keyword">return</span> Ok(item);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 缓存未命中，从服务层获取数据</span></span><br><span class="line">            <span class="comment">// 这将查询数据库以获取最新数据</span></span><br><span class="line">            <span class="keyword">var</span> todoItemVO = _todoItemService.GetTodoItemById(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将获取到的对象序列化为JSON字符串并存入缓存</span></span><br><span class="line">            <span class="comment">// 使用DistributedCacheEntryOptions设置缓存过期时间</span></span><br><span class="line">            <span class="keyword">await</span> _cache.SetStringAsync(</span><br><span class="line">                cacheKey,</span><br><span class="line">                System.Text.Json.JsonSerializer.Serialize(todoItemVO),</span><br><span class="line">                <span class="keyword">new</span> DistributedCacheEntryOptions</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 设置缓存的绝对过期时间为30分钟</span></span><br><span class="line">                    <span class="comment">// 过期后将重新从数据库获取</span></span><br><span class="line">                    AbsoluteExpirationRelativeToNow = TimeSpan.FromMinutes(<span class="number">30</span>)</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回从服务层获取的数据</span></span><br><span class="line">            <span class="keyword">return</span> Ok(todoItemVO);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 创建新的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理HTTP POST请求，路由为 &quot;api/TodoItem&quot;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从请求体中解析TodoItemDTO对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItem&quot;&gt;</span>包含新待办事项信息的DTO，从请求体中解析<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含创建成功的待办事项VO的HTTP 200成功响应<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">HttpPost</span>] <span class="comment">// 指定此方法处理HTTP POST请求</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActionResult&lt;TodoItemVO&gt; <span class="title">AddTodoItem</span>(<span class="params">[FromBody] TodoItemDTO todoItem</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用服务层创建新待办事项</span></span><br><span class="line">            <span class="comment">// 服务层负责验证数据、创建实体、保存到数据库并返回VO对象</span></span><br><span class="line">            TodoItemVO todoItemVO = _todoItemService.AddTodoItem(todoItem);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回HTTP 200状态码和创建的待办事项</span></span><br><span class="line">            <span class="comment">// 注意：更符合RESTful设计的做法是返回201 Created状态码和资源位置</span></span><br><span class="line">            <span class="comment">// 改进建议：return CreatedAtAction(nameof(GetTodoItemById), new &#123; id = todoItemVO.Id &#125;, todoItemVO);</span></span><br><span class="line">            <span class="keyword">return</span> Ok(todoItemVO);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 更新指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理HTTP PUT请求，路由为 &quot;api/TodoItem/&#123;id&#125;&quot;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 接收URL路径中的ID参数和请求体中的DTO对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待更新的待办事项ID，来自URL路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItem&quot;&gt;</span>包含更新信息的DTO，从请求体中解析<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含更新后待办事项VO的HTTP 200成功响应，如果未找到则由服务层抛出异常<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">HttpPut(<span class="string">&quot;&#123;id&#125;&quot;</span>)</span>] <span class="comment">// 指定此方法处理带有ID参数的HTTP PUT请求</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;TodoItemVO&gt;&gt; UpdateTodoItem(<span class="built_in">int</span> id, [FromBody] TodoItemDTO todoItem)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用服务层更新待办事项</span></span><br><span class="line">            <span class="comment">// 服务层负责验证ID是否存在、更新实体、保存更改并返回更新后的VO对象</span></span><br><span class="line">            TodoItemVO todoItemVO = _todoItemService.UpdateTodoItem(id, todoItem);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新或删除相关缓存，确保缓存数据一致性</span></span><br><span class="line">            <span class="comment">// 当数据更新时，对应的缓存应该被移除或更新</span></span><br><span class="line">            <span class="built_in">string</span> cacheKey = <span class="string">$&quot;TodoItem:<span class="subst">&#123;id&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">await</span> _cache.RemoveAsync(cacheKey);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回HTTP 200状态码和更新后的待办事项</span></span><br><span class="line">            <span class="comment">// 可以考虑添加异常处理，捕获可能的&quot;未找到&quot;异常并返回404状态码</span></span><br><span class="line">            <span class="keyword">return</span> Ok(todoItemVO);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理HTTP DELETE请求，路由为 &quot;api/TodoItem/&#123;id&#125;&quot;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从URL路径中获取ID参数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待删除的待办事项ID，来自URL路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含删除前待办事项信息的HTTP 200成功响应，如果未找到则由服务层抛出异常<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">HttpDelete(<span class="string">&quot;&#123;id&#125;&quot;</span>)</span>] <span class="comment">// 指定此方法处理带有ID参数的HTTP DELETE请求</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ActionResult&lt;TodoItemVO&gt;&gt; DeleteTodoItem(<span class="built_in">int</span> id)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用服务层删除待办事项</span></span><br><span class="line">            <span class="comment">// 服务层负责验证ID是否存在、删除实体并返回删除前的VO对象</span></span><br><span class="line">            TodoItemVO todoItemVO = _todoItemService.DeleteTodoItem(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 删除相关缓存，确保缓存数据一致性</span></span><br><span class="line">            <span class="comment">// 当数据被删除时，对应的缓存也应被移除</span></span><br><span class="line">            <span class="built_in">string</span> cacheKey = <span class="string">$&quot;TodoItem:<span class="subst">&#123;id&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">await</span> _cache.RemoveAsync(cacheKey);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回HTTP 200状态码和删除的待办事项信息</span></span><br><span class="line">            <span class="comment">// 注意：更符合RESTful设计的做法是返回204 No Content状态码</span></span><br><span class="line">            <span class="comment">// 改进建议：return NoContent();</span></span><br><span class="line">            <span class="keyword">return</span> Ok(todoItemVO);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 处理HTTP GET请求，路由为 &quot;api/TodoItem/paged&quot;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，默认为1<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数，默认为10<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，为null时不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段，默认为&quot;createdAt&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，默认为&quot;desc&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含分页待办事项列表的HTTP 200成功响应<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        [<span class="meta">HttpGet(<span class="string">&quot;paged&quot;</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> ActionResult&lt;List&lt;TodoItemVO&gt;&gt; GetPagedTodoItems(</span><br><span class="line">            [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageNumber = <span class="number">1</span>,      <span class="comment">// 从查询字符串获取页码</span></span><br><span class="line">            [<span class="meta">FromQuery</span>] <span class="built_in">int</span> pageSize = <span class="number">10</span>,       <span class="comment">// 从查询字符串获取页大小</span></span><br><span class="line">            [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? name = <span class="literal">null</span>,     <span class="comment">// 从查询字符串获取可选的名称筛选</span></span><br><span class="line">            [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? sortBy = <span class="literal">null</span>,   <span class="comment">// 从查询字符串获取可选的排序字段</span></span><br><span class="line">            [<span class="meta">FromQuery</span>] <span class="built_in">string</span>? order = <span class="literal">null</span>)    <span class="comment">// 从查询字符串获取可选的排序方向</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 验证分页参数的有效性</span></span><br><span class="line">            <span class="keyword">if</span> (pageNumber &lt; <span class="number">1</span>) pageNumber = <span class="number">1</span>;       <span class="comment">// 页码至少为1</span></span><br><span class="line">            <span class="keyword">if</span> (pageSize &lt; <span class="number">1</span>) pageSize = <span class="number">10</span>;          <span class="comment">// 页大小至少为1</span></span><br><span class="line">            <span class="keyword">if</span> (pageSize &gt; <span class="number">100</span>) pageSize = <span class="number">100</span>;       <span class="comment">// 限制最大页面大小，防止请求过多数据导致性能问题</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这里没有使用缓存，因为分页、筛选和排序的组合可能过多，不适合缓存</span></span><br><span class="line">            <span class="comment">// 每次请求都会直接访问数据库以获取最新的结果集</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用服务层获取分页数据，传递所有筛选和排序参数</span></span><br><span class="line">            <span class="keyword">var</span> pagedResult = _todoItemService.GetPagedTodoItems(pageNumber, pageSize, name, sortBy, order);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回分页结果</span></span><br><span class="line">            <span class="comment">// 可以考虑使用自定义结果类，包含分页元数据如总记录数、总页数等</span></span><br><span class="line">            <span class="keyword">return</span> Ok(pagedResult);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/04/21/NET-ASP-13/image-20250424154011205.png" alt="image-20250424154011205"></p>
<h1 id="5、使用Java常用标准Result格式"><a href="#5、使用Java常用标准Result格式" class="headerlink" title="5、使用Java常用标准Result格式"></a>5、使用Java常用标准Result格式</h1><ol>
<li>ApiResult</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> WebApp.Controllers;  <span class="comment">// 引入控制器命名空间，允许与控制器交互</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Result</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 通用响应结果包装类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 遵循Java常见的REST API响应格式标准</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 包含状态码、消息和数据三部分</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用于统一API接口的返回格式</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>响应数据的类型，使用泛型支持不同类型的返回数据<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ApiResult</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 状态码，表示请求处理的结果</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 一般约定：200表示成功，4xx表示客户端错误，5xx表示服务器错误</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 与HTTP状态码保持一致，便于客户端理解和处理</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Code &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;  <span class="comment">// HTTP状态码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 响应消息，用于描述请求处理结果</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 成功时通常为&quot;操作成功&quot;，失败时描述具体错误原因</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 提供人类可读的结果说明，增强API的可用性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Message &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;  <span class="comment">// 响应说明文本</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 响应数据</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 请求成功时包含业务数据，失败时可能为null或错误详情</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 是API调用的主要结果内容</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> T Data &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;  <span class="comment">// 业务数据，类型由泛型T决定</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 创建成功响应</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 生成标准的成功响应对象，状态码固定为200</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>业务数据，将被封装到返回对象中<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>成功消息，默认为&quot;操作成功&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>表示成功的响应结果对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult&lt;T&gt; <span class="title">Success</span>(<span class="params">T data, <span class="built_in">string</span> message = <span class="string">&quot;操作成功&quot;</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建并返回一个成功状态的响应对象</span></span><br><span class="line">            <span class="comment">// 使用HTTP 200状态码表示请求成功</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult&lt;T&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                Code = <span class="number">200</span>,           <span class="comment">// 成功状态码</span></span><br><span class="line">                Message = message,    <span class="comment">// 成功消息</span></span><br><span class="line">                Data = data           <span class="comment">// 业务数据</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 创建失败响应</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 生成自定义状态码和消息的失败响应对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 作为其他特定失败响应方法的基础方法</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;code&quot;&gt;</span>错误状态码，通常为4xx或5xx<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>错误消息，描述失败原因<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>附加数据，默认为默认值（引用类型为null）<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>表示失败的响应结果对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult&lt;T&gt; <span class="title">Fail</span>(<span class="params"><span class="built_in">int</span> code, <span class="built_in">string</span> message, T data = <span class="literal">default</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建并返回一个失败状态的响应对象</span></span><br><span class="line">            <span class="comment">// 允许自定义状态码和消息</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ApiResult&lt;T&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                Code = code,          <span class="comment">// 自定义错误码</span></span><br><span class="line">                Message = message,    <span class="comment">// 错误描述</span></span><br><span class="line">                Data = data           <span class="comment">// 可选的附加数据</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 创建未找到资源的响应</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 快速生成404错误响应，用于资源不存在的场景</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>错误消息，默认为&quot;资源不存在&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>表示资源不存在的响应结果对象，状态码为404<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult&lt;T&gt; <span class="title">NotFound</span>(<span class="params"><span class="built_in">string</span> message = <span class="string">&quot;资源不存在&quot;</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用基础Fail方法，使用HTTP 404状态码</span></span><br><span class="line">            <span class="comment">// 404表示&quot;Not Found&quot;，即请求的资源不存在</span></span><br><span class="line">            <span class="keyword">return</span> Fail(<span class="number">404</span>, message);  <span class="comment">// 复用Fail方法，使用404状态码</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 创建服务器错误响应</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 快速生成500错误响应，用于服务器内部错误场景</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;message&quot;&gt;</span>错误消息，默认为&quot;服务器内部错误&quot;<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>表示服务器错误的响应结果对象，状态码为500<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApiResult&lt;T&gt; <span class="title">Error</span>(<span class="params"><span class="built_in">string</span> message = <span class="string">&quot;服务器内部错误&quot;</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用基础Fail方法，使用HTTP 500状态码</span></span><br><span class="line">            <span class="comment">// 500表示&quot;Internal Server Error&quot;，即服务器内部错误</span></span><br><span class="line">            <span class="keyword">return</span> Fail(<span class="number">500</span>, message);  <span class="comment">// 复用Fail方法，使用500状态码</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>PageResult</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Result</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 分页数据包装类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 包含分页数据和分页元数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用于封装分页查询的结果，提供统一的分页数据结构</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 遵循Java常见的分页响应格式标准</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>分页项目的数据类型，使用泛型支持不同类型的数据项<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PageResult</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 分页数据项集合</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 包含当前页的实际数据记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 类型由泛型参数T决定，如List<span class="doctag">&lt;TodoItemVO&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> List&lt;T&gt; Records &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 当前页码</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 表示当前返回的是第几页数据</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从1开始计数，与前端分页控件保持一致</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Current &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 每页大小</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 表示每页包含的记录数量</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于前端分页控件的页大小设置</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Size &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 总记录数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 表示符合查询条件的数据总量</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于计算总页数和显示记录计数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Total &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 总页数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据总记录数和每页大小动态计算</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用Math.Ceiling确保能显示所有数据</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 只读属性，无需手动设置</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Pages =&gt; (<span class="built_in">int</span>)Math.Ceiling((<span class="built_in">double</span>)Total / Size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ITodoItemService</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> WebApp.Pojo.DTO;      <span class="comment">// 引入数据传输对象，用于接收客户端输入数据</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.Entity;   <span class="comment">// 引入实体类，表示数据库中的记录</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.VO;       <span class="comment">// 引入视图对象，用于向客户端返回数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Services</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 待办事项服务接口</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 定义了待办事项的业务逻辑操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 作为业务逻辑层的核心组件，处理待办事项的业务规则和转换逻辑</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 位于表示层(Controller)和数据访问层(Mapper)之间，协调数据流转和处理</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ITodoItemService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 以视图对象(VO)形式返回，适合前端展示</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 不包含筛选条件，返回系统中的所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>所有待办事项的VO集合，如果没有记录则返回空列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetAllTodoItems</span>()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据ID获取特定的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将数据库实体转换为视图对象返回</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 是获取单个待办事项详情的主要方法</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待办事项的唯一标识符<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>对应ID的待办事项视图对象，如果不存在可能抛出异常<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当找不到指定ID的待办事项时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">GetTodoItemById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 添加一个新的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将DTO转换为实体对象并保存，然后返回创建后的视图对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 负责验证数据、生成必要的元数据(如时间戳)并确保数据一致性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemDTO&quot;&gt;</span>包含新待办事项信息的DTO，由客户端提供<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>创建成功后的待办事项视图对象，包含生成的ID和时间戳<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当创建过程中发生错误时可能抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">AddTodoItem</span>(<span class="params">TodoItemDTO todoItemDTO</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 更新指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用DTO中的数据更新已有实体，并返回更新后的视图对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 负责验证ID存在性、更新时间戳并确保数据一致性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待更新待办事项的ID，用于定位数据库记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemDTO&quot;&gt;</span>包含更新信息的DTO，由客户端提供<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>更新后的待办事项视图对象，反映所有变更<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当找不到指定ID的待办事项或更新过程中发生错误时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">UpdateTodoItem</span>(<span class="params"><span class="built_in">int</span> id, TodoItemDTO todoItemDTO</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 执行删除操作并返回删除前的待办事项信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 确保在彻底删除前能获取待办事项的最后状态</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待删除待办事项的ID，用于定位数据库记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>删除前的待办事项视图对象，可用于撤销操作或通知客户端<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当找不到指定ID的待办事项时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">DeleteTodoItem</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 为前端分页展示提供灵活的数据查询能力</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 通过组合参数实现多样化的查询需求</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数，控制返回数据量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，为null时不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段，如&quot;id&quot;、&quot;name&quot;、&quot;createdAt&quot;等<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，&quot;asc&quot;为升序，&quot;desc&quot;为降序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合条件的分页待办事项集合，已应用筛选和排序<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>, <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取符合条件的待办事项总数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 主要用于支持分页功能，计算总页数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 与GetPagedTodoItems方法配合使用</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，与GetPagedTodoItems方法的筛选条件保持一致<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合筛选条件的待办事项总数<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetTodoItemCount</span>(<span class="params"><span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>TodoItemServiceImpl</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> WebApp.Mapper;        <span class="comment">// 引入数据映射层接口，用于数据访问操作</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.DTO;      <span class="comment">// 引入数据传输对象，用于接收客户端数据</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.Entity;   <span class="comment">// 引入实体对象，对应数据库表结构</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.VO;       <span class="comment">// 引入视图对象，用于向客户端返回数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Services.Impl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 待办事项服务实现类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实现了ITodoItemService接口定义的所有业务逻辑操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 作为连接表示层和数据访问层的桥梁，处理数据转换和业务规则</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TodoItemServiceImpl</span> : <span class="title">ITodoItemService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 待办事项数据映射器接口，用于数据访问操作</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 通过依赖注入获取具体实现</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> ITodoItemMapper _todoItemMapper; <span class="comment">// 数据访问层组件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 构造函数，通过依赖注入初始化数据映射器</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemMapper&quot;&gt;</span>待办事项数据映射器接口实现<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TodoItemServiceImpl</span>(<span class="params">ITodoItemMapper todoItemMapper</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _todoItemMapper = todoItemMapper;  <span class="comment">// 初始化数据映射器，采用依赖注入模式</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将从数据层获取的实体列表转换为视图对象列表</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>所有待办事项的视图对象集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetAllTodoItems</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用数据映射器获取所有待办事项实体</span></span><br><span class="line">            <span class="comment">// 此处不进行业务筛选，获取全部数据</span></span><br><span class="line">            List&lt;TodoItem&gt; todoItems = _todoItemMapper.GetAllTodoItems();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用LINQ将实体列表转换为VO列表并返回</span></span><br><span class="line">            <span class="comment">// 这里完成了从实体对象到视图对象的转换，确保数据表现层与持久化层的分离</span></span><br><span class="line">            <span class="comment">// 通过Select投影，避免了手动循环转换的冗余代码</span></span><br><span class="line">            <span class="keyword">return</span> todoItems.Select(item =&gt; <span class="keyword">new</span> TodoItemVO</span><br><span class="line">            &#123;</span><br><span class="line">                Id = item.Id,                  <span class="comment">// 复制ID</span></span><br><span class="line">                Name = item.Name,              <span class="comment">// 复制名称</span></span><br><span class="line">                IsComplete = item.IsComplete,  <span class="comment">// 复制完成状态</span></span><br><span class="line">                CreatedAt = item.CreatedAt,    <span class="comment">// 复制创建时间</span></span><br><span class="line">                UpdatedAt = item.UpdatedAt,    <span class="comment">// 复制更新时间</span></span><br><span class="line">                DeletedAt = item.DeletedAt     <span class="comment">// 复制删除时间（软删除标记）</span></span><br><span class="line">            &#125;).ToList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据ID获取特定的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果项目不存在则抛出异常</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待办事项的唯一标识符<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>对应ID的待办事项视图对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当找不到待办事项时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">GetTodoItemById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用数据映射器根据ID查找待办事项</span></span><br><span class="line">            <span class="comment">// 这是获取单个实体的基本操作</span></span><br><span class="line">            TodoItem todoItem = _todoItemMapper.GetTodoItemById(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果未找到项目，抛出异常</span></span><br><span class="line">            <span class="comment">// 这里体现了业务逻辑层的职责：验证数据存在性并处理异常情况</span></span><br><span class="line">            <span class="comment">// 确保业务操作的完整性和一致性</span></span><br><span class="line">            <span class="keyword">if</span> (todoItem == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Todo item not found&quot;</span>);  <span class="comment">// 抛出异常，表示找不到指定ID的待办事项</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将实体转换为视图对象并返回</span></span><br><span class="line">            <span class="comment">// 完成从持久化模型到展示模型的数据转换</span></span><br><span class="line">            <span class="comment">// 这种转换确保了内部数据模型与外部展现的分离</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TodoItemVO</span><br><span class="line">            &#123;</span><br><span class="line">                Id = todoItem.Id,                  <span class="comment">// 映射ID</span></span><br><span class="line">                Name = todoItem.Name,              <span class="comment">// 映射名称</span></span><br><span class="line">                IsComplete = todoItem.IsComplete,  <span class="comment">// 映射完成状态</span></span><br><span class="line">                CreatedAt = todoItem.CreatedAt,    <span class="comment">// 映射创建时间</span></span><br><span class="line">                UpdatedAt = todoItem.UpdatedAt,    <span class="comment">// 映射更新时间</span></span><br><span class="line">                DeletedAt = todoItem.DeletedAt     <span class="comment">// 映射删除时间</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 添加一个新的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将DTO转换为实体对象，保存后返回创建的视图对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemDTO&quot;&gt;</span>包含新待办事项信息的DTO<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>创建成功后的待办事项视图对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当创建操作失败时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">AddTodoItem</span>(<span class="params">TodoItemDTO todoItemDTO</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建新的待办事项实体，设置适当的初始值</span></span><br><span class="line">            <span class="comment">// 体现业务逻辑层的职责：从DTO创建实体对象，并设置必要的默认值</span></span><br><span class="line">            <span class="comment">// 这里处理了数据来源到数据存储的转换过程</span></span><br><span class="line">            TodoItem todoItem = <span class="keyword">new</span> TodoItem(</span><br><span class="line">                    todoId: Random.Shared.Next(),        <span class="comment">// 生成随机ID，在实际应用中应使用更可靠的ID生成策略，如GUID或数据库自增</span></span><br><span class="line">                    id: todoItemDTO.Id,                  <span class="comment">// 使用DTO提供的ID</span></span><br><span class="line">                    name: todoItemDTO.Name,              <span class="comment">// 使用DTO提供的名称</span></span><br><span class="line">                    isComplete: todoItemDTO.IsComplete,  <span class="comment">// 使用DTO提供的完成状态</span></span><br><span class="line">                    createdAt: DateTime.Now,             <span class="comment">// 设置创建时间为当前时间，这是业务规则的一部分</span></span><br><span class="line">                    updatedAt: DateTime.Now);            <span class="comment">// 设置更新时间为当前时间，初始与创建时间相同</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用数据映射器添加新项目到数据存储</span></span><br><span class="line">            <span class="comment">// 将业务逻辑处理完的实体委托给数据访问层保存</span></span><br><span class="line">            _todoItemMapper.AddTodoItem(todoItem);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 验证添加操作是否成功，从数据存储中重新获取项目</span></span><br><span class="line">            <span class="comment">// 这是一种安全实践，确认数据确实被正确保存</span></span><br><span class="line">            TodoItem todoItemCreate = _todoItemMapper.GetTodoItemById(todoItemDTO.Id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 注意：这里有一个bug，应该检查todoItemCreate而不是todoItem</span></span><br><span class="line">            <span class="comment">// 修正后的代码应该是: if (todoItemCreate == null)</span></span><br><span class="line">            <span class="comment">// 当前代码无法正确验证数据是否成功保存</span></span><br><span class="line">            <span class="keyword">if</span> (todoItem == <span class="literal">null</span>)  <span class="comment">// 这是一个bug，应该检查todoItemCreate</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Todo item not found&quot;</span>);  <span class="comment">// 抛出异常，表示创建的待办事项不存在</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将实体转换为视图对象并返回给调用方</span></span><br><span class="line">            <span class="comment">// 完成从实体对象到视图对象的转换</span></span><br><span class="line">            <span class="comment">// 这种转换确保了数据在不同层之间的安全传递</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TodoItemVO</span><br><span class="line">            &#123;</span><br><span class="line">                Id = todoItem.Id,                  <span class="comment">// 映射ID</span></span><br><span class="line">                Name = todoItem.Name,              <span class="comment">// 映射名称</span></span><br><span class="line">                IsComplete = todoItem.IsComplete,  <span class="comment">// 映射完成状态</span></span><br><span class="line">                CreatedAt = todoItem.CreatedAt,    <span class="comment">// 映射创建时间</span></span><br><span class="line">                UpdatedAt = todoItem.UpdatedAt,    <span class="comment">// 映射更新时间</span></span><br><span class="line">                DeletedAt = todoItem.DeletedAt     <span class="comment">// 映射删除时间（通常为null）</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 更新指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用DTO中的数据更新已有实体，保存后返回更新的视图对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待更新待办事项的ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemDTO&quot;&gt;</span>包含更新信息的DTO<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>更新后的待办事项视图对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当待办事项不存在或更新失败时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">UpdateTodoItem</span>(<span class="params"><span class="built_in">int</span> id, TodoItemDTO todoItemDTO</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用数据映射器根据ID查找待办事项</span></span><br><span class="line">            <span class="comment">// 确保待更新的数据确实存在</span></span><br><span class="line">            TodoItem todoItem = _todoItemMapper.GetTodoItemById(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果未找到项目，抛出异常</span></span><br><span class="line">            <span class="comment">// 验证数据存在性，体现业务逻辑层的职责</span></span><br><span class="line">            <span class="comment">// 确保操作的前置条件得到满足</span></span><br><span class="line">            <span class="keyword">if</span> (todoItem == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Todo item not found&quot;</span>);  <span class="comment">// 抛出异常，表示找不到要更新的待办事项</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 用DTO中的数据更新实体属性</span></span><br><span class="line">            <span class="comment">// 体现业务逻辑层职责：将输入数据映射到实体对象，并更新必要的元数据</span></span><br><span class="line">            <span class="comment">// 这里实现了数据的部分更新，保留了不需要修改的字段</span></span><br><span class="line">            todoItem.Id = todoItemDTO.Id;                 <span class="comment">// 更新ID</span></span><br><span class="line">            todoItem.Name = todoItemDTO.Name;             <span class="comment">// 更新名称</span></span><br><span class="line">            todoItem.IsComplete = todoItemDTO.IsComplete; <span class="comment">// 更新完成状态</span></span><br><span class="line">            todoItem.UpdatedAt = DateTime.Now;            <span class="comment">// 更新修改时间为当前时间，体现业务规则</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用数据映射器更新项目在数据存储中的记录</span></span><br><span class="line">            <span class="comment">// 将修改后的实体委托给数据访问层保存</span></span><br><span class="line">            _todoItemMapper.UpdateTodoItem(id, todoItem);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 验证更新操作是否成功，从数据存储中重新获取项目</span></span><br><span class="line">            <span class="comment">// 这是一种安全实践，确认数据确实被正确更新</span></span><br><span class="line">            TodoItem todoItemUpdate = _todoItemMapper.GetTodoItemById(todoItemDTO.Id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 注意：这里有一个bug，应该检查todoItemUpdate而不是todoItem</span></span><br><span class="line">            <span class="comment">// 修正后的代码应该是: if (todoItemUpdate == null)</span></span><br><span class="line">            <span class="comment">// 当前代码无法正确验证数据是否成功更新</span></span><br><span class="line">            <span class="keyword">if</span> (todoItem == <span class="literal">null</span>)  <span class="comment">// 这是一个bug，应该检查todoItemUpdate</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Todo item not found&quot;</span>);  <span class="comment">// 抛出异常，表示更新后的待办事项不存在</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将更新后的实体转换为视图对象并返回给调用方</span></span><br><span class="line">            <span class="comment">// 这种转换确保了数据在不同层之间的安全传递</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TodoItemVO</span><br><span class="line">            &#123;</span><br><span class="line">                Id = todoItem.Id,                  <span class="comment">// 映射ID</span></span><br><span class="line">                Name = todoItem.Name,              <span class="comment">// 映射名称</span></span><br><span class="line">                IsComplete = todoItem.IsComplete,  <span class="comment">// 映射完成状态</span></span><br><span class="line">                CreatedAt = todoItem.CreatedAt,    <span class="comment">// 映射创建时间</span></span><br><span class="line">                UpdatedAt = todoItem.UpdatedAt,    <span class="comment">// 映射更新时间（已被更新为当前时间）</span></span><br><span class="line">                DeletedAt = todoItem.DeletedAt     <span class="comment">// 映射删除时间</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 执行删除操作并返回删除前的待办事项信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待删除待办事项的ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>删除前的待办事项视图对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;Exception&quot;&gt;</span>当待办事项不存在时抛出<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItemVO <span class="title">DeleteTodoItem</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用数据映射器根据ID查找待办事项</span></span><br><span class="line">            <span class="comment">// 确保待删除的数据确实存在</span></span><br><span class="line">            TodoItem todoItem = _todoItemMapper.GetTodoItemById(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果未找到项目，抛出异常</span></span><br><span class="line">            <span class="comment">// 验证数据存在性，体现业务逻辑层的职责</span></span><br><span class="line">            <span class="comment">// 确保操作的前置条件得到满足</span></span><br><span class="line">            <span class="keyword">if</span> (todoItem == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Todo item not found&quot;</span>);  <span class="comment">// 抛出异常，表示找不到要删除的待办事项</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 在删除前，创建视图对象以保存项目的信息用于返回</span></span><br><span class="line">            <span class="comment">// 这样即使记录被删除，我们仍然能够向客户端返回被删除的数据</span></span><br><span class="line">            <span class="comment">// 体现了设计考虑：保留删除前的数据供客户端使用，比如用于撤销操作</span></span><br><span class="line">            TodoItemVO result = <span class="keyword">new</span> TodoItemVO</span><br><span class="line">            &#123;</span><br><span class="line">                Id = todoItem.Id,                  <span class="comment">// 保存ID</span></span><br><span class="line">                Name = todoItem.Name,              <span class="comment">// 保存名称</span></span><br><span class="line">                IsComplete = todoItem.IsComplete,  <span class="comment">// 保存完成状态</span></span><br><span class="line">                CreatedAt = todoItem.CreatedAt,    <span class="comment">// 保存创建时间</span></span><br><span class="line">                UpdatedAt = todoItem.UpdatedAt,    <span class="comment">// 保存更新时间</span></span><br><span class="line">                DeletedAt = todoItem.DeletedAt     <span class="comment">// 保存删除时间</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用数据映射器从数据存储中删除项目</span></span><br><span class="line">            <span class="comment">// 将删除操作委托给数据访问层执行</span></span><br><span class="line">            _todoItemMapper.DeleteTodoItem(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回删除前的项目信息</span></span><br><span class="line">            <span class="comment">// 这样客户端可以知道被删除的是什么数据</span></span><br><span class="line">            <span class="comment">// 有助于提供更好的用户体验，如显示&quot;已删除xxx项目&quot;的消息</span></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>当前页码，从1开始计数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，null表示不筛选<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段，null使用默认排序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，null使用默认方向<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>指定页的待办事项视图对象集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItemVO&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                                         <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 调用数据访问层获取分页数据，传递所有筛选和排序参数</span></span><br><span class="line">            <span class="comment">// 体现了分层设计：将复杂的查询逻辑委托给数据访问层</span></span><br><span class="line">            <span class="comment">// 服务层专注于业务逻辑和数据转换，而不直接处理数据查询的细节</span></span><br><span class="line">            <span class="keyword">var</span> todoItems = _todoItemMapper.GetPagedTodoItems(pageNumber, pageSize, name, sortBy, order);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将实体对象转换为视图对象</span></span><br><span class="line">            <span class="comment">// 确保返回给控制层的是展示层模型，而非持久层模型</span></span><br><span class="line">            <span class="comment">// 使用LINQ进行批量转换，提高代码效率和可读性</span></span><br><span class="line">            <span class="keyword">return</span> todoItems.Select(item =&gt; <span class="keyword">new</span> TodoItemVO</span><br><span class="line">            &#123;</span><br><span class="line">                Id = item.Id,                  <span class="comment">// 映射ID</span></span><br><span class="line">                Name = item.Name,              <span class="comment">// 映射名称</span></span><br><span class="line">                IsComplete = item.IsComplete,  <span class="comment">// 映射完成状态</span></span><br><span class="line">                CreatedAt = item.CreatedAt,    <span class="comment">// 映射创建时间</span></span><br><span class="line">                UpdatedAt = item.UpdatedAt,    <span class="comment">// 映射更新时间</span></span><br><span class="line">                DeletedAt = item.DeletedAt     <span class="comment">// 映射删除时间</span></span><br><span class="line">            &#125;).ToList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取符合条件的待办事项总数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 主要用于支持分页功能，计算总页数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，与GetPagedTodoItems方法的筛选条件保持一致<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合筛选条件的待办事项总数<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetTodoItemCount</span>(<span class="params"><span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 直接委托给数据访问层执行记录计数</span></span><br><span class="line">            <span class="comment">// 保持与GetPagedTodoItems方法使用的筛选条件一致，确保分页的准确性</span></span><br><span class="line">            <span class="keyword">return</span> _todoItemMapper.GetTodoItemCount(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ITodoItemMapper</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Xml.Linq;       <span class="comment">// 引入XML操作相关命名空间，用于可能的XML数据处理</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.Entity;    <span class="comment">// 引入实体类命名空间，包含TodoItem实体定义</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Mapper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 待办事项数据映射器接口</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 定义了对待办事项(TodoItem)实体的数据访问操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 作为数据访问层的核心组件，负责数据操作的抽象</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 遵循数据映射器模式，将领域模型与数据访问逻辑分离</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ITodoItemMapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从数据存储中检索所有未删除的待办事项记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 不包含任何过滤或排序逻辑，返回原始数据集合</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>所有待办事项的集合，如果没有记录则返回空列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetAllTodoItems</span>()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据ID获取特定的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从数据存储中查找匹配指定ID的单个待办事项记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待办事项的唯一标识符<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>对应ID的待办事项对象，如果不存在则返回null<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItem <span class="title">GetTodoItemById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 添加一个新的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将待办事项对象持久化到数据存储中</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 不负责生成ID或设置时间戳，调用方应确保这些字段已正确设置</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItem&quot;&gt;</span>需要添加的待办事项对象，应包含完整的必要信息<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddTodoItem</span>(<span class="params">TodoItem todoItem</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 更新指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用提供的对象替换数据存储中的现有记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 调用方负责确保更新的字段值合法且时间戳已更新</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待更新待办事项的ID，用于定位记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItem&quot;&gt;</span>包含更新信息的待办事项对象，会完全替换原有记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateTodoItem</span>(<span class="params"><span class="built_in">int</span> id, TodoItem todoItem</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除指定ID的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从数据存储中物理删除记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 如果实现软删除，则应设置DeletedAt字段而非物理删除</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待删除待办事项的ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DeleteTodoItem</span>(<span class="params"><span class="built_in">int</span> id</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 实现数据的分页查询，提高大数据量下的查询效率和性能</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 可组合使用多种查询条件，满足复杂的数据展示需求</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>页码，指定要返回的页数，从1开始<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>页大小，指定每页包含的记录数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选，按名称模糊匹配过滤记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段，如&quot;id&quot;、&quot;name&quot;、&quot;createdAt&quot;等<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，&quot;asc&quot;表示升序，&quot;desc&quot;表示降序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合条件的待办事项集合，已应用分页、筛选和排序<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>, <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取符合条件的待办事项总数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于分页功能中计算总页数和显示记录总数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 与GetPagedTodoItems方法配合使用，确保分页的完整性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，与GetPagedTodoItems方法的筛选条件保持一致<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合筛选条件的待办事项总数<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetTodoItemCount</span>(<span class="params"><span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>TodoItemMapperImpl</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> WebApp.DB;             <span class="comment">// 引入数据库上下文命名空间，包含TodoItemDbContext类</span></span><br><span class="line"><span class="keyword">using</span> WebApp.Pojo.Entity;    <span class="comment">// 引入实体类命名空间，包含TodoItem实体类定义</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebApp.Mapper.Impl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> TodoItem 数据映射器的实现类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 提供对待办事项数据的数据库操作实现</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实现 ITodoItemMapper 接口定义的所有数据访问操作</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 使用 Entity Framework Core 框架与数据库进行交互</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TodoItemMapperImpl</span> : <span class="title">ITodoItemMapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 数据库上下文，用于与数据库交互</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 通过依赖注入获取，生命周期由容器管理</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 提供对 TodoItems 表的访问和操作能力</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> TodoItemDbContext _context; <span class="comment">// 数据库上下文实例，封装了数据库连接和操作</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 构造函数，通过依赖注入初始化数据库上下文</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 遵循依赖注入原则，降低类之间的耦合度</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItemDbContext&quot;&gt;</span>数据库上下文实例，由依赖注入容器提供<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TodoItemMapperImpl</span>(<span class="params">TodoItemDbContext todoItemDbContext</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _context = todoItemDbContext;  <span class="comment">// 初始化数据库上下文，为后续数据库操作做准备</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取所有待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从数据库中检索所有 TodoItem 记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 不包含任何过滤条件，返回表中的所有数据</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>包含所有待办事项的集合，如果没有记录则返回空列表<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetAllTodoItems</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用 EF Core 的 ToList 方法将所有记录加载到内存中</span></span><br><span class="line">            <span class="comment">// 这会执行 SELECT * FROM todo_item 查询</span></span><br><span class="line">            <span class="comment">// 将查询结果转换为List&lt;TodoItem&gt;集合并返回</span></span><br><span class="line">            <span class="keyword">return</span> _context.TodoItems.ToList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据 ID 获取特定的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从数据库中查找匹配指定 ID 的 TodoItem</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用主键索引进行高效查询</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待办事项的唯一标识符<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>对应 ID 的待办事项对象，如果不存在则返回 null<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TodoItem <span class="title">GetTodoItemById</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用 EF Core 的 Find 方法根据主键查找记录</span></span><br><span class="line">            <span class="comment">// Find 方法会先检查跟踪的实体，如果没有再查询数据库</span></span><br><span class="line">            <span class="comment">// 这会执行 SELECT * FROM todo_item WHERE Id = &#123;id&#125; LIMIT 1 查询</span></span><br><span class="line">            <span class="comment">// 如果找不到记录，返回null</span></span><br><span class="line">            <span class="keyword">return</span> _context.TodoItems.Find(id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 添加一个新的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将 TodoItem 对象插入到数据库中</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 完成后会自动保存更改</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItem&quot;&gt;</span>需要添加的待办事项对象，应包含完整的必要信息<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddTodoItem</span>(<span class="params">TodoItem todoItem</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用 EF Core 的 Add 方法将新记录添加到上下文</span></span><br><span class="line">            <span class="comment">// 这会将实体标记为&quot;已添加&quot;状态，但还未实际写入数据库</span></span><br><span class="line">            <span class="comment">// 实体将在下一次调用SaveChanges时插入数据库</span></span><br><span class="line">            _context.TodoItems.Add(todoItem);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存更改到数据库</span></span><br><span class="line">            <span class="comment">// 这会执行 INSERT INTO todo_item (...) VALUES (...) 查询</span></span><br><span class="line">            <span class="comment">// 所有被跟踪且状态为&quot;已添加&quot;的实体都会被持久化到数据库</span></span><br><span class="line">            _context.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 更新指定 ID 的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 使用传入的 TodoItem 对象更新数据库中的记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 完成后会自动保存更改</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待更新待办事项的 ID，用于定位记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;todoItem&quot;&gt;</span>包含更新信息的待办事项对象，会完全替换原有记录<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;remarks&gt;</span>注意：此方法不检查记录是否存在，可能导致异常。实际应用中应先确认记录存在<span class="doctag">&lt;/remarks&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateTodoItem</span>(<span class="params"><span class="built_in">int</span> id, TodoItem todoItem</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用 EF Core 的 Update 方法更新记录</span></span><br><span class="line">            <span class="comment">// 这会将实体标记为&quot;已修改&quot;状态，但还未实际写入数据库</span></span><br><span class="line">            <span class="comment">// 注意：此处没有检查 id 参数与 todoItem.Id 是否一致</span></span><br><span class="line">            <span class="comment">// 也没有检查记录是否存在，可能导致异常</span></span><br><span class="line">            _context.TodoItems.Update(todoItem);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存更改到数据库</span></span><br><span class="line">            <span class="comment">// 这会执行 UPDATE todo_item SET ... WHERE Id = &#123;todoItem.Id&#125; 查询</span></span><br><span class="line">            <span class="comment">// 所有被跟踪且状态为&quot;已修改&quot;的实体都会被更新到数据库</span></span><br><span class="line">            _context.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除指定 ID 的待办事项</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从数据库中移除匹配的记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 采用物理删除方式，完全从数据库中移除记录</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>待删除待办事项的 ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;remarks&gt;</span>注意：如果记录不存在，此方法不会执行任何操作，也不会抛出异常<span class="doctag">&lt;/remarks&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DeleteTodoItem</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 使用 EF Core 的 Find 方法查找记录</span></span><br><span class="line">            <span class="comment">// 这确保只有在记录存在时才执行删除操作</span></span><br><span class="line">            <span class="comment">// 首先尝试获取要删除的实体</span></span><br><span class="line">            <span class="keyword">var</span> item = _context.TodoItems.Find(id);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 验证实体是否存在</span></span><br><span class="line">            <span class="keyword">if</span> (item != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 如果记录存在，使用 Remove 方法删除记录</span></span><br><span class="line">                <span class="comment">// 这会将实体标记为&quot;已删除&quot;状态，但还未实际从数据库中删除</span></span><br><span class="line">                _context.TodoItems.Remove(item);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 保存更改到数据库</span></span><br><span class="line">                <span class="comment">// 这会执行 DELETE FROM todo_item WHERE Id = &#123;id&#125; 查询</span></span><br><span class="line">                <span class="comment">// 所有被跟踪且状态为&quot;已删除&quot;的实体都会从数据库中移除</span></span><br><span class="line">                _context.SaveChanges();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果记录不存在，不执行任何操作，静默返回</span></span><br><span class="line">            <span class="comment">// 这种设计使方法在记录不存在时也能安全执行，不会抛出异常</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取分页的待办事项列表，支持可选的名称筛选和排序</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 根据给定的参数从数据库中检索并返回符合条件的数据子集</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageNumber&quot;&gt;</span>要获取的页码，从1开始<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>每页包含的记录数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，支持包含匹配<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;sortBy&quot;&gt;</span>可选的排序字段名称<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;order&quot;&gt;</span>可选的排序方向，&quot;asc&quot;表示升序，其他值表示降序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>分页过滤后的待办事项集合<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;TodoItem&gt; <span class="title">GetPagedTodoItems</span>(<span class="params"><span class="built_in">int</span> pageNumber, <span class="built_in">int</span> pageSize, <span class="built_in">string</span>? name = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="built_in">string</span>? sortBy = <span class="literal">null</span>, <span class="built_in">string</span>? order = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建基础查询</span></span><br><span class="line">            <span class="comment">// 定义一个IQueryable&lt;TodoItem&gt;，这样可以延迟执行查询，只在需要时才访问数据库</span></span><br><span class="line">            <span class="comment">// 使用LINQ查询构建器模式，逐步添加条件，最后执行</span></span><br><span class="line">            IQueryable&lt;TodoItem&gt; query = _context.TodoItems;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 应用名称筛选</span></span><br><span class="line">            <span class="comment">// 如果提供了名称参数，则添加WHERE条件</span></span><br><span class="line">            <span class="comment">// 使用Contains进行模糊查询，相当于SQL中的LIKE &#x27;%name%&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(name))</span><br><span class="line">            &#123;</span><br><span class="line">                query = query.Where(t =&gt; t.Name != <span class="literal">null</span> &amp;&amp; t.Name.Contains(name));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 确定排序方向</span></span><br><span class="line">            <span class="comment">// 解析order参数，确定是升序还是降序排序</span></span><br><span class="line">            <span class="comment">// 如果order参数是&quot;asc&quot;则为升序，否则为降序</span></span><br><span class="line">            <span class="built_in">bool</span> isAscending = !<span class="built_in">string</span>.IsNullOrEmpty(order) &amp;&amp; order.ToLower() == <span class="string">&quot;asc&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 应用排序</span></span><br><span class="line">            <span class="comment">// 根据sortBy参数选择排序字段，并应用之前确定的排序方向</span></span><br><span class="line">            <span class="comment">// 使用switch语句处理不同的排序字段，提供灵活的排序功能</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(sortBy))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">switch</span> (sortBy.ToLower())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;id&quot;</span>:</span><br><span class="line">                        <span class="comment">// 按ID排序</span></span><br><span class="line">                        query = isAscending ? query.OrderBy(t =&gt; t.Id) : query.OrderByDescending(t =&gt; t.Id);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;name&quot;</span>:</span><br><span class="line">                        <span class="comment">// 按名称排序</span></span><br><span class="line">                        query = isAscending ? query.OrderBy(t =&gt; t.Name) : query.OrderByDescending(t =&gt; t.Name);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;iscomplete&quot;</span>:</span><br><span class="line">                        <span class="comment">// 按完成状态排序</span></span><br><span class="line">                        query = isAscending ? query.OrderBy(t =&gt; t.IsComplete) : query.OrderByDescending(t =&gt; t.IsComplete);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;updatedat&quot;</span>:</span><br><span class="line">                        <span class="comment">// 按更新时间排序</span></span><br><span class="line">                        query = isAscending ? query.OrderBy(t =&gt; t.UpdatedAt) : query.OrderByDescending(t =&gt; t.UpdatedAt);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;createdat&quot;</span>:</span><br><span class="line">                        <span class="comment">// 按创建时间排序</span></span><br><span class="line">                        query = isAscending ? query.OrderBy(t =&gt; t.CreatedAt) : query.OrderByDescending(t =&gt; t.CreatedAt);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="literal">default</span>:</span><br><span class="line">                        <span class="comment">// 默认按创建时间排序（当提供了不支持的排序字段时）</span></span><br><span class="line">                        query = isAscending ? query.OrderBy(t =&gt; t.CreatedAt) : query.OrderByDescending(t =&gt; t.CreatedAt);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 默认按创建时间降序排序</span></span><br><span class="line">                <span class="comment">// 如果没有指定排序字段，则使用创建时间降序作为默认排序</span></span><br><span class="line">                <span class="comment">// 新创建的待办事项会显示在列表前面</span></span><br><span class="line">                query = query.OrderByDescending(t =&gt; t.CreatedAt);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 应用分页</span></span><br><span class="line">            <span class="comment">// 使用Skip和Take方法实现分页</span></span><br><span class="line">            <span class="comment">// Skip跳过前(pageNumber-1)*pageSize条记录，Take获取pageSize条记录</span></span><br><span class="line">            <span class="comment">// 例如：要获取第2页，每页10条，则跳过前10条，再取10条</span></span><br><span class="line">            <span class="keyword">return</span> query</span><br><span class="line">                .Skip((pageNumber - <span class="number">1</span>) * pageSize)  <span class="comment">// 跳过之前页的记录</span></span><br><span class="line">                .Take(pageSize)                     <span class="comment">// 获取当前页的记录数</span></span><br><span class="line">                .ToList();                          <span class="comment">// 执行查询并返回结果列表</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取符合条件的待办事项总数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 用于分页功能中计算总页数和显示记录总数</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 与GetPagedTodoItems方法配合使用，确保分页的完整性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>可选的名称筛选条件，与GetPagedTodoItems方法的筛选条件保持一致<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>符合筛选条件的待办事项总数<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetTodoItemCount</span>(<span class="params"><span class="built_in">string</span>? name = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建基础查询</span></span><br><span class="line">            <span class="comment">// 定义一个IQueryable&lt;TodoItem&gt;，便于添加条件过滤</span></span><br><span class="line">            <span class="comment">// 使用与GetPagedTodoItems相同的筛选条件，确保计数与分页数据一致</span></span><br><span class="line">            IQueryable&lt;TodoItem&gt; query = _context.TodoItems;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 应用名称筛选</span></span><br><span class="line">            <span class="comment">// 如果提供了名称参数，则添加WHERE条件</span></span><br><span class="line">            <span class="comment">// 需要与GetPagedTodoItems方法使用相同的筛选逻辑</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(name))</span><br><span class="line">            &#123;</span><br><span class="line">                query = query.Where(t =&gt; t.Name != <span class="literal">null</span> &amp;&amp; t.Name.Contains(name));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 返回符合条件的记录总数</span></span><br><span class="line">            <span class="comment">// Count()方法会生成SELECT COUNT(*) FROM查询，在数据库中执行计数</span></span><br><span class="line">            <span class="comment">// 比将所有数据加载到内存中再计数更高效</span></span><br><span class="line">            <span class="keyword">return</span> query.Count();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后构建了如下的工程</p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424164944178.png" alt="image-20250424164944178"></p>
<p>1、查询结果</p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424165027873.png" alt="image-20250424165027873"></p>
<p><img src="/2025/04/21/NET-ASP-13/image-20250424165051889.png" alt="image-20250424165051889"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://alsl521.github.io">kyl</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://alsl521.github.io/2025/04/21/NET-ASP-13/">https://alsl521.github.io/2025/04/21/NET-ASP-13/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://alsl521.github.io" target="_blank">kyl的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C#</a></div><div class="post-share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/04/18/NET-ASP-12/" title="ASP.NET学习记录-12-实践2-使用MySQL数据库"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">ASP.NET学习记录-12-实践2-使用MySQL数据库</div></div><div class="info-2"><div class="info-item-1">1、配置数据库 首先连接数据库   然后连接已有数据库，或者是创建新的数据库   随后在选择的数据库中选择或创建新的表，并且添加初始数据  由于是利用软件自动生成的数据，数据以仅作示例，没有特定含义。    2、配置 MySQL 所需包在使用数据库时，由于可能不包含必要的数据库插件，所以需要安装以下NuGet包，并且需要注意版本一致性：  Microsoft.EntityFrameworkCore Microsoft.EntityFrameworkCore.Design Microsoft.EntityFrameworkCore.Tools Pomelo.EntityFrameworkCore.MySql   3、配置 MySQL 上下文 TodoItemDbContext 类，它是一个 Entity Framework Core (EF Core) 的数据库上下文类，主要用于管理与数据库的交互。TodoItemDbContext 继承自 DbContext，是 EF Core...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/08/NET-ASP-01/" title="ASP.NET学习记录-01-基础知识"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-01-基础知识</div></div><div class="info-2"><div class="info-item-1">视频教程为：ASP.NET Core Deep-Dive in .NET 9 | Udemy 1、.NET Core.NET Core 是微软开发的开源、跨平台应用程序开发框架，旨在为现代云原生、微服务及高性能场景提供支持。以下是其核心特性与定位的详细说明：  一、核心定义与定位 跨平台支持 .NET Core 可在 Windows、Linux、macOS 等操作系统上运行，并支持 x86、x64、ARM 等多种架构。 这种跨平台能力使其成为开发云原生、容器化应用（如 Docker）的理想选择。  开源与社区驱动 作为 MIT 协议下的开源项目，.NET Core 的代码托管于 GitHub，接受社区贡献，确保了技术透明度和快速迭代。    二、架构与技术特性 模块化设计 采用包化（Packages）管理，开发者可按需引用组件，减少应用体积，与传统的 .NET Framework 打包式安装形成对比。例如，通过 1dotnet restore  命令可动态还原依赖的 NuGet 包。  高性能运行时  RyuJIT 编译器：相比传统 JIT，性能提升约 25%，支持 SIMD...</div></div></div></a><a class="pagination-related" href="/2025/04/08/NET-ASP-02/" title="ASP.NET学习记录-02-最小API模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-02-最小API模式</div></div><div class="info-2"><div class="info-item-1">1、创建第一个ASP.NET应用（Minimal API）1.创建新项目 选择新的空项目  设定基本信息  使用最新版.NET作为学习内容  2.项目架构简介与解析 1. 解决方案（Solution） 名称：MyFirstWebApplication 作用： 作为容器管理多个相关项目（当前仅包含一个项目 WebApplication）。 支持团队协作和复杂应用的模块化开发（如Web API、类库、单元测试等）。   关键点： 可通过解决方案配置统一管理所有项目的依赖和环境设置。   新增项目 右键单击解决方案-&gt;添加-&gt;新建项目      2. 项目（Project: WebApplication） 核心结构：包含构建和运行Web应用所需的所有文件与配置，分为以下关键部分：  a. Connected Services 文件夹 作用： 存储与外部服务的连接配置（如数据库、Azure服务、第三方API）。 通过右键添加服务（如Entity Framework、Azure认证），自动生成连接配置文件。   示例：添加Azure...</div></div></div></a><a class="pagination-related" href="/2025/04/08/NET-ASP-03/" title="ASP.NET学习记录-03-中间件管道"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-08</div><div class="info-item-2">ASP.NET学习记录-03-中间件管道</div></div><div class="info-2"><div class="info-item-1">1、中间件管道简介在 C# ASP.NET Core 中，中间件管道是处理 HTTP 请求和响应的核心机制，通过将多个中间件按顺序串联成一个处理流程，实现灵活的请求处理和业务逻辑组合。以下是其核心要点：  1. 中间件管道的基本概念 中间件（Middleware）：是管道中的独立组件，负责处理 HTTP 请求和响应。每个中间件可以：  对请求进行预处理（如日志、身份验证）。  调用下一个中间件（通过 next()），或直接终止处理（短路）。  对响应进行后处理（如修改响应头、记录耗时）。      管道（Pipeline）：由多个中间件按注册顺序串联而成，形成一个“请求→处理→响应”的流程。请求按顺序经过所有中间件，而响应则逆序返回  。    2. 管道的工作模式：1-n 然后 n-1 请求阶段（正向传递）：请求从第一个中间件开始，依次传递至最后一个中间件（终结点），形成“1→2→3”的顺序 。  响应阶段（逆向返回）：处理完成后，响应从终结点开始，逆序返回至第一个中间件，形成“3→2→1”的顺序  。 示例 123Middleware One: Request Start...</div></div></div></a><a class="pagination-related" href="/2025/04/10/NET-ASP-04/" title="ASP.NET学习记录-03-路由"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-10</div><div class="info-item-2">ASP.NET学习记录-03-路由</div></div><div class="info-2"><div class="info-item-1">1、Routing和Endpoints简介在ASP.NET Core中，**路由（Routing）和终结点（Endpoints）**是处理HTTP请求的核心机制，它们共同构成了请求分发的管道系统。以下是对两者的详细介绍：  一、路由（Routing）路由的核心作用是将传入的HTTP请求根据URL路径和HTTP方法匹配到对应的处理逻辑（终结点）。在ASP.NET Core中，路由系统被称为终结点路由（Endpoint Routing）。 主要功能与工作流程 匹配请求：通过UseRouting中间件（即EndpointRoutingMiddleware）扫描应用中所有注册的终结点，根据请求的URL和HTTP方法选择最匹配的终结点 。示例代码：  12345app.UseRouting();app.UseEndpoints(endpoints =&gt; &#123;    endpoints.MapGet(&quot;/&quot;, async context =&gt; &#123; ......</div></div></div></a><a class="pagination-related" href="/2025/04/11/NET-ASP-05/" title="ASP.NET学习记录-05-模型数据绑定"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">ASP.NET学习记录-05-模型数据绑定</div></div><div class="info-2"><div class="info-item-1">1、模型绑定定义模型绑定是ASP.NET Core中将HTTP请求数据自动映射到方法参数或对象属性的机制。其核心工作流程：  数据来源：  路由参数（URL片段） 查询字符串（?key&#x3D;value） 请求体（表单&#x2F;JSON&#x2F;XML） 请求头 文件上传   典型应用：   12345678910111213// 自动绑定路由参数和查询参数[HttpGet(&quot;/products/&#123;id&#125;&quot;)]public IActionResult GetProduct(int id, [FromQuery] string category) &#123;    // id来自路由参数，category来自查询字符串&#125;// 自动绑定JSON请求体[HttpPost]public IActionResult Create([FromBody] Product product)&#123;    //...</div></div></div></a><a class="pagination-related" href="/2025/04/15/NET-ASP-09/" title="ASP.NET学习记录-09-MVC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-15</div><div class="info-item-2">ASP.NET学习记录-09-MVC</div></div><div class="info-2"><div class="info-item-1">1、MVC PatternASP.NET中的MVC（Model-View-Controller）模式是一种软件架构设计模式，它将应用程序分为三个核心组件：模型（Model）、视图（View）和控制器（Controller），以实现关注点分离，提升代码可维护性和可扩展性。  以下是其具体内涵及在ASP.NET中的应用特点： 1....</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/61216968?s=400&amp;u=d5b61cbc7946e6309e4318dabc2d459a18e0fe55&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">kyl</div><div class="author-info-description">用于记录平时学习的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/alsl521" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:852970167@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E9%A1%B5"><span class="toc-number">1.</span> <span class="toc-text">1、分页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E7%AD%9B%E9%80%89"><span class="toc-number">2.</span> <span class="toc-text">2、筛选</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81%E6%8E%92%E5%BA%8F"><span class="toc-number">3.</span> <span class="toc-text">3、排序</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8Redis"><span class="toc-number">4.</span> <span class="toc-text">4、使用Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BD%9C%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">1、基本作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%85%B8%E5%9E%8B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.2.</span> <span class="toc-text">2、典型使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%80%9A%E8%BF%87docker-desktop%E5%AE%89%E8%A3%85Redis"><span class="toc-number">4.3.</span> <span class="toc-text">3、通过docker desktop安装Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%8B%E8%BD%BD-Docker-Desktop"><span class="toc-number">4.3.1.</span> <span class="toc-text">1. 下载 Docker Desktop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85-Docker-Desktop"><span class="toc-number">4.3.2.</span> <span class="toc-text">2. 安装 Docker Desktop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE-Docker-Desktop"><span class="toc-number">4.3.3.</span> <span class="toc-text">3. 配置 Docker Desktop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85Redis"><span class="toc-number">4.3.4.</span> <span class="toc-text">4. 安装Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81ASP-NET-Core%E4%B8%AD%E4%BD%BF%E7%94%A8Redis"><span class="toc-number">4.4.</span> <span class="toc-text">4、ASP.NET Core中使用Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85%E5%BF%85%E8%A6%81%E7%9A%84-NuGet-%E5%8C%85"><span class="toc-number">4.4.1.</span> <span class="toc-text">1、安装必要的 NuGet 包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE-Redis-%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.4.2.</span> <span class="toc-text">2、配置 Redis 连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9C%A8-Program-cs-%E4%B8%AD%E9%85%8D%E7%BD%AE-Redis"><span class="toc-number">4.4.3.</span> <span class="toc-text">3. 在 Program.cs 中配置 Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA-Redis-%E6%9C%8D%E5%8A%A1%E7%B1%BB%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="toc-number">4.4.4.</span> <span class="toc-text">4. 创建 Redis 服务类相关代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%AD%E4%BD%BF%E7%94%A8-Redis"><span class="toc-number">4.4.5.</span> <span class="toc-text">5. 在控制器中使用 Redis</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8Java%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86Result%E6%A0%BC%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">5、使用Java常用标准Result格式</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/21/NET-ASP-13/" title="ASP.NET学习记录-13-实践2-数据库进阶">ASP.NET学习记录-13-实践2-数据库进阶</a><time datetime="2025-04-21T08:39:19.000Z" title="发表于 2025-04-21 16:39:19">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/NET-ASP-12/" title="ASP.NET学习记录-12-实践2-使用MySQL数据库">ASP.NET学习记录-12-实践2-使用MySQL数据库</a><time datetime="2025-04-18T08:11:21.000Z" title="发表于 2025-04-18 16:11:21">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/NET-ASP-11/" title="ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API">ASP.NET学习记录-11-实践1-使用 ASP.NET Core 生成基于控制器的 Web API</a><time datetime="2025-04-18T02:13:44.000Z" title="发表于 2025-04-18 10:13:44">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/16/NET-ASP-10/" title="ASP.NET学习记录-10-过滤">ASP.NET学习记录-10-过滤</a><time datetime="2025-04-16T12:02:16.000Z" title="发表于 2025-04-16 20:02:16">2025-04-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/15/Software/" title="记录必备软件">记录必备软件</a><time datetime="2025-04-15T11:29:21.000Z" title="发表于 2025-04-15 19:29:21">2025-04-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 By kyl</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>